/**
 * Minified by jsDelivr using UglifyJS v3.1.10.
 * Original file: /npm/jquery-comments@1.0.1/js/jquery-comments.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e){var t={$el:null,commentsById:{},currentSortKey:"",options:{profilePictureURL:"",spinnerIconURL:"",upvoteIconURL:"",replyIconURL:"",noCommentsIconURL:"",textareaPlaceholderText:"Add a comment",popularText:"Popular",newestText:"Newest",oldestText:"Oldest",sendText:"Send",replyText:"Reply",editText:"Edit",editedText:"Edited",youText:"You",saveText:"Save",deleteText:"Delete",viewAllRepliesText:"View all __replyCount__ replies",hideRepliesText:"Hide replies",noCommentsText:"No comments",textFormatter:function(e){return e},enableReplying:!0,enableEditing:!0,enableUpvoting:!0,enableDeleting:!0,enableDeletingCommentWithReplies:!0,highlightColor:"#337AB7",deleteButtonColor:"#C9302C",roundProfilePictures:!1,textareaRows:2,textareaRowsOnFocus:2,textareaMaxRows:5,maxRepliesVisible:2,fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",fullname:"fullname",profilePictureURL:"profile_picture_url",createdByAdmin:"created_by_admin",createdByCurrentUser:"created_by_current_user",upvoteCount:"upvote_count",userHasUpvoted:"user_has_upvoted"},getComments:function(e,t){e([])},postComment:function(e,t,n){t(e)},putComment:function(e,t,n){t(e)},deleteComment:function(e,t,n){t()},upvoteComment:function(e,t,n){t(e)},refresh:function(){},timeFormatter:function(e){return new Date(e).toLocaleDateString()}},events:{"keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange","paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li":"navigationElementClicked","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged","click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .update.enabled":"putComment","click .commenting-field .delete.enabled":"deleteComment","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment button.reply":"replyButtonClicked","click li.comment button.edit":"editButtonClicked","click li.comment button.upvote":"upvoteComment"},init:function(t,n){this.$el=e(n),this.$el.addClass("jquery-comments"),this.undelegateEvents(),this.delegateEvents(),function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),e.browser.mobile&&this.$el.addClass("mobile"),t.fieldMappings&&(t=e.extend({},t),e.extend(this.options.fieldMappings,t.fieldMappings),delete t.fieldMappings),e.extend(this.options,t),this.createCssDeclarations(),this.fetchDataAndRender()},delegateEvents:function(){this.bindEvents(!1)},undelegateEvents:function(){this.bindEvents(!0)},bindEvents:function(t){var n=t?"off":"on";for(var i in this.events){var a=i.split(" ")[0],o=i.split(" ").slice(1).join(" "),s=this.events[i].split(" ");for(var r in s){var l=this[s[r]];l=e.proxy(l,this),""==o?this.$el[n](a,l):this.$el[n](a,o,l)}}},fetchDataAndRender:function(){var t=this;this.$el.empty(),this.createHTML(),this.commentsById={};var n=function(n){var i=n.map(function(e){return t.createCommentModel(e)});t.sortComments(i,"oldest"),e(i).each(function(e,n){t.addCommentToDataModel(n)}),t.render()};this.options.getComments(n,function(){n([])})},createCommentModel:function(e){var t=this.applyInternalMappings(e);return t.childs=[],t},addCommentToDataModel:function(e){if(!(e.id in this.commentsById)&&(this.commentsById[e.id]=e,e.parent)){this.getOutermostParent(e.parent).childs.push(e.id)}},updateCommentModel:function(t){e.extend(this.commentsById[t.id],t)},render:function(){var t=this;this.$el.find("#comment-list").remove();var n=e("<ul/>",{id:"comment-list"});this.currentSortKey=this.$el.find(".navigation li.active").data().sortKey;var i=[],a=[];e(this.getComments()).each(function(e,t){null==t.parent?i.push(t):a.push(t)}),this.sortComments(i,this.currentSortKey),i.reverse(),e(i).each(function(e,i){t.addComment(i,n)}),this.sortComments(a,"oldest"),e(a).each(function(e,i){t.addComment(i,n)}),this.$el.find("> .spinner").remove(),this.$el.find(".no-comments").before(n),this.options.refresh()},addComment:function(e,t){t=t||this.$el.find("#comment-list");var n=this.createCommentElement(e);if(e.parent){var i=t.find('.comment[data-id="'+e.parent+'"]'),a=i.parents(".comment").last();0==a.length&&(a=i);a.find(".child-comments").append(n),this.updateToggleAllButton(a)}else t.prepend(n)},removeComment:function(t){var n=this,i=this.commentsById[t],a=this.getChildComments(i.id);if(e(a).each(function(e,t){n.removeComment(t.id)}),i.parent){var o=this.getOutermostParent(i.parent),s=o.childs.indexOf(i.id);o.childs.splice(s,1)}delete this.commentsById[t];var r=this.$el.find('li.comment[data-id="'+t+'"]'),l=r.parents("li.comment").last();r.remove(),this.updateToggleAllButton(l)},updateToggleAllButton:function(t){var n=t.find(".child-comments"),i=n.find(".comment"),a=n.find("li.toggle-all");i.removeClass("hidden-reply");var o=i.slice(0,-this.options.maxRepliesVisible);if(o.addClass("hidden-reply"),a.find("span.text").text()==this.options.textFormatter(this.options.hideRepliesText)&&o.addClass("visible"),i.length>this.options.maxRepliesVisible){if(!a.length){a=e("<li/>",{class:"toggle-all highlight-font-bold"});var s=e("<span/>",{class:"text"}),r=e("<span/>",{class:"caret"});a.append(s).append(r),n.prepend(a)}this.setToggleAllButtonText(a,!1)}else a.remove()},sortComments:function(e,t){var n=this;"popularity"==t?e.sort(function(e,t){var i=e.childs.length,a=t.childs.length;if(n.options.enableUpvoting&&(i+=e.upvoteCount,a+=t.upvoteCount),a!=i)return a-i;var o=new Date(e.created).getTime();return new Date(t.created).getTime()-o}):e.sort(function(e,n){var i=new Date(e.created).getTime(),a=new Date(n.created).getTime();return"newest"==t?a-i:i-a})},sortAndReArrangeComments:function(t){var n=this.$el.find("#comment-list"),i=this.getComments().filter(function(e){return!e.parent});this.sortComments(i,t),e(i).each(function(e,t){var i=n.find("> li.comment[data-id="+t.id+"]");n.append(i)})},saveOnKeydown:function(t){if(13==t.keyCode&&(t.metaKey||t.ctrlKey)){e(t.currentTarget).siblings(".control-row").find(".save").trigger("click"),t.stopPropagation(),t.preventDefault()}},saveEditableContent:function(t){var n=e(t.currentTarget);n.data("before",n.html())},checkEditableContentForChange:function(t){var n=e(t.currentTarget);n.data("before")!=n.html()&&(n.data("before",n.html()),n.trigger("change"))},navigationElementClicked:function(t){var n=e(t.currentTarget);n.siblings().removeClass("active"),n.addClass("active");var i=n.data().sortKey;this.sortAndReArrangeComments(i),this.currentSortKey=i},showMainCommentingField:function(t){var n=e(t.currentTarget);n.siblings(".control-row").show(),n.parent().find(".close").show(),n.focus()},hideMainCommentingField:function(t){var n=e(t.currentTarget),i=this.$el.find(".commenting-field.main .textarea"),a=this.$el.find(".commenting-field.main .control-row");this.clearTextarea(i),this.adjustTextareaHeight(i,!1),a.hide(),n.hide(),i.blur()},increaseTextareaHeight:function(t){var n=e(t.currentTarget);this.adjustTextareaHeight(n,!0)},textareaContentChanged:function(t){var n=e(t.currentTarget),i=this.getTextareaContent(n),a=n.siblings(".control-row").find(".save");if(!n.find(".reply-to-badge").length){var o=n.attr("data-comment");if(o){var s=n.parents("li.comment");if(s.length>1){r=s.last().data("id");n.attr("data-parent",r)}}else{var r=n.parents("li.comment").last().data("id");n.attr("data-parent",r)}}var l=n.parents(".commenting-field").first();n[0].scrollHeight>n.outerHeight()?l.addClass("scrollable"):l.removeClass("scrollable");var d=!0;if(o=n.attr("data-comment")){var c,m=i!=this.commentsById[o].content;this.commentsById[o].parent&&(c=this.commentsById[o].parent.toString());var p=n.attr("data-parent")!=c;d=m||p}i.length&&d?a.addClass("enabled"):a.removeClass("enabled")},removeCommentingField:function(t){var n=e(t.currentTarget);n.siblings(".textarea").attr("data-comment")&&n.parents("li.comment").first().removeClass("edit");n.parents(".commenting-field").first().remove()},postComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".commenting-field").first(),o=a.find(".textarea");i.removeClass("enabled");var s=(new Date).toISOString(),r={id:"c"+(this.getComments().length+1),parent:o.attr("data-parent")||null,created:s,modified:s,content:this.getTextareaContent(o),fullname:this.options.textFormatter(this.options.youText),profilePictureURL:this.options.profilePictureURL,createdByCurrentUser:!0,upvoteCount:0,userHasUpvoted:!1};r=this.applyExternalMappings(r);this.options.postComment(r,function(e){var t=n.createCommentModel(e);n.addCommentToDataModel(t),n.addComment(t),a.find(".close").trigger("click")},function(){i.addClass("enabled")})},putComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".commenting-field").first(),o=a.find(".textarea");i.removeClass("enabled");var s=e.extend({},this.commentsById[o.attr("data-comment")]);e.extend(s,{parent:o.attr("data-parent")||null,content:this.getTextareaContent(o),modified:(new Date).getTime()}),s=this.applyExternalMappings(s);this.options.putComment(s,function(e){var t=n.createCommentModel(e);delete t.childs,n.updateCommentModel(t),a.find(".close").trigger("click"),n.reRenderComment(t.id)},function(){i.addClass("enabled")})},deleteComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".commenting-field").first().find(".textarea"),o=e.extend({},this.commentsById[a.attr("data-comment")]),s=o.id;i.removeClass("enabled"),o=this.applyExternalMappings(o);this.options.deleteComment(o,function(){n.removeComment(s)},function(){i.addClass("enabled")})},toggleReplies:function(t){var n=e(t.currentTarget);n.siblings(".hidden-reply").toggleClass("visible"),this.setToggleAllButtonText(n,!0)},replyButtonClicked:function(t){var n=e(t.currentTarget),i=n.parents("li.comment").last(),a=n.parents(".comment").first().data().id;(o=i.find(".child-comments > .commenting-field")).length&&o.remove();if(o.find(".textarea").attr("data-parent")!=a){var o=this.createCommentingFieldElement(a);i.find(".child-comments").append(o);var s=o.find(".textarea");this.moveCursorToEnd(s)}},editButtonClicked:function(t){var n=e(t.currentTarget).parents("li.comment").first(),i=n.data().model;n.addClass("edit");var a=this.createCommentingFieldElement(i.parent,i.id);n.find(".comment-wrapper").first().append(a);var o=a.find(".textarea");o.attr("data-comment",i.id),o.append(this.getTextareaContentAsEscapedHTML(i.content)),this.moveCursorToEnd(o)},upvoteComment:function(t){var n,i=this,a=e(t.currentTarget).parents("li.comment").first().data().model,o=a.upvoteCount;n=a.userHasUpvoted?o-1:o+1,a.userHasUpvoted=!a.userHasUpvoted,a.upvoteCount=n,this.reRenderUpvotes(a.id);var s=e.extend({},a);s=this.applyExternalMappings(s);this.options.upvoteComment(s,function(e){var t=i.createCommentModel(e);i.updateCommentModel(t),i.reRenderUpvotes(t.id)},function(){a.userHasUpvoted=!a.userHasUpvoted,a.upvoteCount=o,i.reRenderUpvotes(a.id)})},createHTML:function(){var t=this.createCommentingFieldElement();t.addClass("main"),this.$el.append(t);t.find(".control-row").hide(),t.find(".close").hide(),this.$el.append(this.createNavigationElement());var n=e("<div/>",{class:"spinner"}),i=e("<i/>",{class:"fa fa-spinner fa-spin"});this.options.spinnerIconURL.length&&(i.css("background-image",'url("'+this.options.spinnerIconURL+'")'),i.addClass("image")),n.html(i),this.$el.append(n);var a=e("<div/>",{class:"no-comments",text:this.options.textFormatter(this.options.noCommentsText)}),o=e("<i/>",{class:"fa fa-comments fa-2x"});this.options.noCommentsIconURL.length&&(o.css("background-image",'url("'+this.options.noCommentsIconURL+'")'),o.addClass("image")),a.prepend(e("<br/>")).prepend(o),this.$el.append(a)},createProfilePictureElement:function(t){return e("<img/>",{src:t,class:"profile-picture"+(this.options.roundProfilePictures?" round":"")})},createCommentingFieldElement:function(t,n){var i=e("<div/>",{class:"commenting-field"}),a=this.createProfilePictureElement(this.options.profilePictureURL);a.addClass("by-current-user");var o=e("<div/>",{class:"textarea-wrapper"}),s=e("<div/>",{class:"control-row"}),r=e("<div/>",{class:"textarea","data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:!0});this.adjustTextareaHeight(r,!1);var l=e("<span/>",{class:"close"}).append(e('<span class="left"/>')).append(e('<span class="right"/>'));if(n){m=this.options.textFormatter(this.options.saveText);if(this.options.enableDeleting){var d=!0;if(this.options.enableDeletingCommentWithReplies||e(this.getComments()).each(function(e,t){t.parent==n&&(d=!1)}),d){var c=e("<span/>",{class:"enabled delete",text:this.options.textFormatter(this.options.deleteText)}).css("background-color",this.options.deleteButtonColor);s.append(c)}}}else var m=this.options.textFormatter(this.options.sendText);var p=e("<span/>",{class:(n?"update":"send")+" save highlight-background",text:m});if(s.prepend(p),o.append(l).append(r).append(s),i.append(a).append(o),t){r.attr("data-parent",t);var h=this.commentsById[t];if(h.parent){r.html("&nbsp;");var u=e("<input/>",{class:"reply-to-badge highlight-font-bold",type:"button"}),g="@"+h.fullname;u.val(g),r.prepend(u)}}return i},createNavigationElement:function(){var t=e("<ul/>",{class:"navigation"}),n=e("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity"}),i=e("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest"}),a=e("<li/>",{text:this.options.textFormatter(this.options.oldestText),"data-sort-key":"oldest"});return(this.options.enableReplying||this.options.enableUpvoting)&&t.append(n),t.append(i).append(a),t.children().first().addClass("active"),t},createCommentElement:function(t){var n=e("<li/>",{"data-id":t.id,class:"comment"}).data("model",t);t.createdByCurrentUser&&n.addClass("by-current-user"),t.createdByAdmin&&n.addClass("by-admin");var i=e("<ul/>",{class:"child-comments"}),a=this.createCommentWrapperElement(t);return n.append(a),null==t.parent&&n.append(i),n},createCommentWrapperElement:function(t){var n=e("<div/>",{class:"comment-wrapper"}),i=this.createProfilePictureElement(t.profilePictureURL),a=e("<time/>",{text:this.options.timeFormatter(t.created),"data-original":t.created}),o=e("<div/>",{class:"name",text:t.fullname});if(t.createdByAdmin&&o.addClass("highlight-font-bold"),t.parent){var s=this.commentsById[t.parent];if(s.parent){var r=e("<span/>",{class:"reply-to",text:s.fullname}),l=e("<i/>",{class:"fa fa-share"});this.options.replyIconURL.length&&(l.css("background-image",'url("'+this.options.replyIconURL+'")'),l.addClass("image")),r.prepend(l),o.append(r)}}var d=e("<div/>",{class:"wrapper"}),c=e("<div/>",{class:"content",text:t.content}).html(this.linkify(this.escape(t.content)));if(t.modified&&t.modified!=t.created){var m=this.options.timeFormatter(t.modified),p=e("<time/>",{class:"edited",text:this.options.textFormatter(this.options.editedText)+" "+m,"data-original":t.modified});c.append(p)}var h=e("<span/>",{class:"actions"}),u=e("<span/>",{class:"separator",text:"·"}),g=e("<button/>",{class:"action reply",text:this.options.textFormatter(this.options.replyText)}),f=e("<i/>",{class:"fa fa-thumbs-up"});this.options.upvoteIconURL.length&&(f.css("background-image",'url("'+this.options.upvoteIconURL+'")'),f.addClass("image"));var v=this.createUpvoteElement(t),C=e("<button/>",{class:"action edit",text:this.options.textFormatter(this.options.editText)});return this.options.enableReplying&&h.append(g),this.options.enableUpvoting&&h.append(v),this.options.enableEditing&&t.createdByCurrentUser&&h.append(C),h.children().each(function(t,n){e(n).is(":last-child")||e(n).after(u.clone())}),d.append(c),d.append(h),n.append(i).append(a).append(o).append(d),n},createUpvoteElement:function(t){var n=e("<i/>",{class:"fa fa-thumbs-up"});this.options.upvoteIconURL.length&&(n.css("background-image",'url("'+this.options.upvoteIconURL+'")'),n.addClass("image"));return e("<button/>",{class:"action upvote"+(t.userHasUpvoted?" highlight-font":"")}).append(e("<span/>",{text:t.upvoteCount,class:"upvote-count"})).append(n)},reRenderComment:function(e){var t=this.commentsById[e],n=this.createCommentWrapperElement(t);this.$el.find('li.comment[data-id="'+t.id+'"]').find("> .comment-wrapper").replaceWith(n)},reRenderUpvotes:function(e){var t=this.commentsById[e],n=this.createUpvoteElement(t);this.$el.find('li.comment[data-id="'+t.id+'"]').find(".upvote").first().replaceWith(n)},createCssDeclarations:function(){e("head style.jquery-comments-css").length>0||(this.createCss(".jquery-comments ul.navigation li.active:after {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-background {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-font {color: "+this.options.highlightColor+" !important;}"),this.createCss(".jquery-comments .highlight-font-bold {color: "+this.options.highlightColor+" !important;font-weight: bold;}"))},createCss:function(t){var n=e("<style/>",{type:"text/css",class:"jquery-comments-css",text:t});e("head").append(n)},getComments:function(){var e=this;return Object.keys(this.commentsById).map(function(t){return e.commentsById[t]})},getChildComments:function(e){return this.getComments().filter(function(t){return t.parent==e})},getOutermostParent:function(e){var t=e;do{var n=this.commentsById[t];t=n.parent}while(null!=n.parent);return n},setToggleAllButtonText:function(e,t){var n=this,i=e.find("span.text"),a=e.find(".caret"),o=function(){var t=n.options.textFormatter(n.options.viewAllRepliesText),a=e.siblings(".comment").length;t=t.replace("__replyCount__",a),i.text(t)},s=this.options.textFormatter(this.options.hideRepliesText);t?(i.text()==s?o():i.text(s),a.toggleClass("up")):i.text()!=s&&o()},adjustTextareaHeight:function(t,n){var i=function(e){var n=2.2+1.45*(e-1);t.css("height",n+"em")},t=e(t),a=1==n?this.options.textareaRowsOnFocus:this.options.textareaRows;do{i(a),a++;var o=t[0].scrollHeight>t.outerHeight(),s=0!=this.options.textareaMaxRows&&a>this.options.textareaMaxRows}while(o&&!s)},clearTextarea:function(e){e.empty().trigger("input")},getTextareaContent:function(t){var n=e("<pre/>").html(t.html());n.find("div, p, br").replaceWith(function(){return"\n"+this.innerHTML});return n.text().replace(/^\s+/g,"")},getTextareaContentAsEscapedHTML:function(e){return this.escape(e).replace(/(?:\n)/g,"<br>")},moveCursorToEnd:function(t){if(t=e(t)[0],e(t).trigger("input"),e(t).scrollTop(t.scrollHeight),void 0!==window.getSelection&&void 0!==document.createRange){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t),a.collapse(!1),a.select()}t.focus()},escape:function(t){return e("<pre/>").text(t).html()},linkify:function(e){var t,n,i,a;n=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,i=/(^|[^\/f])(www\.[\S]+(\b|$))/gim,a=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=(t=(t=e.replace(n,'<a href="$1" target="_blank">$1</a>')).replace(i,'$1<a href="http://$2" target="_blank">$2</a>')).replace(a,'<a href="mailto:$1">$1</a>');if((e.match(/<a href/g)||[]).length>0){for(var o=e.split(/(<\/a>)/g),s=0;s<o.length;s++)null==o[s].match(/<a href/g)&&(o[s]=o[s].replace(n,'<a href="$1" target="_blank">$1</a>').replace(i,'$1<a href="http://$2" target="_blank">$2</a>').replace(a,'<a href="mailto:$1">$1</a>'));return o.join("")}return t},applyInternalMappings:function(e){var t={},n=this.options.fieldMappings;for(var i in n)n.hasOwnProperty(i)&&(t[n[i]]=i);return this.applyMappings(t,e)},applyExternalMappings:function(e){var t=this.options.fieldMappings;return this.applyMappings(t,e)},applyMappings:function(e,t){var n={};for(var i in t)if(i in e){n[e[i]]=t[i]}return n}};e.fn.comments=function(n){return this.each(function(){var i=Object.create(t);i.init(n||{},this),e.data(this,"comments",i)})}}(jQuery);
 
String.prototype.comments  = (function(){

  if(!$.fn.comments){
    // https://www.jsdelivr.com/package/npm/jquery-comments
      // loadCSS("https://chat.donggiatri.com/comment/jquery-comments/css/jquery-comments.css",function(){}); 
  }

  return function(options){
    options = $.extend({
    user:null,
    id: null,
    api:{
       list: document.location.href,
       add: document.location.href,
       edit: document.location.href,
       delete: document.location.href,
       vote: document.location.href,
    },
    onCallback : function(){}
  },options,true);

  var id = options.id;

  if(!id){
     console.log("Can not find id");
      return null;
  }

   var u = options.user||null;

        
var ele = $(this.toString());
         /*-------------------
           commnet
        --------------------- */
   
   ele.comments({ 
        profilePictureURL: (u&&u.avatar)?u.avatar:'https://i.pinimg.com/564x/00/fe/19/00fe191b0c4dde7d29d81c67bee0f0cb.jpg',
  
        roundProfilePictures: true,
        textareaRows: 1,
        enableAttachments: false, 
        readOnly: false,
        textareaPlaceholderText: 'Tạo bài bình luận mới',
        newestText: 'Mới nhất',
        oldestText: 'Cũ nhất',
        popularText: 'Thông dụng',
        attachmentsText: 'Gửi file',
        sendText: 'Gửi',
        replyText: 'Trả lời',
        editText: 'Sửa',
        editedText: 'Đã sửa',
        youText: (u&&u.user_login)?u.user_login:"Bạn",
      
        saveText: 'Lưu',
        deleteText: 'Xoá',
        viewAllRepliesText: 'Xem tất cả__replyCount__ trả lời',
        hideRepliesText: 'Ẩn trả lời',
        noCommentsText: 'Hiện chưa có bình luận',
        noAttachmentsText: 'Không có tập tin đính kèm',
        attachmentDropText: 'Kéo thả tập tin vào đây',
        textFormatter: function(text) {
          return text;
        },
        getComments: function(success, error) { 
          postajax(options.api.list,{id:id},function(res){
            try{
              res = JSON.parse(res);
            }catch(e){}
            options.onCallback("list",res);
            success(res);
          }); 
        },
        postComment: function (data, success, error) {
          success(data);
          data.id = id;
          data.user = {
            avatar:u.avatar,
            id:u.id,
            fullname:u.fullname
          };
          data.comments_post = 1;
          postajax(options.api.add,data,function(res){ options.onCallback("add",res);console.log(res); });
        },
        putComment: function (data, success, error) {
          success(data);
          data.id = id;
          data.user = JSON.stringify(u);
          data.comments_update = 1;
          postajax(options.api.edit,data,function(res){ options.onCallback("edit",res);console.log(res); });
        },
        deleteComment: function (data, success, error) {
          success(data);
          data.id = id;
          data.user = JSON.stringify(u);
          data.comments_delete = 1;
          postajax(options.api.delete,data,function(res){ options.onCallback("delete",res);console.log(res); });
        },
        upvoteComment: function (data, success, error) {
          success(data);
          data.id = id;
          data.user = JSON.stringify(u);
          data.comments_upvote = 1;
          postajax(options.api.vote,data,function(res){ options.onCallback("vote",res);console.log(res); });
        }
      });
  return ele;
  };
})();