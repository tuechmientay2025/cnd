import{u as is,j as e,t as n,w as lt,a as ot,_ as c,b as Ie,c as Me,s as Re,d as Ae,e as rs,f as ls,g as ct,h as at,i as bs,k as pt,l as ks,m as dt,n as ut,o as ht}from"../main.DB7J0o3m.1748844899215.js";import{L as ss,r as j,i as xt}from"./vendor.B47oQPyY.1748844899215.js";import{D as mt,A as Ke,d as ws,c as N,s as G,R as V,C as u,e as he,F as oe,B as ee,f as os,g as Te,h as de,i as ge,j as jt,k as Ns,l as Os,m as X,n as Qe,T as Be,U as Ee,o as ft,p as gt,q as ts,S as yt,r as _t,u as Ps,v as bt,w as le,x as ns,y as Cs,z as Ts,E as pe,G as kt,H as wt,J as Ct,K as Tt,P as Ft,L as Us,N as Et,O as It,Q as Fs,V as Rt,W as At,X as Bt,Y as Lt,Z as zt}from"./antd.tbETyFFE.1748844899215.js";import{S as Fe,t as Ye,a as qe,A as St,U as Se,u as Ys}from"./Actionconfirm.xdoecHyJ.1748844899215.js";import{t as ye,T as cs,g as qs,a as as,i as $e,c as Ge,b as We,f as Es,w as Qs,R as Gs}from"./withQuillEditorConfig.VGjlY2Aq.1748844899215.js";import"./toast.C9WEee-3.1748844899215.js";import{w as Is,Q as Mt}from"./QuillEditor.BISWwr2A.1748844899215.js";const Rs=ot();function $t(){var _;const{getBasicSettings:l}=is(),d=l();return e.jsx(mt,{menu:{items:[{key:"profile",label:Rs?e.jsx("a",{href:Rs,children:n("Profile")}):e.jsx(ss,{to:"/profile",children:n("Profile")})},{key:"change-password",label:e.jsx(ss,{to:"/change-password",children:n("Change Password")})},{key:"logout",label:e.jsx("a",{href:lt(),children:n("Logout")})}],defaultSelectedKeys:[],selectable:!0},placement:"bottom",trigger:["click"],arrow:!0,children:e.jsx(Ke,{src:((_=d==null?void 0:d.logged_user)==null?void 0:_.img)||"",style:{cursor:"pointer"}})})}const{Text:ve}=Be,{Dragger:Nt}=Ee,Ot=as(),As=$e(),Bs="YYYY-MM-DD";function Ls({setFormType:l,ticketUserData:d,onCloseModal:_,categorySelectList:f,fileSettingsData:r,basicSettings:h}){var re;const F=(h==null?void 0:h.is_master)||!1,b=((re=h==null?void 0:h.custom_fields)==null?void 0:re.ticket_form)||[],S={};for(const i of b){const p=(i==null?void 0:i.field_type)||"",m=(i==null?void 0:i.input_name)||"",y=(i==null?void 0:i.field_value)||"";if(p==="E")continue;let t=y;p==="N"?t=y?c.toNumber(y):"":p==="D"?t=y?ws(y):"":p==="S"?t=y?!!y:!1:t=c.trim(y),S[m]=t}const T={...S,cat_id:"",is_public:!1},U=Ie(),[o]=N.useForm(),[E,A]=j.useState(""),[B,a]=j.useState([]),[I,z]=j.useState(""),[C,x]=Me(),R=i=>{c.has(i,"cat_id")&&A((i==null?void 0:i.cat_id)||"")},Q=i=>{var se,ce,K,Z;const p=((se=d==null?void 0:d.id)==null?void 0:se.trim())||"",m=((ce=i==null?void 0:i.cat_id)==null?void 0:ce.trim())||"0",y=((K=i==null?void 0:i.title)==null?void 0:K.trim())||"",t=ye(((Z=i==null?void 0:i.ticket_body)==null?void 0:Z.trim())||""),k=i!=null&&i.is_public?"Y":"N";if(!t){o.setFieldValue("ticket_body",""),z(n("%s is not valid.",n("Description")));return}const w={};for(const Y in i){const $=b.find(O=>(O==null?void 0:O.input_name)===Y);if($){const O=($==null?void 0:$.categories)||"";if(!c.isEmpty(O)&&!c.includes(O,m)&&!c.includes(O,"0"))return null;if(c.has($,"is_editable")?($==null?void 0:$.is_editable)||!1:!0){const _e=($==null?void 0:$.field_type)||"";_e==="N"?w[Y]=c.toString(i[Y]):_e==="D"?w[Y]=ws(i[Y]).format(Bs):_e==="S"?w[Y]=i[Y]?1:0:w[Y]=c.trim(i[Y])}}}const L=new FormData;L.append("ticket_user",p),L.append("cat_id",m),L.append("title",y),L.append("ticket_body",t),L.append("is_public",k),L.append("custom_fields",JSON.stringify(w)),B.forEach(Y=>{L.append("attached[]",Y.originFileObj)}),C({params:{action:"ticket_add",id:T==null?void 0:T.id},data:L,headers:{"Content-Type":"multipart/form-data"}})},M=i=>{const p=i.size,m=i.type,y=Ge(r==null?void 0:r.file_upload_size);return We(r==null?void 0:r.allowed_type).includes(m)?p>y?(z(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB")),Ee.LIST_IGNORE):!0:(z(n("Invalid file type.")),Ee.LIST_IGNORE)},v=({fileList:i,file:p})=>{const m=p.size,y=p.type,t=Ge(r==null?void 0:r.file_upload_size);if(!We(r==null?void 0:r.allowed_type).includes(y)){z(n("Invalid file type."));return}if(m>t){n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB");return}a(i)},W=i=>{const p=B.indexOf(i),m=B.slice().splice(p,1);a(m)};return j.useEffect(()=>{var t,k,w,L;const{data:i,isLoading:p,isError:m,error:y}=x;U(p?Re():Ae()),!p&&m&&((k=(t=y==null?void 0:y.data)==null?void 0:t.errors)!=null&&k.message)&&G.error((L=(w=y==null?void 0:y.data)==null?void 0:w.errors)==null?void 0:L.message),!p&&!m&&i&&(i!=null&&i.msg&&(i!=null&&i.status?(z(""),G.success(i==null?void 0:i.msg)):(z(i==null?void 0:i.msg),rs())),i!=null&&i.status&&_())},[x,_,U]),e.jsx(N,{form:o,name:"createTicket",layout:"vertical",onFinish:Q,onValuesChange:R,initialValues:T,autoComplete:"off",children:e.jsxs(V,{gutter:16,children:[I?e.jsx(u,{span:24,children:e.jsx(he,{message:I,type:"error",showIcon:!0,closable:!0,afterClose:()=>z(""),style:{marginBottom:"24px"}})}):null,!As&&!F&&Is?e.jsx(u,{span:24,children:e.jsx(he,{message:Is,type:"warning",style:{marginBottom:"24px"}})}):null,F&&d?e.jsx(u,{span:24,children:e.jsxs(V,{children:[e.jsx(u,{span:24,children:e.jsxs(oe,{align:"center",justify:"space-between",style:{marginBottom:"8px"},children:[e.jsx(ve,{children:n("Ticket User")}),e.jsx(ee,{size:"small",onClick:()=>{l("search-user")},children:n("Change User")})]})}),e.jsx(u,{span:24,children:e.jsx(os,{size:"small",styles:{body:{padding:0}},style:{borderColor:"#d9d9d9",marginBottom:"24px"},children:e.jsx(Te,{itemLayout:"horizontal",dataSource:[d],renderItem:i=>e.jsx(Te.Item,{style:{padding:"8px",margin:0},children:e.jsx(Te.Item.Meta,{avatar:e.jsx(Ke,{src:(i==null?void 0:i.avatar)||(i==null?void 0:i.img)||""}),title:i==null?void 0:i.name,description:i==null?void 0:i.email})}),className:"sg-ticket-users-list"})})})]})}):null,e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Category"),name:"cat_id",children:e.jsx(de,{options:f})})}),e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Subject"),name:"title",rules:[{required:!0,message:n("%s is required.",n("Subject")),whitespace:!0}],children:e.jsx(ge,{})})}),b==null?void 0:b.map(i=>{const p=(i==null?void 0:i.categories)||"";if(!c.isEmpty(p)&&!c.includes(p,E)&&!c.includes(p,"0"))return null;const m=(i==null?void 0:i.field_type)||"",y=(i==null?void 0:i.input_name)||"",t=(i==null?void 0:i.field_label)||"",k=(i==null?void 0:i.field_value)||"",w=(i==null?void 0:i.fld_option)||"",L=(i==null?void 0:i.help_text)||"",se=(i==null?void 0:i.is_required)==="Y",ce=(i==null?void 0:i.is_half_field)==="Y",K=c.has(i,"is_editable")?(i==null?void 0:i.is_editable)||!1:!0;let Z=[];y==="wc_store_id"?Z=w==null?void 0:w.map(O=>({value:c.toString(O==null?void 0:O.id),label:O==null?void 0:O.title})):Z=w?w.split(",").map(O=>({value:O,label:O})):[],m==="W"&&!Z.find(O=>(O==null?void 0:O.value)===k)&&(Z=[{value:"",label:`-- ${n("Select")} ---`},...Z]);let Y=null;m==="T"?Y=e.jsx(ge,{placeholder:L,disabled:!K}):m==="N"?Y=e.jsx(ft,{placeholder:L,disabled:!K,style:{width:"100%"}}):m==="D"?Y=e.jsx(jt,{placeholder:L||n("Select date"),format:Bs,disabled:!K,style:{width:"100%"}}):m==="S"?Y=e.jsx(Qe,{disabled:!K}):m==="R"?Y=e.jsx(Ns.Group,{options:Z,disabled:!K}):m==="W"?Y=e.jsx(de,{placeholder:L||n("Select option"),options:Z,disabled:!K,style:{width:"100%"}}):m==="U"&&(Y=e.jsx(ge,{disabled:!K}));const $={};return m==="R"&&($.htmlFor=null),e.jsx(u,{span:ce?12:24,children:m==="E"?e.jsx(ve,{style:{display:"block",marginBottom:"24px"},children:w}):e.jsx(N.Item,{label:t,name:y,rules:[{required:!!(K&&se),message:n("This field is required.")}],...$,children:Y})},y)}),e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Description"),name:"ticket_body",rules:[{required:!0,message:n("%s is required.",n("Description")),whitespace:!0},{validator:(i,p)=>{const m=ye(p||"");return!p||m?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Description"))))}}],htmlFor:null,children:!As&&Ot==="quill"?e.jsx(Mt,{onModal:!0}):e.jsx(cs,{id:"ticket"})})}),r!=null&&r.ticket_file_upload?e.jsx(u,{span:24,children:e.jsx(N.Item,{name:"attached",children:e.jsx(Nt,{multiple:!0,name:"attached",fileList:B,onChange:v,onRemove:W,beforeUpload:M,accept:qs((r==null?void 0:r.allowed_type)||[],!0,!0),children:e.jsxs(oe,{align:"center",justify:"center",gap:4,wrap:!0,children:[e.jsx(Os,{}),n("Click or drag file to upload")]})})})}):null,(h==null?void 0:h.is_public_ticket_opt_on_creation)==="Y"?e.jsx(u,{span:24,children:e.jsxs(X,{align:"center",style:{marginBottom:"24px"},children:[e.jsx(N.Item,{name:"is_public",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(Qe,{size:"small"})}),e.jsx(ve,{onClick:()=>{o.setFieldValue("is_public",!o.getFieldValue("is_public")),R(null,o.getFieldsValue())},style:{cursor:"pointer"},children:n("Make this ticket public.")})]})}):null,e.jsx(u,{span:24,style:{textAlign:"right"},children:e.jsxs(X,{children:[e.jsx(ee,{htmlType:"button",onClick:_,children:n("Cancel")}),e.jsx(ee,{type:"primary",htmlType:"submit",loading:x==null?void 0:x.isLoading,children:n("Create")})]})})]})})}function Pt({setFormType:l,setSearchTerm:d,setTicketUserData:_}){const f={email:"",first_name:"",last_name:"",notify:!0},r=Ie(),[h]=N.useForm(),[F,b]=j.useState(""),[S,T]=Me(),U=o=>{var I,z,C;const E=((I=o==null?void 0:o.email)==null?void 0:I.trim())||"",A=((z=o==null?void 0:o.first_name)==null?void 0:z.trim())||"",B=((C=o==null?void 0:o.last_name)==null?void 0:C.trim())||"",a=o!=null&&o.notify?"Y":"N";S({params:{action:"users_add",id:f==null?void 0:f.id},data:{email:E,first_name:A,last_name:B,notify:a}})};return j.useEffect(()=>{var a,I,z,C,x;const{data:o,isLoading:E,isError:A,error:B}=T;r(E?Re():Ae()),!E&&A&&((I=(a=B==null?void 0:B.data)==null?void 0:a.errors)!=null&&I.message)&&G.error((C=(z=B==null?void 0:B.data)==null?void 0:z.errors)==null?void 0:C.message),!E&&!A&&o&&(o!=null&&o.msg&&(o!=null&&o.status?b(""):(b(o==null?void 0:o.msg),rs())),o!=null&&o.status&&(_(o==null?void 0:o.data),d(((x=o==null?void 0:o.data)==null?void 0:x.email)||""),l("create-ticket")))},[T,_,d,l,r]),e.jsx(N,{form:h,name:"createUser",layout:"vertical",onFinish:U,initialValues:f,autoComplete:"off",children:e.jsxs(V,{gutter:16,children:[F?e.jsx(u,{span:24,children:e.jsx(he,{message:F,type:"error",showIcon:!0,closable:!0,afterClose:()=>b(""),style:{marginBottom:"24px"}})}):null,e.jsx(u,{span:12,children:e.jsx(N.Item,{label:n("First Name"),name:"first_name",rules:[{required:!0,message:n("%s is required.",n("First name")),whitespace:!0}],children:e.jsx(ge,{})})}),e.jsx(u,{span:12,children:e.jsx(N.Item,{label:n("Last Name"),name:"last_name",rules:[{required:!0,message:n("%s is required.",n("Last name")),whitespace:!0}],children:e.jsx(ge,{})})}),e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Email Address"),name:"email",rules:[{required:!0,message:n("%s is required.",n("Email address")),whitespace:!0}],children:e.jsx(ge,{})})}),e.jsx(u,{span:24,children:e.jsx(N.Item,{name:"notify",valuePropName:"checked",children:e.jsx(gt,{children:n("Send the new user an email about their account.")})})}),e.jsx(u,{span:24,style:{textAlign:"right"},children:e.jsxs(X,{children:[e.jsx(ee,{htmlType:"button",onClick:()=>{l("search-user")},children:n("Back")}),e.jsx(ee,{type:"primary",htmlType:"submit",loading:T==null?void 0:T.isLoading,children:n("Create")})]})})]})})}const{Search:Ut}=ge,{Text:Yt}=Be;function qt({setFormType:l,searchTerm:d,setSearchTerm:_,setTicketUserData:f}){const r={search_term:d},{hasAnyPermission:h}=ls(),[F]=N.useForm(),[b,S]=j.useState(!1),[T,U]=j.useState(""),[o,E]=j.useState([]),A=ct({action:"users_data_search",term:d}),B=a=>{var I;_(((I=a==null?void 0:a.search_term)==null?void 0:I.trim())||"")};return j.useEffect(()=>{F.submit()},[F]),j.useEffect(()=>{var x,R;const{data:a,isFetching:I,isError:z,error:C}=A;S(I),!I&&z&&G.error((R=(x=C==null?void 0:C.data)==null?void 0:x.errors)==null?void 0:R.message),!I&&!z&&a&&E((a==null?void 0:a.data)||[])},[A]),e.jsxs(e.Fragment,{children:[e.jsx(N,{form:F,name:"searchUser",layout:"vertical",onFinish:B,initialValues:r,autoComplete:"off",children:e.jsxs(V,{gutter:16,children:[T?e.jsx(u,{span:24,children:e.jsx(he,{message:T,type:"error",showIcon:!0,closable:!0,afterClose:()=>U(""),style:{marginBottom:"24px"}})}):null,e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Search User"),name:"search_term",rules:[{whitespace:!0}],children:e.jsx(Ut,{enterButton:!0,allowClear:!0,onSearch:()=>{F.submit()},onClear:()=>{F.submit()}})})})]})}),e.jsxs(V,{children:[e.jsx(u,{span:24,children:e.jsxs(oe,{align:"center",justify:"space-between",style:{marginBottom:"8px"},children:[e.jsx(Yt,{children:n("Select User")}),h(["create-ticket-user"])?e.jsx(ee,{size:"small",icon:e.jsx(ts,{}),onClick:()=>{l("create-user")},children:n("Create User")}):null]})}),e.jsx(u,{span:24,children:e.jsx(os,{size:"small",styles:{body:{padding:0}},style:{borderColor:"#d9d9d9",overflow:"hidden"},children:e.jsx(yt,{spinning:b,style:{maxHeight:"unset"},children:e.jsx(Te,{itemLayout:"horizontal",dataSource:o,renderItem:a=>e.jsx(Te.Item,{onClick:()=>{f(a),l("create-ticket")},style:{cursor:"pointer",padding:"8px",margin:0},children:e.jsx(Te.Item.Meta,{avatar:e.jsx(Ke,{src:(a==null?void 0:a.avatar)||""}),title:a==null?void 0:a.name,description:a==null?void 0:a.email})}),className:"sg-search-users-list"})})})})]})]})}function Qt({setCreateTitle:l,onCloseModal:d,categorySelectList:_,fileSettingsData:f,basicSettings:r}){const[h,F]=j.useState("search-user"),[b,S]=j.useState(""),[T,U]=j.useState(null),o=(r==null?void 0:r.is_master)||!1,E=(r==null?void 0:r.logged_user)||{};j.useEffect(()=>{if(!o)F("create-ticket");else switch(h){case"create-user":l(n("Add New %s",n("User")));break;case"create-ticket":l(n("Add New %s",n("Ticket")));break;default:l(n("Choose User"));break}},[h,l,o]);function A(){let B=null;if(!o)B=e.jsx(Ls,{ticketUserData:E,onCloseModal:d,categorySelectList:_,fileSettingsData:f,basicSettings:r});else switch(h){case"create-user":B=e.jsx(Pt,{setFormType:F,setSearchTerm:S,setTicketUserData:U});break;case"create-ticket":B=e.jsx(Ls,{setFormType:F,ticketUserData:T,onCloseModal:d,categorySelectList:_,fileSettingsData:f,basicSettings:r});break;default:B=e.jsx(qt,{setFormType:F,searchTerm:b,setSearchTerm:S,setTicketUserData:U});break}return B}return e.jsx(e.Fragment,{children:A()})}const De=(l="")=>{var f;const d=((f=(l==null?void 0:l.trim())||"")==null?void 0:f.split(/\s+/))||[],_={full:l,first:l,last:""};return 2>d.length?_.first=d[0]:(_.last=d.pop(),_.first=d.join(" ")),_},{Paragraph:Gt,Text:ue}=Be,ze=$e();function Wt({data:l,total:d,limit:_,page:f,onPageChange:r,onSizeChange:h,rowSelection:F,bulkAction:b,setBulkAction:S,bulkActionIds:T,onActionClick:U,isLoading:o,resetBulkAction:E,handleSort:A,bulkActionList:B,statusSelectList:a,agentUserSelectList:I,categorySelectList:z,tagSelectList:C,basicSettings:x}){const R=Ie(),Q=xt(),[M,v]=Me(),W=(x==null?void 0:x.is_master)||!1,re=()=>{let t="";b==="edit"?U("edit"):b==="reply"&&!ze?U("reply"):b==="note"&&!ze?U("note"):b==="trash"?t="ticket_trash_items":b==="restore"?t="ticket_restore_items":b==="remove"&&(t="ticket_delete_items"),t&&M({params:{action:t,ids:T}})},i=(t,k,w,{action:L})=>{L==="sort"&&A(w)},p=t=>{Q(`/ticket/${t==null?void 0:t.id}`)},m=[{title:"",width:40,render:t=>e.jsx(Ke,{size:"large",src:(t==null?void 0:t.user_img)||""}),responsive:["lg"]},{title:n("Title"),render:t=>{var be,Ne;const k=(t==null?void 0:t.status)||"",w=k?a==null?void 0:a.find(({value:D})=>D===k):null,L=c.includes(["C","D"],k)?e.jsx(_t,{}):k==="I"?e.jsx(Ps,{}):e.jsx(bt,{}),se=c.includes(["C","D"],k)?"#cf1322":k==="I"?"#d46b08":"#1d39c4",ce=(t==null?void 0:t.cat_id)||"0",K=ce&&ce!=="0"?z==null?void 0:z.find(({value:D})=>D===ce):null,Z=(t==null?void 0:t.assigned_on)||"0",Y=Z&&Z!=="0"?I==null?void 0:I.find(({value:D})=>D===Z):null,$=Y?De(Y==null?void 0:Y.label):null,O=De(t==null?void 0:t.display_name),Le=((be=Es(t==null?void 0:t.last_reply_text))==null?void 0:be.result)||((Ne=Es(t==null?void 0:t.ticket_body))==null?void 0:Ne.result)||"",_e=!c.includes(["I","C","D"],t==null?void 0:t.status)&&(t==null?void 0:t.last_replied_by_type)!=="A",xe=(t==null?void 0:t.tag_ids)||[],ke=xe==null?void 0:xe.map(D=>C==null?void 0:C.find(({value:Je})=>Je===D));return e.jsxs(V,{children:[e.jsxs(u,{span:24,children:[e.jsx(ss,{to:`/ticket/${t==null?void 0:t.id}`,onClick:D=>D.stopPropagation(),children:e.jsx(ue,{style:{fontWeight:500,marginRight:"8px"},children:t==null?void 0:t.title})}),e.jsx(le,{title:O==null?void 0:O.full,children:e.jsx(ue,{style:{display:"inline-block",fontWeight:300},children:n("by %s",O==null?void 0:O.first)})})]}),e.jsx(u,{span:24,children:e.jsx(Gt,{style:{color:"rgba(0, 0, 0, 0.45)",height:"22px",width:"100%",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",margin:0,padding:0},children:Le})}),e.jsx(Fe,{showOn:["lg"],children:$?e.jsx(u,{span:24,style:{marginTop:8,marginBottom:4},children:e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Agent:")}),e.jsx("span",{children:$==null?void 0:$.full})]}),children:e.jsx(ue,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(ns,{}),$==null?void 0:$.first]})})})}):null}),e.jsx(Fe,{showOn:["xs","sm","md"],children:e.jsx(u,{span:24,style:{marginTop:8,marginBottom:4},children:e.jsxs(oe,{gap:"0 8px",wrap:!0,children:[$?e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Agent:")}),e.jsx("span",{children:$==null?void 0:$.full})]}),children:e.jsx(ue,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(ns,{}),$==null?void 0:$.first]})})}):null,e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Replied:")}),e.jsx("span",{children:Ye(t==null?void 0:t.last_reply_time)})]}),children:e.jsx(ue,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(Cs,{}),qe(t==null?void 0:t.last_reply_time)]})})}),e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Created:")}),e.jsx("span",{children:Ye(t==null?void 0:t.opened_time)})]}),children:e.jsx(ue,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(Ts,{}),qe(t==null?void 0:t.opened_time)]})})})]})})}),e.jsx(u,{span:24,style:{marginTop:8},children:e.jsxs(oe,{gap:"4px 8px",align:"center",wrap:!0,children:[(t==null?void 0:t.is_public)==="Y"?e.jsx(le,{title:n("Public Ticket"),children:e.jsx(pe,{icon:e.jsx(kt,{}),style:{color:"#389e0d",background:"#f6ffed",borderColor:"#b7eb8f",margin:0},children:n("Public")})}):null,e.jsx(le,{title:n("Status"),children:e.jsx(pe,{icon:L,bordered:!1,style:{color:se,margin:0},children:w==null?void 0:w.label})}),K?e.jsx(le,{title:n("Category"),children:e.jsx(pe,{icon:e.jsx(wt,{}),bordered:!1,style:{color:"#0958d9",margin:0},children:K==null?void 0:K.label})}):null,!ze&&W&&!c.isEmpty(ke)&&(ke==null?void 0:ke.map(D=>e.jsx(le,{title:n("Tag"),children:e.jsx(pe,{icon:e.jsx(Ct,{}),bordered:!1,style:{color:"#08979c",margin:0},children:D==null?void 0:D.label})},D==null?void 0:D.value))),e.jsx(le,{title:n("Ticket Track ID"),children:e.jsx(pe,{bordered:!1,style:{color:"rgba(0, 0, 0, 0.45)",margin:0},children:`#${t==null?void 0:t.ticket_track_id}`})}),W?null:e.jsx(le,{title:n("Reply Count"),children:e.jsx(pe,{bordered:!1,style:{margin:0},children:c.toInteger(t==null?void 0:t.reply_counter)||0})})]})}),W?e.jsx(Fe,{showOn:["xs","sm","md"],children:e.jsx(u,{span:24,style:{marginTop:8},children:e.jsxs(oe,{gap:"4px 8px",align:"center",wrap:!0,children:[e.jsx(le,{title:n("Reply"),children:e.jsx(pe,{style:{margin:0},children:c.toInteger(t==null?void 0:t.reply_counter)||0})}),_e?e.jsx(pe,{color:"red",style:{margin:0},children:n("Need Reply")}):null]})})}):null]})}},{title:n("Reply"),render:t=>{const k=!c.includes(["I","C","D"],t==null?void 0:t.status)&&(t==null?void 0:t.last_replied_by_type)!=="A";return e.jsxs(X,{direction:"vertical",size:4,children:[e.jsx(pe,{style:{margin:0},children:c.toInteger(t==null?void 0:t.reply_counter)||0}),k?e.jsx(pe,{color:"red",style:{margin:0},children:n("Need Reply")}):null]})},responsive:["lg"]},{title:n("Agent"),dataIndex:"assigned_on",render:t=>{const k=t?I==null?void 0:I.find(({value:w})=>w===t):null;if(k){const w=De(k==null?void 0:k.label);return e.jsx(le,{title:w==null?void 0:w.full,children:e.jsx(ue,{style:{whiteSpace:"nowrap"},children:w==null?void 0:w.first})})}return e.jsx("span",{children:"â€”"})},responsive:["xl"]},{title:n("Date"),width:100,render:t=>e.jsxs(X,{direction:"vertical",size:4,children:[e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Replied:")}),e.jsx("span",{children:Ye(t==null?void 0:t.last_reply_time)})]}),children:e.jsx(ue,{style:{whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(Cs,{}),qe(t==null?void 0:t.last_reply_time)]})})}),e.jsx(le,{title:e.jsxs(X,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Created:")}),e.jsx("span",{children:Ye(t==null?void 0:t.opened_time)})]}),children:e.jsx(ue,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(oe,{align:"center",gap:4,children:[e.jsx(Ts,{}),qe(t==null?void 0:t.opened_time)]})})})]}),responsive:["lg"]}];W||(c.unset(m,0),c.unset(m,2),c.unset(m,3));const y=()=>{const t=d?(f-1)*_+1:0,k=c.min([t+_-1,d]),w=n("Showing %1$d - %2$d of %3$d",t,k,d);return e.jsxs(V,{gutter:16,align:"middle",justify:W?"space-between":"end",children:[W?e.jsx(u,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(V,{align:"middle",gutter:8,children:[e.jsx(u,{children:e.jsx(de,{value:b,style:{width:140},onChange:L=>S(L),options:B,disabled:!(T!=null&&T.length)})}),e.jsx(u,{children:e.jsx(St,{action:b,onConfirm:()=>re(),children:e.jsx(ee,{type:"primary",disabled:!b,onClick:()=>{(b==="edit"||b==="reply"&&!ze||b==="note"&&!ze)&&re()},children:n("Apply")})})})]})}):null,e.jsx(u,{style:{marginTop:"4px",marginBottom:"4px"},children:w})]})};return j.useEffect(()=>{var se,ce,K,Z;const{data:t,isLoading:k,isError:w,error:L}=v;R(k?Re():Ae()),!k&&w&&((ce=(se=L==null?void 0:L.data)==null?void 0:se.errors)!=null&&ce.message)&&G.error((Z=(K=L==null?void 0:L.data)==null?void 0:K.errors)==null?void 0:Z.message),!k&&!w&&t&&(t!=null&&t.msg&&(t!=null&&t.status?G.success(t==null?void 0:t.msg):G.error(t==null?void 0:t.msg)),t!=null&&t.status&&E())},[v,E,R]),e.jsx(Tt,{rowKey:t=>t==null?void 0:t.id,rowSelection:W?F:null,columns:m,dataSource:l,footer:y,loading:o,onChange:i,onRow:t=>({onClick:()=>p(t),style:{cursor:"pointer"}}),pagination:{total:d,pageSize:_,current:f,onChange:r,onShowSizeChange:h,showSizeChanger:d>10,style:{marginBottom:0}},className:"sg-tickets-table"})}const Kt=$e();function Jt({resetBulkAction:l,onCloseModal:d,bulkActionIds:_,statusSelectList:f,agentUserSelectList:r,categorySelectList:h,tagSelectList:F}){const b={assigned_on:"",cat_id:"",tag_ids:[],status:""},S=Ie(),[T]=N.useForm(),[U,o]=j.useState(""),[E,A]=Me(),B=a=>{var R,Q,M,v;const I=((R=a==null?void 0:a.assigned_on)==null?void 0:R.trim())||"",z=((Q=a==null?void 0:a.cat_id)==null?void 0:Q.trim())||"",C=((M=a==null?void 0:a.tag_ids)==null?void 0:M.map(W=>W==null?void 0:W.trim()))||[],x=((v=a==null?void 0:a.status)==null?void 0:v.trim())||"";if(!I&&!z&&!C&&!x){o(n("Invalid data."));return}E({params:{action:"ticket_bulk_edit",ids:_},data:{assigned_on:I,cat_id:z,tag_ids:C,status:x}})};return j.useEffect(()=>{var x,R,Q,M;const{data:a,isLoading:I,isError:z,error:C}=A;S(I?Re():Ae()),!I&&z&&((R=(x=C==null?void 0:C.data)==null?void 0:x.errors)!=null&&R.message)&&G.error((M=(Q=C==null?void 0:C.data)==null?void 0:Q.errors)==null?void 0:M.message),!I&&!z&&a&&(a!=null&&a.msg&&(a!=null&&a.status?(o(""),G.success(a==null?void 0:a.msg)):(o(a==null?void 0:a.msg),rs())),a!=null&&a.status&&(l(),d()))},[A,l,d,S]),e.jsx(N,{form:T,name:"quickEditTicket",layout:"vertical",onFinish:B,initialValues:b,autoComplete:"off",children:e.jsxs(V,{gutter:16,children:[U?e.jsx(u,{span:24,children:e.jsx(he,{message:U,type:"error",showIcon:!0,closable:!0,afterClose:()=>o(""),style:{marginBottom:"24px"}})}):null,e.jsx(Se,{permissions:["edit-assigned"],children:e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Assign Agent"),name:"assigned_on",children:e.jsx(de,{options:r})})})}),e.jsx(Se,{permissions:["edit-category"],children:e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Set Category"),name:"cat_id",children:e.jsx(de,{options:h})})})}),Kt?null:e.jsx(Se,{permissions:["edit-category"],children:e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Set Tag"),name:"tag_ids",children:e.jsx(de,{allowClear:!0,mode:"multiple",showSearch:!1,defaultValue:[],options:F==null?void 0:F.filter(a=>{if((a==null?void 0:a.value)!=="")return!0}),placeholder:`-- ${n("Select Tag")} --`,className:"sg-multiple-select"})})})}),e.jsx(Se,{permissions:["edit-status"],children:e.jsx(u,{span:24,children:e.jsx(N.Item,{label:n("Set Status"),name:"status",children:e.jsx(de,{options:f})})})}),e.jsx(u,{span:24,style:{textAlign:"right"},children:e.jsxs(X,{children:[e.jsx(ee,{htmlType:"button",onClick:d,children:n("Cancel")}),e.jsx(ee,{type:"primary",htmlType:"submit",loading:A==null?void 0:A.isLoading,children:n("Update")})]})})]})})}const Ht=Qs(Gs,!0,[]),Zt=l=>e.jsx(Ht,{...l}),{Text:zs}=Be,Xt=as(),Vt=$e();function vt({ticketIds:l,resetBulkAction:d,onCloseModal:_}){const f=(l==null?void 0:l.length)||0,r=[],h=["note_text"],F={note_text:""},b={note_text:""},S=Ys(),T=Ie(),[U]=N.useForm(),[o,E]=j.useState(!0),[A,B]=j.useState(""),[a,I]=Me(),z=(x,R)=>{R=c.mapValues(R,function(M){return c.isString(M)?c.trim(M):M});for(const M of r){const v=x==null?void 0:x[M];v&&c.includes(v,"*")&&(R[M]=b[M])}for(const M of h)(x==null?void 0:x[M])&&(R[M]=ye((x==null?void 0:x[M])||""));const Q=c.pick(b,c.keys(R));c.isEqual(Q,R)?E(!0):E(!1)},C=x=>{var Q;const R=ye(((Q=x==null?void 0:x.note_text)==null?void 0:Q.trim())||"");if(!R){U.setFieldValue("note_text",""),B(n("%s is not valid.",n("Content")));return}a({params:{action:"ticket_note_add_bulk",ids:l||[]},data:{note_text:R}})};return j.useEffect(()=>{var v,W,re,i;const{data:x,isLoading:R,isError:Q,error:M}=I;T(R?Re():Ae()),!R&&Q&&((W=(v=M==null?void 0:M.data)==null?void 0:v.errors)!=null&&W.message)&&G.error((i=(re=M==null?void 0:M.data)==null?void 0:re.errors)==null?void 0:i.message),!R&&!Q&&x&&(x!=null&&x.msg&&(x!=null&&x.status?(B(""),G.success(x==null?void 0:x.msg)):B(x==null?void 0:x.msg)),x!=null&&x.status&&(d(),_()))},[I,d,_,T]),e.jsx(V,{style:{marginTop:"12px"},children:e.jsx(u,{span:24,children:e.jsx(N,{form:U,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:C,onValuesChange:z,initialValues:F,children:e.jsxs(V,{children:[20<f?e.jsx(u,{span:24,children:e.jsx(he,{message:e.jsxs(X,{direction:"vertical",size:0,children:[e.jsx(zs,{style:{fontWeight:500},children:n("You've selected %d tickets to add internal note to at once.",f)}),e.jsx(zs,{children:n("For the best performance and reliability, we recommend selecting no more than 20 tickets at a time.")})]}),type:"warning",showIcon:!0,style:{marginBottom:"24px"}})}):null,A?e.jsx(u,{span:24,children:e.jsx(he,{message:A,type:"error",showIcon:!0,closable:!0,afterClose:()=>B(""),style:{marginBottom:"24px"}})}):null,e.jsx(u,{span:24,children:e.jsx(N.Item,{name:"note_text",rules:[{required:!0,message:n("%s is required.",n("Content")),whitespace:!0},{validator:(x,R)=>{const Q=ye(R||"");return!R||Q?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Content"))))}}],htmlFor:null,children:!Vt&&Xt==="quill"?e.jsx(Zt,{focus:!0,style:{background:"#ffffff"}}):e.jsx(cs,{id:"note",focus:!0})})}),e.jsx(u,{span:24,children:e.jsxs(X,{children:[e.jsx(ee,{type:"primary",htmlType:"submit",loading:!1,disabled:o,children:S.xs?n("Add Note"):n("Add Internal Note")}),e.jsx(ee,{color:"danger",variant:"text",onClick:_,children:n("Cancel")})]})})]})})})})}var Ms;const Dt=((Ms=window==null?void 0:window.support_genix_config)==null?void 0:Ms.is_master)||!1,en=Qs(Gs,!0,[],Dt),sn=l=>e.jsx(en,{...l}),{Text:Ss}=Be,{Dragger:tn}=Ee,nn=as(),rn=$e();function ln({ticketIds:l,resetBulkAction:d,onCloseModal:_,savedRepliesData:f,fileSettingsData:r,basicSettings:h}){const F=(l==null?void 0:l.length)||0,b=[],S=["reply_text"],T={reply_text:"",close:!1},U={reply_text:"",close:!1},o=Ie(),[E]=N.useForm(),[A,B]=j.useState([]),[a,I]=j.useState(!0),[z,C]=j.useState(""),[x,R]=at(),Q=(h==null?void 0:h.is_master)||!1,M=(p,m)=>{c.unset(m,"attached"),m=c.mapValues(m,function(t){return c.isString(t)?c.trim(t):t});for(const t of b){const k=p==null?void 0:p[t];k&&c.includes(k,"*")&&(m[t]=U[t])}for(const t of S)(p==null?void 0:p[t])&&(m[t]=ye((p==null?void 0:p[t])||""));const y=c.pick(U,c.keys(m));c.isEqual(y,m)?I(!0):I(!1)},v=p=>{var k;const m=ye(((k=p==null?void 0:p.reply_text)==null?void 0:k.trim())||""),y=Q&&(p!=null&&p.close)?"Y":"N";if(!m){E.setFieldValue("reply_text",""),C(n("%s is not valid.",n("Content")));return}const t=new FormData;t.append("ticket_ids",l||[]),t.append("is_private","N"),t.append("reply_text",m),t.append("close",y),A.forEach(w=>{t.append("attached[]",w.originFileObj)}),x({params:{action:"ticket_reply_add_bulk"},data:t,headers:{"Content-Type":"multipart/form-data"}})},W=p=>{const m=p.size,y=p.type,t=Ge(r==null?void 0:r.file_upload_size);return We(r==null?void 0:r.allowed_type).includes(y)?m>t?(G.error(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB")),Ee.LIST_IGNORE):!0:(G.error(n("Invalid file type.")),Ee.LIST_IGNORE)},re=({fileList:p,file:m})=>{const y=m.size,t=m.type,k=Ge(r==null?void 0:r.file_upload_size);if(!We(r==null?void 0:r.allowed_type).includes(t)){G.error(n("Invalid file type."));return}if(y>k){G.error(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB"));return}B(p)},i=p=>{const m=A.indexOf(p),y=A.slice().splice(m,1);B(y)};return j.useEffect(()=>{var k,w,L,se;const{data:p,isLoading:m,isError:y,error:t}=R;o(m?Re():Ae()),!m&&y&&((w=(k=t==null?void 0:t.data)==null?void 0:k.errors)!=null&&w.message)&&G.error((se=(L=t==null?void 0:t.data)==null?void 0:L.errors)==null?void 0:se.message),!m&&!y&&p&&(p!=null&&p.msg&&(p!=null&&p.status?(C(""),G.success(p==null?void 0:p.msg),B([])):C(p==null?void 0:p.msg)),p!=null&&p.status&&(d(),_()))},[R,d,_,o]),e.jsx(V,{children:e.jsx(u,{span:24,children:e.jsx(N,{form:E,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:v,onValuesChange:M,initialValues:T,children:e.jsxs(V,{children:[20<F?e.jsx(u,{span:24,children:e.jsx(he,{message:e.jsxs(X,{direction:"vertical",size:0,children:[e.jsx(Ss,{style:{fontWeight:500},children:n("You've selected %d tickets to reply to at once.",F)}),e.jsx(Ss,{children:n("For the best performance and reliability, we recommend selecting no more than 20 tickets at a time.")})]}),type:"warning",showIcon:!0,style:{marginBottom:"24px"}})}):null,z?e.jsx(u,{span:24,children:e.jsx(he,{message:z,type:"error",showIcon:!0,closable:!0,afterClose:()=>C(""),style:{marginBottom:"24px"}})}):null,e.jsx(u,{span:24,children:e.jsx(N.Item,{name:"reply_text",rules:[{required:!0,message:n("%s is required.",n("Content")),whitespace:!0},{validator:(p,m)=>{const y=ye(m||"");return!m||y?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Content"))))}}],htmlFor:null,children:!rn&&nn==="quill"?e.jsx(sn,{focus:!0,savedReplies:f,style:{background:"#ffffff"}}):e.jsx(cs,{id:"reply",focus:!0,savedReplies:f})})}),r!=null&&r.ticket_file_upload?e.jsx(u,{span:24,children:e.jsx(N.Item,{name:"attached",children:e.jsx(tn,{multiple:!0,name:"attached",fileList:A,onChange:re,onRemove:i,beforeUpload:W,accept:qs((r==null?void 0:r.allowed_type)||[],!0,!0),children:e.jsxs(oe,{align:"center",justify:"center",gap:4,wrap:!0,children:[e.jsx(Os,{}),n("Click or drag file to upload")]})})})}):null,e.jsx(u,{span:24,hidden:!0,children:e.jsx(N.Item,{name:"close",valuePropName:"checked",hidden:!0,children:e.jsx(Qe,{})})}),e.jsx(u,{span:24,children:e.jsxs(X,{children:[e.jsx(ee,{color:"primary",variant:"solid",disabled:a,onClick:()=>{E.setFieldValue("close",!1),E.submit()},children:n("Submit Reply")}),Q?e.jsx(Fe,{hideOn:["xs"],children:e.jsx(Ft,{title:n("Reply and close ticket"),description:n("Are you sure want to submit reply and close ticket?"),onConfirm:()=>{E.setFieldValue("close",!0),E.submit()},okText:n("Yes"),cancelText:n("No"),icon:e.jsx(Ps,{style:{color:"#faad14"}}),overlayStyle:{maxWidth:"300px"},children:e.jsx(ee,{color:"danger",variant:"solid",disabled:a,children:n("Submit & Close Ticket")})})}):null,e.jsx(ee,{color:"danger",variant:"text",onClick:_,children:n("Cancel")})]})})]})})})})}const on=()=>{const l=window==null?void 0:window.localStorage,{hasAnyPermission:d}=ls(),{getBasicSettings:_}=is(),f=_(),r=(f==null?void 0:f.is_master)||!1;return(h,F,b,S=[],T=null)=>{var U;if(l){const o=JSON.parse(l==null?void 0:l.getItem("sgenixfefilter"));if(!c.isEmpty(o)&&c.has(o,b?b+"."+h:h)){let E=b?(U=o==null?void 0:o[b])==null?void 0:U[h]:o==null?void 0:o[h];c.isUndefined(E)||(E=c.isString(F)?c.trim(c.toString(E)):c.isNumber(F)?c.toNumber(E):E,c.isEmpty(S)&&(h==="tkt-type"&&(r?(d(["trash-ticket-menu"])||S.push("D"),d(["manage-unassigned-ticket"])||S.push("UA")):(S.push("MY"),S.push("UA"),S.push("D"))),h==="sub-type"&&(d(["closed-ticket-list"])||S.push("C"))),E&&(c.isEmpty(S)||!(S!=null&&S.includes(E)))&&(F=E))}}return T&&c.isFunction(T)&&(F=T(F)),F}},cn=()=>{const l=window==null?void 0:window.localStorage;return(d,_,f,r=null)=>{if(l){r&&typeof r=="function"&&(_=r(_));const h=JSON.parse(l==null?void 0:l.getItem("sgenixfefilter"))||{};f?(h[f]=h[f]||{},h[f][d]=_):h[d]=_,l.setItem("sgenixfefilter",JSON.stringify(h))}}},{Content:an}=Us,{Search:pn}=ge,{Text:Ws}=Be;var $s;const je=(($s=window==null?void 0:window.support_genix_config)==null?void 0:$s.lite)||!1,dn=ht(),un=[{key:"T",label:n("All Tickets"),icon:e.jsx(Bt,{})},{key:"MY",label:n("My Tickets"),icon:e.jsx(ns,{})},{key:"UA",label:n("Unassigned"),icon:e.jsx(Lt,{})},{key:"D",label:n("Trashed"),icon:e.jsx(zt,{})}],hn=[{value:"A",label:n("Active")},{value:"I",label:n("Inactive")},{value:"C",label:n("Closed")},{value:"ST",label:n("All")}],xn=[{value:"last_reply_time-desc",label:n("Sort: Reply Date (Newest First)")},{value:"last_reply_time-asc",label:n("Sort: Reply Date (Oldest First)")},{value:"opened_time-desc",label:n("Sort: Opening Date (Newest First)")},{value:"opened_time-asc",label:n("Sort: Opening Date (Oldest First)")}],mn=[{value:"",label:n("Bulk Actions")},{value:"edit",label:n("Quick Edit")},{value:"reply",label:n("Quick Reply")},{value:"note",label:n("Quick Note")},{value:"trash",label:n("Move to Trash")},{value:"restore",label:n("Restore")},{value:"remove",label:n("Delete")}],jn=[{value:"0",label:n("All Agents")}],fn=[{value:"0",label:n("All Categories")}],gn=[{value:"0",label:n("All Categories")}],yn=[{value:"0",label:n("All Tags")}],fe=(l,d="")=>(l=c.cloneDeep(l),l=c.filter(l,({value:_})=>_!=="0"),d&&l.unshift({value:"",label:d}),l),es=(l,d,_,f,r)=>e.jsx(V,{children:e.jsx(u,{span:24,style:{padding:"4px 0"},children:e.jsxs(V,{gutter:8,wrap:!1,children:[e.jsx(u,{flex:"none",children:e.jsx(Ws,{children:1<((l==null?void 0:l.length)||0)?f:r})}),e.jsx(u,{flex:"auto",children:e.jsx(oe,{gap:"4px 8px",wrap:!0,children:l==null?void 0:l.map(h=>{var F;return e.jsx(pe,{closeIcon:!0,onClose:()=>{_(c.without(l,h))},style:{margin:0},children:((F=d==null?void 0:d.find(b=>b.value===h))==null?void 0:F.label)||h},h)})})})]})})});function En(){const l=Ys(),{hasAnyPermission:d}=ls(),{getBasicSettings:_}=is(),f=cn(),r=on(),[h,F]=j.useState(r("tkt-type","T","tickets")),[b,S]=j.useState(r("sub-type","A","tickets")),[T,U]=j.useState(r("category","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[o,E]=j.useState(r("tag","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[A,B]=j.useState(r("agent","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[a,I]=j.useState(r("limit",20,"tickets")),[z,C]=j.useState(r("page",1,"tickets")),[x,R]=j.useState(r("sort","last_reply_time-desc","tickets")),[Q,M]=j.useState(r("search","","tickets")),[v,W]=j.useState(r("search","","tickets")),[re,i]=j.useState(r("need-reply","N","tickets")),[p,m]=j.useState(""),[y,t]=j.useState([]),[k,w]=j.useState(""),[L,se]=j.useState(!1),[ce,K]=j.useState(n("Add New %s",n("Ticket"))),[Z,Y]=j.useState(0),[$,O]=j.useState([]),[Le,_e]=j.useState([]),[xe,ke]=j.useState(jn),[be,Ne]=j.useState(fn),[D,Je]=j.useState(gn),[Oe,Ks]=j.useState(yn),[ps,Js]=j.useState(null),me=_(),Hs=(me==null?void 0:me.cannedMsg)||[],ae=(me==null?void 0:me.is_master)||!1,ds=ae?c.includes(["D"],h)||c.includes(["I","C"],b):!0,we=bs({action:"ticket_data",tkt_type:h,sub_type:b,category:T,tag:o,agent:A,search:Q,need_reply:re,limit:a,page:z,sort:x||"last_reply_time-desc"}),us=bs({action:"ticket_status_for_select"}),hs=pt({action:"role_agent_for_select",select_all:!0}),xs=ks({action:"ticket_category_data_for_select",select_all:!0}),ms=ks({action:"ticket_category_data_for_select",select_all:!0,has_role:!je&&ae||void 0}),js=dt({action:"ticket_tag_data_for_select",select_all:!0}),fs=ut({action:"settings_data_file"}),Zs=s=>{C(1),F(s),f("page",1,"tickets"),f("tkt-type",s,"tickets"),te()},gs=s=>{const g=h==="D"?"ST":s.target.value||"A";C(1),S(g),f("page",1,"tickets"),f("sub-type",g,"tickets"),te()},He=s=>{C(1),i(s),f("page",1,"tickets"),f("need-reply",s,"tickets"),te()},ys=s=>{s=(s==null?void 0:s.trim())||"",C(1),M(s),W(s),f("page",1,"tickets"),f("search",s,"tickets"),te()},Ze=s=>{C(1),U(s),f("page",1,"tickets"),f("category",(s==null?void 0:s.join(","))||"","tickets"),te()},Xe=s=>{C(1),E(s),f("page",1,"tickets"),f("tag",(s==null?void 0:s.join(","))||"","tickets"),te()},Ve=s=>{C(1),B(s),f("page",1,"tickets"),f("agent",(s==null?void 0:s.join(","))||"","tickets"),te()},_s=s=>{C(1),R(s),f("page",1,"tickets"),f("sort",s,"tickets"),te()},te=j.useCallback(()=>{m(""),t([])},[]),Xs=s=>{C(s),f("page",s,"tickets"),te()},Vs=(s,g)=>{I(g),f("limit",g,"tickets"),te()},vs={selectedRowKeys:y,onChange:s=>{s!=null&&s.length||te(),t(s)}},Ds=s=>{w(s),se(!0)},Ce=j.useCallback(()=>{w(""),se(!1)},[]),et=()=>{we.refetch(),te()},st=()=>{gs({target:{value:h==="D"?"ST":"A"}}),ys(""),Ze([]),Xe([]),Ve([]),He("N"),_s("last_reply_time-desc"),te()},tt=()=>{let s=un;return ae?(d(["trash-ticket-menu"])||(s=c.filter(s,function(g){return g.key!=="D"})),d(["manage-unassigned-ticket"])||(s=c.filter(s,function(g){return g.key!=="UA"}))):s=c.filter(s,function(g){return g.key==="T"}),s},nt=()=>{let s=hn;return d(["closed-ticket-list"])||(s=c.filter(s,function(g){return g.value!=="C"})),h==="D"&&(s=c.map(s,function(g){const P=c.cloneDeep(g);return P.value!=="ST"&&(P.disabled=!0),P})),s},it=()=>{let s=[];return ae?h==="D"?(s=["edit","reply","note","trash"],d(["restore-ticket"])||s.push("restore"),d(["delete-ticket"])||s.push("remove")):(s=["restore"],d(["edit-assigned","edit-category","edit-status"])||s.push("edit"),d(["ticket-reply"])||s.push("reply"),d(["create-note"])||s.push("note"),d(["move-to-trash"])||s.push("trash"),d(["delete-ticket"])||s.push("remove")):s=["edit","reply","note","trash","restore","remove"],je&&(s=["reply","note",...s]),c.filter(mn,function(P){return!c.includes(s,P.value||"")})},rt=()=>{let s=!0;return s&&(s=h==="D"||b==="A"),s&&(s=Q===""),s&&(s=!(T!=null&&T.length)),s&&(s=je||!ae||!(o!=null&&o.length)),s&&(s=!ae||!d(["manage-other-agents-ticket"])||c.includes(["MY","UA"],h)||!(A!=null&&A.length)),s&&(s=ds||re==="N"),s&&(s=x==="last_reply_time-desc"),s};j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=we;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&(O((ne=s==null?void 0:s.data)==null?void 0:ne.rowdata),Y(((ie=s==null?void 0:s.data)==null?void 0:ie.total)||0))},[we]),j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=us;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&s!=null&&s.status&&(ne=s==null?void 0:s.data)!=null&&ne.result&&_e((ie=s==null?void 0:s.data)==null?void 0:ie.result)},[us]),j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=hs;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&s!=null&&s.status&&(ne=s==null?void 0:s.data)!=null&&ne.result&&ke((ie=s==null?void 0:s.data)==null?void 0:ie.result)},[hs]),j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=xs;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&s!=null&&s.status&&(ne=s==null?void 0:s.data)!=null&&ne.result&&Ne((ie=s==null?void 0:s.data)==null?void 0:ie.result)},[xs]),j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=ms;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&s!=null&&s.status&&(ne=s==null?void 0:s.data)!=null&&ne.result&&Je((ie=s==null?void 0:s.data)==null?void 0:ie.result)},[ms]),j.useEffect(()=>{var J,H,ne,ie;const{data:s,isFetching:g,isError:P,error:q}=js;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&s!=null&&s.status&&(ne=s==null?void 0:s.data)!=null&&ne.result&&Ks((ie=s==null?void 0:s.data)==null?void 0:ie.result)},[js]),j.useEffect(()=>{var J,H;const{data:s,isFetching:g,isError:P,error:q}=fs;!g&&P&&G.error((H=(J=q==null?void 0:q.data)==null?void 0:J.errors)==null?void 0:H.message),!g&&!P&&s&&Js((s==null?void 0:s.data)||{})},[fs]);let Pe=ce,Ue=e.jsx(Qt,{isOpen:L,setCreateTitle:K,onCloseModal:Ce,categorySelectList:fe(be,`-- ${n("Select Category")} --`),fileSettingsData:ps,basicSettings:me});return k==="edit"?(Pe=n("Quick Edit"),Ue=e.jsx(Jt,{isOpen:L,resetBulkAction:te,onCloseModal:Ce,bulkActionIds:y,statusSelectList:fe(Le,`-- ${n("Select Status")} --`),agentUserSelectList:fe(xe,`-- ${n("Select Agent")} --`),categorySelectList:fe(be,`-- ${n("Select Category")} --`),tagSelectList:fe(Oe,`-- ${n("Select Tag")} --`)})):k==="reply"&&!je?(Pe=n("Quick Reply"),Ue=e.jsx(ln,{ticketIds:y,resetBulkAction:te,onCloseModal:Ce,savedRepliesData:Hs,fileSettingsData:ps})):k==="note"&&!je&&(Pe=n("Quick Note"),Ue=e.jsx(vt,{ticketIds:y,resetBulkAction:te,onCloseModal:Ce})),e.jsxs(e.Fragment,{children:[e.jsx(Us,{style:{background:"transparent",minHeight:dn?"auto":"calc(100vh - 150px)"},children:e.jsxs(an,{style:{padding:"8px 16px 16px 16px"},children:[e.jsx(V,{children:e.jsx(u,{span:24,children:e.jsx(Et,{tabBarExtraContent:e.jsxs(X,{size:16,children:[e.jsxs(X,{children:[e.jsx(ee,{type:"primary",icon:e.jsx(It,{}),onClick:et,ghost:!0}),!ae||d(["create-ticket"])?e.jsx(e.Fragment,{children:l!=null&&l.lg||l!=null&&l.xl||l!=null&&l.xxl?e.jsx(ee,{type:"primary",icon:e.jsx(ts,{}),onClick:()=>{se(!0)},children:n("Add Ticket")}):e.jsx(ee,{type:"primary",icon:e.jsx(ts,{}),onClick:()=>{se(!0)}})}):null]}),e.jsx($t,{})]}),items:tt(),activeKey:h,defaultActiveKey:h,onChange:Zs,animated:!1,style:{margin:"0 0 16px 0"}})})}),e.jsx(V,{className:"support-genix-portal-tickets-filter-row",children:e.jsx(u,{span:24,className:"support-genix-portal-tickets-filter-col",children:e.jsxs(os,{size:"small",styles:{body:{background:"#fafafa",padding:"8px 12px"}},style:{margin:"0 0 32px 0"},className:"support-genix-portal-tickets-filter-card",children:[e.jsxs(V,{gutter:8,align:"middle",children:[e.jsx(u,{xs:{order:1},lg:{order:1},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(Ns.Group,{options:nt(),onChange:gs,value:h!=="D"?b:"ST",defaultValue:h!=="D"?b:"ST",optionType:"button",buttonStyle:"solid"})}),ds?null:e.jsx(u,{xs:{order:3},lg:{order:2},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsxs(X,{align:"center",children:[e.jsx(Qe,{size:"small",value:re==="Y",onChange:()=>{He(re==="Y"?"N":"Y")}}),e.jsx(Ws,{onClick:()=>{He(re==="Y"?"N":"Y")},style:{cursor:"pointer"},children:n("Need Reply")})]})}),e.jsx(Fe,{showOn:["lg","xl","xxl"],children:e.jsx(u,{lg:{order:3},flex:"auto"})}),e.jsx(u,{xs:{order:2},lg:{order:4},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(pn,{enterButton:!0,allowClear:!0,value:v,onChange:s=>{var g;return W(((g=s==null?void 0:s.target)==null?void 0:g.value)||"")},defaultValue:Q,placeholder:n("Search keyword"),onSearch:ys})})]}),e.jsx(Fs,{style:{margin:"8px 0"}}),e.jsxs(V,{gutter:8,align:"middle",children:[e.jsx(u,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(de,{allowClear:!0,mode:"multiple",showSearch:!1,value:T,defaultValue:[],onChange:Ze,options:fe(D),maxTagCount:0,placeholder:n("All Categories"),maxTagPlaceholder:s=>{const g=(s==null?void 0:s.length)||0;return 1<g?n("%d Categories",g||0):n("%d Categor",g||0)},style:{width:"auto",minWidth:"150px"},className:"sg-multiple-select"})}),ae?e.jsxs(e.Fragment,{children:[je?null:e.jsx(u,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(de,{allowClear:!0,mode:"multiple",showSearch:!1,value:o,defaultValue:[],onChange:Xe,options:fe(Oe),maxTagCount:0,placeholder:n("All Tags"),maxTagPlaceholder:s=>{const g=(s==null?void 0:s.length)||0;return 1<g?n("%d Tags",g||0):n("%d Tag",g||0)},style:{width:"auto",minWidth:"130px"},className:"sg-multiple-select"})}),e.jsx(Se,{permissions:["manage-other-agents-ticket"],children:c.includes(["MY","UA"],h)?null:e.jsx(u,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(de,{allowClear:!0,mode:"multiple",showSearch:!1,value:A,defaultValue:[],onChange:Ve,options:fe(xe),maxTagCount:0,placeholder:n("All Agents"),maxTagPlaceholder:s=>{const g=(s==null?void 0:s.length)||0;return 1<g?n("%d Agents",g||0):n("%d Agent",g||0)},style:{width:"auto",minWidth:"140px"},className:"sg-multiple-select"})})})]}):null,e.jsx(u,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(de,{value:x,defaultValue:"last_reply_time-desc",onChange:_s,options:xn,style:{width:"270px",maxWidth:"100%"}})}),e.jsx(Fe,{showOn:["lg","xl","xxl"],children:e.jsx(u,{flex:"auto"})}),e.jsx(u,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(ee,{icon:e.jsx(Rt,{}),color:"danger",variant:"outlined",onClick:st,disabled:rt(),children:n("Reset Filters")})})]}),!c.isEmpty(T)||!je&&ae&&!c.isEmpty(o)||ae&&!c.isEmpty(A)&&!c.includes(["MY","UA"],h)&&d(["manage-other-agents-ticket"])?e.jsxs(e.Fragment,{children:[e.jsx(Fs,{style:{margin:"8px 0"}}),e.jsxs(oe,{gap:"0 16px",wrap:!0,children:[c.isEmpty(T)?null:es(T,be,Ze,n("Categories:"),n("Category:")),!je&&ae&&!c.isEmpty(o)?es(o,Oe,Xe,n("Tags:"),n("Tag:")):null,ae&&!c.isEmpty(A)&&!c.includes(["MY","UA"],h)&&d(["manage-other-agents-ticket"])?es(A,xe,Ve,n("Agents:"),n("Agent:")):null]})]}):null]})})}),e.jsx(Wt,{data:$,total:Z,limit:a,page:z,onPageChange:Xs,onSizeChange:Vs,rowSelection:vs,bulkAction:p,setBulkAction:m,bulkActionIds:y,onActionClick:Ds,isLoading:we==null?void 0:we.isFetching,resetBulkAction:te,sortOrder:x,bulkActionList:it(),statusSelectList:Le,agentUserSelectList:xe,categorySelectList:be,tagSelectList:Oe,basicSettings:me})]})}),e.jsx(At,{title:Pe,centered:!0,open:L,onCancel:Ce,onClose:Ce,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},styles:k==="note"?{content:{backgroundColor:"#fffbe6"},header:{background:"#fffbe6"}}:{},destroyOnClose:!0,children:Ue})]})}export{En as default};
