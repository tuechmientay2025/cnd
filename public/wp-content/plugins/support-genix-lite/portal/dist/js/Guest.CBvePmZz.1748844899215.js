import{u as Ie,j as s,b as Ae,p as He,_ as m,s as Pe,d as Ve,q as ue,r as W,v as We,t,o as Oe}from"../main.DB7J0o3m.1748844899215.js";import{c as k,d as U,s as O,L as Ce,F as $,R as E,C as p,f as $e,I as De,Q as me,w as he,B as z,ai as _e,ad as Qe,m as D,x as Je,e as Q,i as F,j as xe,k as je,h as J,l as Ke,n as K,T as Xe,U as X,o as ye}from"./antd.tbETyFFE.1748844899215.js";import{i as Ze,r as Y}from"./vendor.B47oQPyY.1748844899215.js";import{h as ve,u as es}from"./useReCaptcha.DL7F4TyT.1748844899215.js";import{t as ge,T as ss,g as ts,a as rs,i as is,c as be,b as fe}from"./withQuillEditorConfig.VGjlY2Aq.1748844899215.js";import{w as we,Q as ns}from"./QuillEditor.BISWwr2A.1748844899215.js";import"./toast.C9WEee-3.1748844899215.js";const{Content:as}=Ce,{Text:S,Title:ke}=Xe,{Dragger:ls}=X,os=rs(),Te=is(),A=Oe(),H="YYYY-MM-DD",xs=()=>{const{getBasicSettings:B}=Ie(),R=B(),b=R==null?void 0:R.captcha;return b.status?s.jsxs(s.Fragment,{children:[b!=null&&b.hide_badge?s.jsx("style",{children:".grecaptcha-badge {visibility: hidden !important;}"}):null,s.jsx(ve,{reCaptchaKey:b.site_key,scriptProps:{async:!1,defer:!1,appendTo:"head",nonce:void 0},children:s.jsx(Fe,{})})]}):s.jsx(Fe,{})};function Fe(){var ne,ae;const B=Ae(),R=Ze(),[b]=k.useForm(),[Ee,Be]=Y.useState(""),[M,Z]=Y.useState([]),{getBasicSettings:Re}=Ie(),{handleReCaptchaVerify:qe}=es(),[v,I]=Y.useState(""),[Ne,ee]=Y.useState(""),[Le,q]=He(),a=Re(),P=(a==null?void 0:a.disable_registration_form)!=="Y"&&(a==null?void 0:a.disable_guest_ticket_creation)!=="Y",se=a==null?void 0:a.captcha,l=a==null?void 0:a.file_upload,ze=a==null?void 0:a.categories,N=((ne=a==null?void 0:a.custom_fields)==null?void 0:ne.reg_form)||[],te={};for(const e of N){const r=(e==null?void 0:e.field_type)||"",n=(e==null?void 0:e.input_name)||"",i=(e==null?void 0:e.field_value)||"";if(r==="E")continue;let o=i;r==="N"?o=i?m.toNumber(i):"":r==="D"?o=i?U(i):"":r==="S"?o=i?!!i:!1:o=m.trim(i),te[n]=o}const L=((ae=a==null?void 0:a.custom_fields)==null?void 0:ae.ticket_form)||[],re={};for(const e of L){const r=(e==null?void 0:e.field_type)||"",n=(e==null?void 0:e.input_name)||"",i=(e==null?void 0:e.field_value)||"";if(r==="E")continue;let o=i;r==="N"?o=i?m.toNumber(i):"":r==="D"?o=i?U(i):"":r==="S"?o=i?!!i:!1:o=m.trim(i),re[n]=o}const Ye={...te,...re,email:"",first_name:"",last_name:"",cat_id:"",is_public:!1},ie=e=>{m.has(e,"cat_id")&&Be((e==null?void 0:e.cat_id)||"")},Me=async e=>{var y,le,oe,ce,de,pe;const r=((y=e==null?void 0:e.email)==null?void 0:y.trim())||"",n=((le=e==null?void 0:e.first_name)==null?void 0:le.trim())||"",i=((oe=e==null?void 0:e.last_name)==null?void 0:oe.trim())||"",o=((ce=e==null?void 0:e.cat_id)==null?void 0:ce.trim())||"0",g=((de=e==null?void 0:e.title)==null?void 0:de.trim())||"",x=ge(((pe=e==null?void 0:e.ticket_body)==null?void 0:pe.trim())||""),T=e!=null&&e.is_public?"Y":"N";if(!x){b.setFieldValue("ticket_body",""),I(t("%s is not valid.",t("Description")));return}let C="";if(se.status&&se.on_create_ticket&&(C=await qe(),!C)){O.error(t("reCAPTCHA verification failed"));return}const f={email:r,first_name:n,last_name:i},c={};for(const u in e){const h=N.find(w=>(w==null?void 0:w.input_name)===u);if(h&&(m.has(h,"is_editable")?(h==null?void 0:h.is_editable)||!1:!0)){const G=(h==null?void 0:h.field_type)||"";G==="N"?c[u]=m.toString(e[u]):G==="D"?c[u]=U(e[u]).format(H):G==="S"?c[u]=e[u]?1:0:c[u]=m.trim(e[u])}}f.custom_fields=c;const _={cat_id:o,title:g,ticket_body:x,is_public:T},j={};for(const u in e){const h=L.find(w=>(w==null?void 0:w.input_name)===u);if(h){const w=(h==null?void 0:h.categories)||"";if(!m.isEmpty(w)&&!m.includes(w,o)&&!m.includes(w,"0"))return null;if(m.has(h,"is_editable")?(h==null?void 0:h.is_editable)||!1:!0){const V=(h==null?void 0:h.field_type)||"";V==="N"?j[u]=m.toString(e[u]):V==="D"?j[u]=U(e[u]).format(H):V==="S"?j[u]=e[u]?1:0:j[u]=m.trim(e[u])}}}_.custom_fields=j;const d=new FormData;d.append("grcToken,",C),d.append("user",JSON.stringify(f)),d.append("ticket",JSON.stringify(_)),M.forEach(u=>{d.append("attached[]",u.originFileObj)}),Le({params:{action:"users_add_guest"},data:d,headers:{"Content-Type":"multipart/form-data"}})},Ge=e=>{const r=e.size,n=e.type,i=be(l==null?void 0:l.file_upload_size);return fe(l==null?void 0:l.allowed_type).includes(n)?r>i?(I(t("File size must be smaller than %s.",((l==null?void 0:l.file_upload_size)||2)+" MB")),X.LIST_IGNORE):!0:(I(t("Invalid file type.")),X.LIST_IGNORE)},Ue=({fileList:e,file:r})=>{const n=r.size,i=r.type,o=be(l==null?void 0:l.file_upload_size);if(!fe(l==null?void 0:l.allowed_type).includes(i)){I(t("Invalid file type."));return}if(n>o){t("File size must be smaller than %s.",((l==null?void 0:l.file_upload_size)||2)+" MB");return}Z(e)},Se=e=>{const r=M.indexOf(e),n=M.slice().splice(r,1);Z(n)};return Y.useEffect(()=>{var o,g,x,T;const{data:e,isLoading:r,isError:n,error:i}=q;B(r?Pe():Ve()),!r&&n&&((g=(o=i==null?void 0:i.data)==null?void 0:o.errors)!=null&&g.message)&&O.error((T=(x=i==null?void 0:i.data)==null?void 0:x.errors)==null?void 0:T.message),!r&&!n&&e&&(e!=null&&e.msg&&(e!=null&&e.status?(I(""),O.success(e==null?void 0:e.msg)):(I(e==null?void 0:e.msg),ue())),e!=null&&e.status&&(b.resetFields(),ee(!0),ue()))},[q,R,B,b]),s.jsx(Ce,{style:{background:"transparent",minHeight:A?"auto":"calc(100vh - 48px)",padding:"8px 0"},children:s.jsx(as,{style:{padding:"0 8px"},children:s.jsx($,{vertical:!0,justify:"center",align:"center",style:{minHeight:A?"auto":"calc(100vh - 64px)"},children:s.jsx(E,{justify:"space-around",style:{width:"100%"},children:s.jsx(p,{span:24,style:{maxWidth:"620px"},children:s.jsx(E,{children:s.jsx(p,{span:24,children:s.jsxs($e,{size:"small",styles:{header:{background:"#fafafa"},body:{padding:"24px"}},style:{width:"100%"},children:[s.jsxs(E,{children:[A?null:s.jsx(p,{span:24,style:{textAlign:"center",marginBottom:"24px"},children:s.jsx("a",{href:W(),style:{display:"inline-block",lineHeight:0},children:s.jsx(De,{src:We(),preview:!1,width:"auto",height:34})})}),s.jsxs(p,{span:24,children:[A?null:s.jsx(me,{style:{margin:"0 0 12px 0"}}),s.jsxs(E,{gutter:16,justify:"space-between",align:"middle",style:{marginBottom:"4px"},children:[s.jsx(p,{style:{paddingBottom:"8px"},children:P?s.jsx(s.Fragment,{children:s.jsxs($,{gap:"0 8px",wrap:!0,children:[s.jsx(he,{title:t("Home"),children:s.jsx(z,{href:W(),icon:s.jsx(_e,{})})}),s.jsx(z,{href:"#/register",icon:s.jsx(Qe,{}),children:"Register"})]})}):s.jsx(ke,{level:5,style:{fontSize:"16px",margin:0},children:t("Create Ticket as a Guest")})}),s.jsx(p,{style:{paddingBottom:"8px"},children:s.jsxs(D,{children:[(a==null?void 0:a.disable_guest_ticket_creation)!=="Y"?s.jsx(z,{color:"primary",variant:"outlined",href:"#/login",icon:s.jsx(Je,{}),children:t("Returning User? Login")}):null,P?null:s.jsx(he,{title:t("Home"),children:s.jsx(z,{href:W(),icon:s.jsx(_e,{})})})]})})]}),s.jsx(me,{style:{margin:"0 0 24px 0"}})]})]}),s.jsxs(E,{children:[!Te&&we?s.jsx(p,{span:24,children:s.jsx(Q,{message:we,type:"warning",style:{marginBottom:"24px"}})}):null,P?s.jsx(p,{span:24,children:s.jsx(ke,{level:5,style:{fontSize:"16px",margin:"0 0 24px 0"},children:t("Create Ticket as a Guest")})}):null,s.jsx(p,{span:24,children:s.jsx(k,{form:b,name:"guestTicket",layout:"vertical",onFinish:Me,onValuesChange:ie,initialValues:Ye,autoComplete:"off",children:s.jsxs(E,{gutter:16,children:[v?s.jsx(p,{span:24,children:s.jsx(Q,{message:v,type:"error",showIcon:!0,closable:!0,afterClose:()=>I(""),style:{marginBottom:"24px"}})}):null,Ne?s.jsx(p,{span:24,children:s.jsx(Q,{message:s.jsx(s.Fragment,{children:s.jsxs(S,{children:[t("Success! Your ticket has been created."),s.jsx("br",{}),t("Our support team will review it and respond soon."),s.jsx("br",{}),t("Thank you for reaching out!")]})}),type:"success",showIcon:!1,closable:!0,afterClose:()=>ee(!1),style:{marginBottom:"24px"}})}):null,s.jsx(p,{span:12,children:s.jsx(k.Item,{label:t("First Name"),name:"first_name",rules:[{required:!0,message:t("%s is required.",t("First name")),whitespace:!0}],children:s.jsx(F,{})})}),s.jsx(p,{span:12,children:s.jsx(k.Item,{label:t("Last Name"),name:"last_name",rules:[{required:!0,message:t("%s is required.",t("Last name")),whitespace:!0}],children:s.jsx(F,{})})}),s.jsx(p,{span:24,children:s.jsx(k.Item,{label:t("Email Address"),name:"email",rules:[{required:!0,message:t("%s is required.",t("Email address")),whitespace:!0}],children:s.jsx(F,{})})}),N==null?void 0:N.map(e=>{const r=(e==null?void 0:e.field_type)||"",n=(e==null?void 0:e.input_name)||"",i=(e==null?void 0:e.field_label)||"",o=(e==null?void 0:e.field_value)||"",g=(e==null?void 0:e.fld_option)||"",x=(e==null?void 0:e.help_text)||"",T=(e==null?void 0:e.is_required)==="Y",C=(e==null?void 0:e.is_half_field)==="Y",f=m.has(e,"is_editable")?(e==null?void 0:e.is_editable)||!1:!0;let c=[];n==="wc_store_id"?c=g==null?void 0:g.map(d=>({value:m.toString(d==null?void 0:d.id),label:d==null?void 0:d.title})):c=g?g.split(",").map(d=>({value:d,label:d})):[],r==="W"&&!c.find(d=>(d==null?void 0:d.value)===o)&&(c=[{value:"",label:`-- ${t("Select")} ---`},...c]);let _=null;r==="T"?_=s.jsx(F,{placeholder:x,disabled:!f}):r==="N"?_=s.jsx(ye,{placeholder:x,disabled:!f,style:{width:"100%"}}):r==="D"?_=s.jsx(xe,{placeholder:x||t("Select date"),format:H,disabled:!f,style:{width:"100%"}}):r==="S"?_=s.jsx(K,{disabled:!f}):r==="R"?_=s.jsx(je.Group,{options:c,disabled:!f}):r==="W"?_=s.jsx(J,{placeholder:x||t("Select option"),options:c,disabled:!f,style:{width:"100%"}}):r==="U"&&(_=s.jsx(F,{disabled:!f}));const j={};return r==="R"&&(j.htmlFor=null),s.jsx(p,{span:C?12:24,children:r==="E"?s.jsx(S,{style:{display:"block",marginBottom:"24px"},children:g}):s.jsx(k.Item,{label:i,name:n,rules:[{required:!!(f&&T),message:t("This field is required.")}],...j,children:_})},n)}),s.jsx(p,{span:24,children:s.jsx(k.Item,{label:t("Category"),name:"cat_id",children:s.jsx(J,{options:ze})})}),s.jsx(p,{span:24,children:s.jsx(k.Item,{label:t("Subject"),name:"title",rules:[{required:!0,message:t("%s is required.",t("Subject")),whitespace:!0}],children:s.jsx(F,{})})}),L==null?void 0:L.map(e=>{const r=(e==null?void 0:e.categories)||"";if(!m.isEmpty(r)&&!m.includes(r,Ee)&&!m.includes(r,"0"))return null;const n=(e==null?void 0:e.field_type)||"",i=(e==null?void 0:e.input_name)||"",o=(e==null?void 0:e.field_label)||"",g=(e==null?void 0:e.field_value)||"",x=(e==null?void 0:e.fld_option)||"",T=(e==null?void 0:e.help_text)||"",C=(e==null?void 0:e.is_required)==="Y",f=(e==null?void 0:e.is_half_field)==="Y",c=m.has(e,"is_editable")?(e==null?void 0:e.is_editable)||!1:!0;let _=[];i==="wc_store_id"?_=x==null?void 0:x.map(y=>({value:m.toString(y==null?void 0:y.id),label:y==null?void 0:y.title})):_=x?x.split(",").map(y=>({value:y,label:y})):[],n==="W"&&!_.find(y=>(y==null?void 0:y.value)===g)&&(_=[{value:"",label:`-- ${t("Select")} ---`},..._]);let j=null;n==="T"?j=s.jsx(F,{placeholder:T,disabled:!c}):n==="N"?j=s.jsx(ye,{placeholder:T,disabled:!c,style:{width:"100%"}}):n==="D"?j=s.jsx(xe,{placeholder:T||t("Select date"),format:H,disabled:!c,style:{width:"100%"}}):n==="S"?j=s.jsx(K,{disabled:!c}):n==="R"?j=s.jsx(je.Group,{options:_,disabled:!c}):n==="W"?j=s.jsx(J,{placeholder:T||t("Select option"),options:_,disabled:!c,style:{width:"100%"}}):n==="U"&&(j=s.jsx(F,{disabled:!c}));const d={};return n==="R"&&(d.htmlFor=null),s.jsx(p,{span:f?12:24,children:n==="E"?s.jsx(S,{style:{display:"block",marginBottom:"24px"},children:x}):s.jsx(k.Item,{label:o,name:i,rules:[{required:!!(c&&C),message:t("This field is required.")}],...d,children:j})},i)}),s.jsx(p,{span:24,children:s.jsx(k.Item,{label:t("Description"),name:"ticket_body",rules:[{required:!0,message:t("%s is required.",t("Description")),whitespace:!0},{validator:(e,r)=>{const n=ge(r||"");return!r||n?Promise.resolve():Promise.reject(new Error(t("%s is not valid.",t("Description"))))}}],htmlFor:null,children:!Te&&os==="quill"?s.jsx(ns,{onModal:!0}):s.jsx(ss,{id:"guest-ticket"})})}),l!=null&&l.ticket_file_upload?s.jsx(p,{span:24,children:s.jsx(k.Item,{name:"attached",children:s.jsx(ls,{multiple:!0,name:"attached",fileList:M,onChange:Ue,onRemove:Se,beforeUpload:Ge,accept:ts((l==null?void 0:l.allowed_type)||[],!0,!0),children:s.jsxs($,{align:"center",justify:"center",gap:4,wrap:!0,children:[s.jsx(Ke,{}),t("Click or drag file to upload")]})})})}):null,(a==null?void 0:a.is_public_ticket_opt_on_creation)==="Y"?s.jsx(p,{span:24,children:s.jsxs(D,{align:"center",style:{marginBottom:"24px"},children:[s.jsx(k.Item,{name:"is_public",valuePropName:"checked",style:{marginBottom:0},children:s.jsx(K,{size:"small"})}),s.jsx(S,{onClick:()=>{b.setFieldValue("is_public",!b.getFieldValue("is_public")),ie(null,b.getFieldsValue())},style:{cursor:"pointer"},children:t("Make this ticket public.")})]})}):null,s.jsx(p,{span:24,style:{textAlign:"right"},children:s.jsx(D,{children:s.jsx(z,{type:"primary",htmlType:"submit",loading:q==null?void 0:q.isLoading,children:t("Create")})})})]})})})]})]})})})})})})})})}export{xs as default};
