import{_ as H,u as oe,G as ie,s as ae,b as ce,c as pe,j as e,t as r,f as le,m as ee}from"../main.aHgQEcd5.1748844857753.js";import{r as a,u as xe,k as fe}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as L,s as $,b as J,C,A as je,o as ye,n as de,w as Ce,u as N,B as T,F as _e,a as X,aa as te,$ as se,Q as Se,T as ge,X as we,y as ne,f as Te}from"./antd.v1CHGtH-.1748844857753.js";import{A as V}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{u as Fe}from"./useGetFromParams.BFDdrSZN.1748844857753.js";function be({data:i,isEdit:f,onCloseModal:F,categorySelectList:o}){const g=i?{...i,parent_category:H.toInteger(i==null?void 0:i.parent_category)?i.parent_category:"",status:(i==null?void 0:i.status)==="A"}:{parent_category:"",status:!0},k=oe(),[M]=L.useForm(),[p,b]=a.useState(""),[B,j]=ie(),_=o==null?void 0:o.find(({value:s})=>s===(g==null?void 0:g.id)),A=s=>{var w,y;const S=((w=s==null?void 0:s.title)==null?void 0:w.trim())||"",m=((y=s==null?void 0:s.parent_category)==null?void 0:y.trim())||"0",c=s!=null&&s.status?"A":"I";B({params:{action:f?"ticket_category_edit":"ticket_category_add",id:g==null?void 0:g.id},data:{title:S,parent_category:m,status:c}})};return a.useEffect(()=>{var w,y,I,v;const{data:s,isLoading:S,isError:m,error:c}=j;k(S?ae():ce()),!S&&m&&((y=(w=c==null?void 0:c.data)==null?void 0:w.errors)!=null&&y.message)&&$.error((v=(I=c==null?void 0:c.data)==null?void 0:I.errors)==null?void 0:v.message),!S&&!m&&s&&(s!=null&&s.msg&&(s!=null&&s.status?(b(""),$.success(s==null?void 0:s.msg)):(b(s==null?void 0:s.msg),pe())),s!=null&&s.status&&F())},[j,F,k]),e.jsx(L,{form:M,name:"createCategory",layout:"vertical",onFinish:A,initialValues:g,autoComplete:"off",children:e.jsxs(J,{gutter:16,children:[p?e.jsx(C,{span:24,children:e.jsx(je,{message:p,type:"error",showIcon:!0,closable:!0,afterClose:()=>b(""),style:{marginBottom:"24px"}})}):null,e.jsx(C,{span:24,children:e.jsx(L.Item,{label:r("Title"),name:"title",rules:[{required:!0,message:r("%s is required.",r("Title")),whitespace:!0}],children:e.jsx(ye,{})})}),e.jsx(C,{span:24,hidden:!0,children:e.jsx(L.Item,{label:r("Parent Category"),name:"parent_category",hidden:!0,children:e.jsx(de,{options:o==null?void 0:o.filter(({value:s})=>(_==null?void 0:_.value)!==s&&!H.includes(_==null?void 0:_.child,H.toInteger(s)))})})}),e.jsx(C,{span:24,children:e.jsx(L.Item,{label:r("Status"),name:"status",valuePropName:"checked",children:e.jsx(Ce,{})})}),e.jsx(C,{span:24,style:{textAlign:"right"},children:e.jsxs(N,{children:[e.jsx(T,{htmlType:"button",onClick:F,children:r("Cancel")}),e.jsx(T,{type:"primary",htmlType:"submit",loading:j==null?void 0:j.isLoading,children:f?r("Update"):r("Create")})]})})]})})}const{Text:re}=ge;function Be({data:i,total:f,limit:F,page:o,onPageChange:g,onSizeChange:k,rowSelection:M,bulkAction:p,setBulkAction:b,bulkActionIds:B,onEditClick:j,isLoading:_,resetBulkAction:A,sortOrder:s,handleSort:S}){const m=le(),c=oe(),[w,y]=ie(),I=t=>{w({params:{action:"ticket_category_delete_item",id:t}})},v=()=>{let t="";p==="remove"?t="ticket_category_delete_items":p==="activate"?t="ticket_category_activate_items":p==="deactivate"&&(t="ticket_category_deactivate_items"),t&&w({params:{action:t,ids:B}})},Y=(t,l,h,{action:u})=>{u==="sort"&&S(h)},q=t=>s===`${t}-asc`?"ascend":s===`${t}-desc`?"descend":null,Z=[{title:r("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:q("id")},{title:r("Title"),dataIndex:"title",sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:q("title"),render:(t,l)=>e.jsxs(N,{direction:"vertical",children:[e.jsx(re,{children:t}),m.xs||m.sm||m.md||m.lg?e.jsxs(e.Fragment,{children:[e.jsxs(_e,{gap:"0 8px",wrap:!0,children:[e.jsx(re,{children:r("Status:")}),(l==null?void 0:l.status)==="A"?e.jsx(X,{color:"green",children:r("Active")}):e.jsx(X,{color:"default",children:r("Inactive")})]}),m.xs?e.jsxs(N,{children:[e.jsx(T,{type:"primary",icon:e.jsx(te,{}),size:"small",ghost:!0,onClick:()=>j(l)}),e.jsx(V,{action:"remove",onConfirm:()=>I(l==null?void 0:l.id),children:e.jsx(T,{type:"primary",icon:e.jsx(se,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]})},{title:r("Status"),dataIndex:"status",render:t=>t==="A"?e.jsx(X,{color:"green",children:r("Active")}):e.jsx(X,{color:"default",children:r("Inactive")}),responsive:["xl"]},{title:r("Action"),width:100,align:"right",render:t=>e.jsxs(N,{children:[e.jsx(T,{type:"primary",icon:e.jsx(te,{}),size:"small",ghost:!0,onClick:()=>j(t)}),e.jsx(V,{action:"remove",onConfirm:()=>I(t==null?void 0:t.id),children:e.jsx(T,{type:"primary",icon:e.jsx(se,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],D=()=>{const t=f?(o-1)*F+1:0,l=H.min([t+F-1,f]),h=r("Showing %1$d - %2$d of %3$d",t,l,f);return e.jsxs(J,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(C,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(J,{align:"middle",gutter:8,children:[e.jsx(C,{children:e.jsx(de,{value:p,style:{width:140},onChange:u=>b(u),options:[{value:"",label:r("Bulk Actions")},{value:"activate",label:r("Activate")},{value:"deactivate",label:r("Deactivate")},{value:"remove",label:r("Delete")}],disabled:!(B!=null&&B.length)})}),e.jsx(C,{children:e.jsx(V,{action:p,onConfirm:()=>v(),children:e.jsx(T,{type:"primary",disabled:!p,children:r("Apply")})})})]})}),e.jsx(C,{style:{marginTop:"4px",marginBottom:"4px"},children:h})]})};return a.useEffect(()=>{var E,Q,U,W;const{data:t,isLoading:l,isError:h,error:u}=y;c(l?ae():ce()),!l&&h&&((Q=(E=u==null?void 0:u.data)==null?void 0:E.errors)!=null&&Q.message)&&$.error((W=(U=u==null?void 0:u.data)==null?void 0:U.errors)==null?void 0:W.message),!l&&!h&&t&&(t!=null&&t.msg&&(t!=null&&t.status?$.success(t==null?void 0:t.msg):$.error(t==null?void 0:t.msg)),t!=null&&t.status&&A())},[y,A,c]),e.jsx(Se,{rowKey:t=>t==null?void 0:t.id,rowSelection:M,columns:Z,dataSource:i,footer:D,loading:_,onChange:Y,pagination:{total:f,pageSize:F,current:o,onChange:g,onShowSizeChange:k,showSizeChanger:f>10,style:{marginBottom:0}}})}const{Title:Ee}=ge;function Me(){const i=le(),f=xe(),F=Fe(),[o,g]=fe(),[k,M]=a.useState(F("limit",20)),[p,b]=a.useState((o==null?void 0:o.get("page"))||1),[B,j]=a.useState((o==null?void 0:o.get("sort"))||""),[_,A]=a.useState(""),[s,S]=a.useState([]),[m,c]=a.useState(!1),[w,y]=a.useState(null),[I,v]=a.useState(!1),[Y,q]=a.useState(0),[Z,D]=a.useState([]),[t,l]=a.useState([]),h=ee({action:"ticket_category_data",limit:k,page:p,sort:B||"id-asc"}),u=ee({action:"ticket_category_data_for_select",select:!0}),E=a.useCallback(()=>{A(""),S([])},[]),Q=n=>{n===1?o.delete("page"):o.set("page",n),b(n),g(o),E()},U=(n,d)=>{d===20?o.delete("limit"):o.set("limit",d),M(d),g(o),E()},W={selectedRowKeys:s,onChange:n=>{n!=null&&n.length||E(),S(n)}},me=n=>{y(n),v(!0),c(!0)},K=a.useCallback(()=>{c(!1),y(null),v(!1)},[]),he=()=>{h.refetch(),E()},ue=n=>{const{field:d,order:z}=n||{};let x=d;z==="ascend"?x+="-asc":x+="-desc",j(x),b(1),o.delete("page"),o.set("sort",x),g(o),E()};return a.useEffect(()=>{var O,P,G,R;const{data:n,isFetching:d,isError:z,error:x}=h;!d&&z&&$.error((P=(O=x==null?void 0:x.data)==null?void 0:O.errors)==null?void 0:P.message),!d&&!z&&n&&(D((G=n==null?void 0:n.data)==null?void 0:G.result),q(((R=n==null?void 0:n.data)==null?void 0:R.total)||0))},[h]),a.useEffect(()=>{var O,P,G,R;const{data:n,isFetching:d,isError:z,error:x}=u;!d&&z&&$.error((P=(O=x==null?void 0:x.data)==null?void 0:O.errors)==null?void 0:P.message),!d&&!z&&n&&n!=null&&n.status&&(G=n==null?void 0:n.data)!=null&&G.result&&l((R=n==null?void 0:n.data)==null?void 0:R.result)},[u]),a.useEffect(()=>{const{search:n}=f,d=new URLSearchParams(n);d.has("limit")||M(20),d.has("page")||b(1),d.has("sort")||j("")},[f]),e.jsxs(e.Fragment,{children:[e.jsxs(J,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(C,{style:{paddingBottom:"8px"},children:e.jsx(Ee,{level:5,style:{fontSize:"18px",margin:0},children:r("Categories")})}),e.jsx(C,{style:{paddingBottom:"8px"},children:e.jsxs(N,{children:[e.jsx(T,{type:"primary",icon:e.jsx(we,{}),onClick:he,ghost:!0}),i!=null&&i.lg||i!=null&&i.xl||i!=null&&i.xxl?e.jsx(T,{type:"primary",icon:e.jsx(ne,{}),onClick:()=>{c(!0)},children:r("Add New")}):e.jsx(T,{type:"primary",icon:e.jsx(ne,{}),onClick:()=>{c(!0)}})]})})]}),e.jsx(Be,{data:Z,total:Y,limit:k,page:p,onPageChange:Q,onSizeChange:U,rowSelection:W,bulkAction:_,setBulkAction:A,bulkActionIds:s,onEditClick:me,isLoading:h==null?void 0:h.isFetching,resetBulkAction:E,sortOrder:B,handleSort:ue}),e.jsx(Te,{title:I?r("Edit %s",r("Category")):r("Add New %s",r("Category")),centered:!0,open:m,onCancel:K,onClose:K,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(be,{isOpen:m,onCloseModal:K,data:w,isEdit:I,categorySelectList:t})})]})}export{Me as default};
