import{u as te,a0 as ne,s as ie,b as re,c as fe,j as e,t as n,_ as ee,f as xe,a1 as _e}from"../main.aHgQEcd5.1748844857753.js";import{r as l,u as ye,k as Se}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as B,s as L,b as V,C as x,A as Ie,n as he,o as v,u as M,w as ae,B as u,T as oe,F as le,a as D,aa as de,$ as ce,d as se,at as be,ao as Ce,Q as we,Y as Ee,X as Ae,y as me,f as Te}from"./antd.v1CHGtH-.1748844857753.js";import{A as N}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{S as ke}from"./ScreenGuard.CO_wY78U.1748844857753.js";const{Text:Be}=oe;function Le({data:a,isEdit:j,onCloseModal:y}){const o=a?{...a,details_btn:(a==null?void 0:a.details_btn)==="Y",status:(a==null?void 0:a.status)==="A"}:{same_site:"Y",details_btn:!0,status:!0},w=te(),[R]=B.useForm(),[z,g]=l.useState(""),[E,A]=l.useState((o==null?void 0:o.same_site)==="Y"),[S,G]=l.useState(o==null?void 0:o.details_btn),[P,f]=ne(),$=s=>{ee.has(s,"same_site")&&A((s==null?void 0:s.same_site)==="Y"),ee.has(s,"details_btn")&&G(s==null?void 0:s.details_btn)},I=s=>{var U,t,r,d,m;const _=((U=s==null?void 0:s.same_site)==null?void 0:U.trim())||"",b=((t=s==null?void 0:s.api_endpoint)==null?void 0:t.trim())||"",h=((r=s==null?void 0:s.api_public_key)==null?void 0:r.trim())||"",C=((d=s==null?void 0:s.api_token)==null?void 0:d.trim())||"",F=s!=null&&s.details_btn?"Y":"N",O=((m=s==null?void 0:s.admin_url)==null?void 0:m.trim())||"",T=s!=null&&s.status?"A":"I",k={same_site:_,details_btn:F,status:T};E||(k.api_endpoint=b,k.api_public_key=h,k.api_token=C,S&&(k.admin_url=O)),P({params:{action:j?"edd_edit":"edd_add",id:o==null?void 0:o.id},data:k})};return l.useEffect(()=>{var C,F,O,T;const{data:s,isLoading:_,isError:b,error:h}=f;w(_?ie():re()),!_&&b&&((F=(C=h==null?void 0:h.data)==null?void 0:C.errors)!=null&&F.message)&&L.error((T=(O=h==null?void 0:h.data)==null?void 0:O.errors)==null?void 0:T.message),!_&&!b&&s&&(s!=null&&s.msg&&(s!=null&&s.status?(g(""),L.success(s==null?void 0:s.msg)):(g(s==null?void 0:s.msg),fe())),s!=null&&s.status&&y())},[f,y,w]),e.jsx(B,{form:R,name:"createEddIntegration",layout:"vertical",onFinish:I,onValuesChange:$,initialValues:o,autoComplete:"off",children:e.jsxs(V,{gutter:16,children:[z?e.jsx(x,{span:24,children:e.jsx(Ie,{message:z,type:"error",showIcon:!0,closable:!0,afterClose:()=>g(""),style:{marginBottom:"24px"}})}):null,e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("Type"),name:"same_site",rules:[{required:!0,message:n("%s is required.",n("Type"))}],children:e.jsx(he,{style:{width:"100%"},options:[{value:"Y",label:n("EDD in same site")},{value:"N",label:n("EDD in external site")}]})})}),E?null:e.jsxs(e.Fragment,{children:[e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("API Endpoint"),name:"api_endpoint",rules:[{required:!0,message:n("%s is required.",n("API endpoint")),whitespace:!0},{type:"url",message:n("Please enter a valid URL.")}],tooltip:n("API endpoint URL (example: https://example.com/edd-api/)"),children:e.jsx(v,{})})}),e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("API Public Key"),name:"api_public_key",rules:[{required:!0,message:n("%s is required.",n("API public key")),whitespace:!0}],tooltip:n("Value containing any asterisk (*) will not be updated."),children:e.jsx(v,{})})}),e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("API Token"),name:"api_token",rules:[{required:!0,message:n("%s is required.",n("API token")),whitespace:!0}],tooltip:n("Value containing any asterisk (*) will not be updated."),children:e.jsx(v,{})})})]}),e.jsx(x,{span:24,children:e.jsxs(M,{align:"center",style:{marginBottom:"24px"},children:[e.jsx(B.Item,{name:"details_btn",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(ae,{size:"small"})}),e.jsx(Be,{onClick:()=>{R.setFieldValue("details_btn",!S),$({details_btn:!S})},style:{cursor:"pointer"},children:n("Show order details button.")})]})}),!E&&S?e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("Admin URL"),name:"admin_url",rules:[{required:!0,message:n("%s is required.",n("Admin URL")),whitespace:!0},{type:"url",message:n("Please enter a valid URL.")}],children:e.jsx(v,{})})}):null,e.jsx(x,{span:24,children:e.jsx(B.Item,{label:n("Status"),name:"status",valuePropName:"checked",children:e.jsx(ae,{})})}),e.jsx(x,{span:24,style:{textAlign:"right"},children:e.jsxs(M,{children:[e.jsx(u,{htmlType:"button",onClick:y,children:n("Cancel")}),e.jsx(u,{type:"primary",htmlType:"submit",loading:f==null?void 0:f.isLoading,children:j?n("Update"):n("Create")})]})})]})})}const{Text:pe}=oe;function Fe({data:a,total:j,limit:y,page:o,onPageChange:w,onSizeChange:R,rowSelection:z,bulkAction:g,setBulkAction:E,bulkActionIds:A,onEditClick:S,isLoading:G,resetBulkAction:P,sortOrder:f,handleSort:$}){const I=xe(),s=te(),[_,b]=ne(),h=(t,r)=>{_({params:{action:"edd_order_change",id:t,typ:r}})},C=t=>{_({params:{action:"edd_delete_item",id:t}})},F=()=>{let t="";g==="remove"?t="edd_delete_items":g==="activate"?t="edd_activate_items":g==="deactivate"&&(t="edd_deactivate_items"),t&&_({params:{action:t,ids:A}})},O=(t,r,d,{action:m})=>{m==="sort"&&$(d)},T=t=>f===`${t}-asc`?"ascend":f===`${t}-desc`?"descend":null,k=[{title:n("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:T("id")},{title:n("Site"),dataIndex:"site_url",render:(t,r)=>e.jsxs(M,{direction:"vertical",children:[(r==null?void 0:r.same_site)==="Y"?e.jsxs(le,{gap:"4px 8px",wrap:!0,children:[e.jsx("span",{children:t}),e.jsx(D,{color:"blue",style:{marginRight:0},children:n("Same-site")})]}):e.jsx(pe,{children:t}),I.xs||I.sm||I.md||I.lg?e.jsxs(e.Fragment,{children:[e.jsxs(le,{gap:"0 8px",wrap:!0,children:[e.jsx(pe,{children:n("Status:")}),(r==null?void 0:r.status)==="A"?e.jsx(D,{color:"green",children:n("Active")}):e.jsx(D,{color:"default",children:n("Inactive")})]}),I.xs?e.jsxs(M,{children:[e.jsx(u,{type:"primary",icon:e.jsx(de,{}),size:"small",ghost:!0,onClick:()=>S(r)}),e.jsx(N,{action:"remove",onConfirm:()=>C(r==null?void 0:r.id),children:e.jsx(u,{type:"primary",icon:e.jsx(ce,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]})},{title:n("Status"),dataIndex:"status",render:t=>t==="A"?e.jsx(D,{color:"green",children:n("Active")}):e.jsx(D,{color:"default",children:n("Inactive")}),responsive:["xl"]},{title:n("Order"),dataIndex:"int_order",width:100,render:(t,r)=>e.jsxs(M,{size:4,children:[e.jsx(N,{action:"orderup",onConfirm:()=>h(r==null?void 0:r.id,"u"),children:e.jsx(se,{title:n("Order Up"),children:e.jsx(u,{icon:e.jsx(be,{}),size:"small"})})}),e.jsx(D,{style:{lineHeight:"22px",margin:0},children:t||0}),e.jsx(N,{action:"orderdown",onConfirm:()=>h(r==null?void 0:r.id,"d"),children:e.jsx(se,{title:n("Order Down"),children:e.jsx(u,{icon:e.jsx(Ce,{}),size:"small"})})})]}),sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:T("int_order"),responsive:["hidden"]},{title:n("Action"),width:100,align:"right",render:t=>e.jsxs(M,{children:[e.jsx(u,{type:"primary",icon:e.jsx(de,{}),size:"small",ghost:!0,onClick:()=>S(t)}),e.jsx(N,{action:"remove",onConfirm:()=>C(t==null?void 0:t.id),children:e.jsx(u,{type:"primary",icon:e.jsx(ce,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],U=()=>{const t=j?(o-1)*y+1:0,r=ee.min([t+y-1,j]),d=n("Showing %1$d - %2$d of %3$d",t,r,j);return e.jsxs(V,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(x,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(V,{align:"middle",gutter:8,children:[e.jsx(x,{children:e.jsx(he,{value:g,style:{width:140},onChange:m=>E(m),options:[{value:"",label:n("Bulk Actions")},{value:"activate",label:n("Activate")},{value:"deactivate",label:n("Deactivate")},{value:"remove",label:n("Delete")}],disabled:!(A!=null&&A.length)})}),e.jsx(x,{children:e.jsx(N,{action:g,onConfirm:()=>F(),children:e.jsx(u,{type:"primary",disabled:!g,children:n("Apply")})})})]})}),e.jsx(x,{style:{marginTop:"4px",marginBottom:"4px"},children:d})]})};return l.useEffect(()=>{var J,Z,K,Y;const{data:t,isLoading:r,isError:d,error:m}=b;s(r?ie():re()),!r&&d&&((Z=(J=m==null?void 0:m.data)==null?void 0:J.errors)!=null&&Z.message)&&L.error((Y=(K=m==null?void 0:m.data)==null?void 0:K.errors)==null?void 0:Y.message),!r&&!d&&t&&(t!=null&&t.msg&&(t!=null&&t.status?L.success(t==null?void 0:t.msg):L.error(t==null?void 0:t.msg)),t!=null&&t.status&&P())},[b,P,s]),e.jsx(we,{rowKey:t=>t==null?void 0:t.id,rowSelection:z,columns:k,dataSource:a,footer:U,loading:G,onChange:O,pagination:{total:j,pageSize:y,current:o,onChange:w,onShowSizeChange:R,showSizeChanger:j>10,style:{marginBottom:0}}})}const{Title:Oe}=oe;function Ue(){const a=xe(),j=te(),y=ye(),[o,w]=Se(),[R,z]=l.useState((o==null?void 0:o.get("limit"))||20),[g,E]=l.useState((o==null?void 0:o.get("page"))||1),[A,S]=l.useState((o==null?void 0:o.get("sort"))||""),[G,P]=l.useState(""),[f,$]=l.useState([]),[I,s]=l.useState(!1),[_,b]=l.useState(null),[h,C]=l.useState(!1),[F,O]=l.useState(0),[T,k]=l.useState([]),[U,t]=ne(),r=_e({action:"edd_data",limit:R,page:g,sort:A||"id-asc"}),d=l.useCallback(()=>{P(""),$([])},[]),m=i=>{i===1?o.delete("page"):o.set("page",i),E(i),w(o),d()},J=(i,c)=>{c===20?o.delete("limit"):o.set("limit",c),z(c),w(o),d()},Z={selectedRowKeys:f,onChange:i=>{i!=null&&i.length||d(),$(i)}},K=i=>{b(i),C(!0),s(!0)},Y=l.useCallback(()=>{s(!1),b(null),C(!1)},[]),ge=()=>{U({params:{action:"edd_reset_order"}})},ue=()=>{r.refetch(),d()},je=i=>{const{field:c,order:q}=i||{};let p=c;q==="ascend"?p+="-asc":p+="-desc",S(p),E(1),o.delete("page"),o.set("sort",p),w(o),d()};return l.useEffect(()=>{var Q,H,W,X;const{data:i,isFetching:c,isError:q,error:p}=r;!c&&q&&L.error((H=(Q=p==null?void 0:p.data)==null?void 0:Q.errors)==null?void 0:H.message),!c&&!q&&i&&(k((W=i==null?void 0:i.data)==null?void 0:W.result),O(((X=i==null?void 0:i.data)==null?void 0:X.total)||0))},[r]),l.useEffect(()=>{var Q,H,W,X;const{data:i,isLoading:c,isError:q,error:p}=t;j(c?ie():re()),!c&&q&&((H=(Q=p==null?void 0:p.data)==null?void 0:Q.errors)!=null&&H.message)&&L.error((X=(W=p==null?void 0:p.data)==null?void 0:W.errors)==null?void 0:X.message),!c&&!q&&i&&(i!=null&&i.msg&&(i!=null&&i.status?L.success(i==null?void 0:i.msg):L.error(i==null?void 0:i.msg)),i!=null&&i.status&&d())},[t,d,j]),l.useEffect(()=>{const{search:i}=y,c=new URLSearchParams(i);c.has("limit")||z(20),c.has("page")||E(1),c.has("sort")||S("")},[y]),e.jsxs(e.Fragment,{children:[e.jsxs(V,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(x,{style:{paddingBottom:"8px"},children:e.jsx(Oe,{level:5,style:{fontSize:"18px",margin:0},children:n("Edd Integrations")})}),e.jsx(x,{style:{paddingBottom:"8px"},children:e.jsxs(M,{children:[e.jsx(ke,{hideOn:["xs","sm","md","lg","xl","xxl"],children:e.jsx(N,{action:"orderreset",onConfirm:()=>ge(),children:e.jsx(se,{title:n("Reset Order"),children:e.jsx(u,{icon:e.jsx(Ee,{})})})})}),e.jsx(u,{type:"primary",icon:e.jsx(Ae,{}),onClick:ue,ghost:!0}),a!=null&&a.lg||a!=null&&a.xl||a!=null&&a.xxl?e.jsx(u,{type:"primary",icon:e.jsx(me,{}),onClick:()=>{s(!0)},children:n("Add New")}):e.jsx(u,{type:"primary",icon:e.jsx(me,{}),onClick:()=>{s(!0)}})]})})]}),e.jsx(Fe,{data:T,total:F,limit:R,page:g,onPageChange:m,onSizeChange:J,rowSelection:Z,bulkAction:G,setBulkAction:P,bulkActionIds:f,onEditClick:K,isLoading:r==null?void 0:r.isFetching,resetBulkAction:d,sortOrder:A,handleSort:je}),e.jsx(Te,{title:h?n("Edit %s",n("Edd Integration")):n("Add New %s",n("Edd Integration")),centered:!0,open:I,onCancel:Y,onClose:Y,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(Le,{isOpen:I,onCloseModal:Y,data:_,isEdit:h})})]})}export{Ue as default};
