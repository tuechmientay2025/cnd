import{_,u as Z,T as D,s as v,b as V,c as ls,j as s,t as o,C as as,f as ms,U as ts,m as ps}from"../main.aHgQEcd5.1748844857753.js";import{r as m}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as g,s as q,b as G,C as a,A as K,o as Q,v as hs,D as J,u as N,w as X,q as U,n as xs,B as R,T as ss,k as es,aa as ds,$ as js,F as $,a as Y,S as gs,au as os,av as fs,X as us,y as rs,f as ys}from"./antd.v1CHGtH-.1748844857753.js";import{A as _s}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{t as bs}from"./editor-value.B-WWB6lV.1748844857753.js";import{C as is}from"./CopyButton.BHPgmrhV.1748844857753.js";const{Text:ns}=ss;function ws({data:r,isEdit:p,onCloseModal:w,categorySelectList:I}){const l=r?{...r,secure_protocol:(r==null?void 0:r.secure_protocol)==="A",attach_with:(r==null?void 0:r.attach_with)==="A",choose_category:_.toInteger(r==null?void 0:r.choose_category)?r.choose_category:"",status:(r==null?void 0:r.status)==="A"}:{secure_protocol:!1,secure_protocol_type:"S",attach_with:!1,choose_category:"",status:!0},O=Z(),[b]=g.useForm(),[F,e]=m.useState(""),[j,M]=m.useState(l==null?void 0:l.secure_protocol),[h,S]=m.useState(l==null?void 0:l.attach_with),[f,u]=D(),A=t=>{_.has(t,"secure_protocol")&&M(t==null?void 0:t.secure_protocol),_.has(t,"attach_with")&&S(t==null?void 0:t.attach_with)},i=t=>{var y,k,L,T,z;const d=((y=t==null?void 0:t.wps_host)==null?void 0:y.trim())||"",c=_.toInteger((t==null?void 0:t.wps_port)||993)||993,x=((k=t==null?void 0:t.user_email)==null?void 0:k.trim())||"",C=((L=t==null?void 0:t.user_password)==null?void 0:L.trim())||"",W=t!=null&&t.secure_protocol?"A":"I",E=((T=t==null?void 0:t.secure_protocol_type)==null?void 0:T.trim())||"",n=t!=null&&t.attach_with?"A":"I",P=((z=t==null?void 0:t.choose_category)==null?void 0:z.trim())||"0",B=t!=null&&t.status?"A":"I";f({params:{action:p?"mailbox_edit":"mailbox_add",id:l==null?void 0:l.id},data:{wps_host:d,wps_port:c,user_email:x,user_password:C,secure_protocol:W,secure_protocol_type:E,attach_with:n,choose_category:P,status:B}})};return m.useEffect(()=>{var C,W,E,n;const{data:t,isLoading:d,isError:c,error:x}=u;O(d?v():V()),!d&&c&&((W=(C=x==null?void 0:x.data)==null?void 0:C.errors)!=null&&W.message)&&q.error((n=(E=x==null?void 0:x.data)==null?void 0:E.errors)==null?void 0:n.message),!d&&!c&&t&&(t!=null&&t.msg&&(t!=null&&t.status?(e(""),q.success(t==null?void 0:t.msg)):(e(t==null?void 0:t.msg),ls())),t!=null&&t.status&&w())},[u,w,O]),s.jsx(g,{form:b,name:"createMailread",layout:"vertical",onFinish:i,onValuesChange:A,initialValues:l,autoComplete:"off",children:s.jsxs(G,{gutter:16,children:[F?s.jsx(a,{span:24,children:s.jsx(K,{message:F,type:"error",showIcon:!0,closable:!0,afterClose:()=>e(""),style:{marginBottom:"24px"}})}):null,s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Host"),name:"wps_host",rules:[{required:!0,message:o("%s is required.",o("Host")),whitespace:!0}],children:s.jsx(Q,{})})}),s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Port"),name:"wps_port",rules:[{required:!0,message:o("%s is required.",o("Port"))}],children:s.jsx(hs,{style:{width:"100%"}})})}),s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("User Email"),name:"user_email",rules:[{required:!0,message:o("%s is required.",o("User email")),whitespace:!0},{type:"email",message:o("Please enter a valid email.")}],children:s.jsx(Q,{})})}),s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("User Password"),name:"user_password",rules:[{required:!0,message:o("%s is required.",o("User password")),whitespace:!0}],children:s.jsx(Q.Password,{})})}),s.jsx(a,{span:24,children:s.jsx(J,{style:{margin:"0 0 24px 0"}})}),s.jsx(a,{span:24,children:s.jsxs(N,{align:"center",style:{marginBottom:"24px"},children:[s.jsx(g.Item,{name:"secure_protocol",valuePropName:"checked",style:{marginBottom:0},children:s.jsx(X,{size:"small"})}),s.jsx(ns,{onClick:()=>{b.setFieldValue("secure_protocol",!j),A({secure_protocol:!j})},style:{cursor:"pointer"},children:o("Secure protocol (SSL/TLS).")})]})}),j?s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Secure Protocol Type"),name:"secure_protocol_type",children:s.jsx(U.Group,{children:s.jsxs(N,{direction:"vertical",children:[s.jsx(U,{value:"S",children:"SSL"}),s.jsx(U,{value:"T",children:"TLS"}),s.jsx(U,{value:"A",children:"START-TLS"})]})})})}):null,s.jsx(a,{span:24,children:s.jsx(J,{style:{margin:"0 0 24px 0"}})}),s.jsx(a,{span:24,children:s.jsxs(N,{align:"center",style:{marginBottom:"24px"},children:[s.jsx(g.Item,{name:"attach_with",valuePropName:"checked",style:{marginBottom:0},children:s.jsx(X,{size:"small"})}),s.jsx(ns,{onClick:()=>{b.setFieldValue("attach_with",!h),A({attach_with:!h})},style:{cursor:"pointer"},children:o("Attached with ticket category.")})]})}),h?s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Choose Category"),name:"choose_category",rules:[{required:!0,message:o("%s is required.",o("Category")),whitespace:!0}],children:s.jsx(xs,{options:I})})}):null,s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Status"),name:"status",valuePropName:"checked",children:s.jsx(X,{})})}),s.jsx(a,{span:24,style:{textAlign:"right"},children:s.jsxs(N,{children:[s.jsx(R,{htmlType:"button",onClick:w,children:o("Cancel")}),s.jsx(R,{type:"primary",htmlType:"submit",loading:u==null?void 0:u.isLoading,children:p?o("Update"):o("Create")})]})})]})})}const{Text:H,Paragraph:cs}=ss;function Ss({data:r,onEditClick:p,isLoading:w,categorySelectList:I}){const l=Z(),[O,b]=D(),F=e=>{O({params:{action:"mailbox_delete_item",id:e}})};return m.useEffect(()=>{var S,f,u,A;const{data:e,isLoading:j,isError:M,error:h}=b;l(j?v():V()),!j&&M&&((f=(S=h==null?void 0:h.data)==null?void 0:S.errors)!=null&&f.message)&&q.error((A=(u=h==null?void 0:h.data)==null?void 0:u.errors)==null?void 0:A.message),!j&&!M&&e&&e!=null&&e.msg&&(e!=null&&e.status?q.success(e==null?void 0:e.msg):q.error(e==null?void 0:e.msg))},[b,l]),r?s.jsx(G,{gutter:16,children:r==null?void 0:r.map(e=>{const j=(e==null?void 0:e.status)==="A",M=(e==null?void 0:e.attach_with)==="A",h=(e==null?void 0:e.choose_category)||"0";let S=o("N/A");if(M&&h!=="0"){const f=I==null?void 0:I.find(({value:u})=>u===h);f?S=f==null?void 0:f.label:S=h}return s.jsx(a,{xs:24,lg:12,xxl:8,children:s.jsx(es,{size:"small",title:e==null?void 0:e.user_email,extra:s.jsxs(N,{style:{marginLeft:"8px"},children:[s.jsx(R,{type:"primary",icon:s.jsx(ds,{}),size:"small",ghost:!0,onClick:()=>p(e)}),s.jsx(_s,{action:"remove",onConfirm:()=>F(e==null?void 0:e.id),children:s.jsx(R,{type:"primary",icon:s.jsx(js,{}),size:"small",danger:!0,ghost:!0})})]}),styles:{header:{background:"#fafafa",fontWeight:500}},style:{marginTop:"16px"},children:s.jsxs(N,{direction:"vertical",children:[s.jsxs($,{gap:"0 8px",wrap:!0,children:[s.jsx(H,{style:{fontWeight:500},children:o("Host:")}),s.jsx(cs,{style:{margin:0},children:(e==null?void 0:e.wps_host)||""})]}),s.jsxs($,{gap:"0 8px",wrap:!0,children:[s.jsx(H,{style:{fontWeight:500},children:o("Email:")}),s.jsx(cs,{style:{margin:0},children:(e==null?void 0:e.user_email)||""})]}),s.jsxs($,{gap:"0 8px",wrap:!0,children:[s.jsx(H,{style:{fontWeight:500},children:o("Category:")}),s.jsx(Y,{bordered:!1,children:S})]}),s.jsxs($,{gap:"0 8px",wrap:!0,children:[s.jsx(H,{style:{fontWeight:500},children:o("Status:")}),j?s.jsx(Y,{color:"green",children:o("Active")}):s.jsx(Y,{color:"default",children:o("Inactive")})]})]})})},e==null?void 0:e.id)})}):s.jsx(G,{children:s.jsx(a,{span:24,children:s.jsx(es,{size:"small",style:{marginTop:"16px"},children:s.jsx(gs,{spinning:w,style:{maxHeight:"unset"},children:s.jsx(os,{image:os.PRESENTED_IMAGE_SIMPLE})})})})})}function Cs({data:r,extraData:p,onCloseModal:w}){const I=[],l=[],O={emr_txt:""},b=Z(),[F]=g.useForm(),[e,j]=m.useState(!0),[M,h]=m.useState(""),[S,f]=D(),u=(i,t)=>{t=_.mapValues(t,function(c){return _.isString(c)?_.trim(c):c});for(const c of I){const x=i==null?void 0:i[c];x&&_.includes(x,"*")&&(t[c]=r[c])}for(const c of l)(i==null?void 0:i[c])&&(t[c]=bs((i==null?void 0:i[c])||""));const d=_.pick(r,_.keys(t));_.isEqual(d,t)?j(!0):j(!1)},A=async i=>{var d;const t=((d=i==null?void 0:i.emr_txt)==null?void 0:d.trim())||"";S({params:{action:"mailbox"},data:{emr_txt:t}})};return m.useEffect(()=>{F.setFieldsValue(r||{}),j(!0)},[r,F]),m.useEffect(()=>{var x,C,W,E;const{data:i,isLoading:t,isError:d,error:c}=f;b(t?v():V()),!t&&d&&((C=(x=c==null?void 0:c.data)==null?void 0:x.errors)!=null&&C.message)&&q.error((E=(W=c==null?void 0:c.data)==null?void 0:W.errors)==null?void 0:E.message),!t&&!d&&i&&(i!=null&&i.msg&&(i!=null&&i.status?(h(""),q.success(i==null?void 0:i.msg)):(h(i==null?void 0:i.msg),as())),i!=null&&i.status&&w())},[f,w,b]),s.jsx(g,{form:F,name:"settingsMailread",layout:"vertical",autoComplete:"off",onFinish:A,onValuesChange:u,initialValues:O,children:s.jsxs(G,{children:[M?s.jsx(a,{span:24,children:s.jsx(K,{message:M,type:"error",showIcon:!0,closable:!0,afterClose:()=>h(""),style:{marginBottom:"24px"}})}):null,s.jsx(a,{span:24,children:s.jsxs(g.Item,{label:o("Cron Job Command"),children:[s.jsx(K,{message:p==null?void 0:p.corn_cmd_1,action:s.jsx(is,{text:p==null?void 0:p.corn_cmd_1,style:{marginLeft:"16px"}}),style:{backgroundColor:"rgba(0, 0, 0, 0.04)",borderColor:"#d9d9d9"}}),s.jsx(J,{variant:"dotted",style:{margin:"8px 0"},children:o("or")}),s.jsx(K,{message:p==null?void 0:p.corn_cmd_2,action:s.jsx(is,{text:p==null?void 0:p.corn_cmd_2,style:{marginLeft:"16px"}}),style:{backgroundColor:"rgba(0, 0, 0, 0.04)",borderColor:"#d9d9d9"}})]})}),s.jsx(J,{style:{margin:"0 0 24px 0"}}),s.jsx(a,{span:24,children:s.jsx(g.Item,{label:o("Email Reply Start Text"),name:"emr_txt",rules:[{whitespace:!0}],children:s.jsx(Q,{})})}),s.jsx(a,{span:24,children:s.jsxs(N,{children:[s.jsx(R,{type:"primary",htmlType:"submit",loading:!1,disabled:e,children:o("Save Changes")}),s.jsx(R,{htmlType:"button",onClick:w,children:o("Cancel")})]})})]})})}const{Title:Es}=ss;function Ps(){const r=ms(),[p,w]=m.useState(""),[I,l]=m.useState(!1),[O,b]=m.useState(null),[F,e]=m.useState(!1),[j,M]=m.useState([]),[h,S]=m.useState(null),[f,u]=m.useState(null),[A,i]=m.useState([]),t=ts({action:"mailbox_data"}),d=ts({action:"mailbox_settings_data"}),c=ps({action:"ticket_category_data_for_select",select:!0}),x=n=>{b(n),e(!0),l(!0)},C=m.useCallback(()=>{w(""),l(!1),b(null),e(!1)},[]),W=()=>{t.refetch()};m.useEffect(()=>{var k,L,T;const{data:n,isFetching:P,isError:B,error:y}=t;!P&&B&&q.error((L=(k=y==null?void 0:y.data)==null?void 0:k.errors)==null?void 0:L.message),!P&&!B&&n&&M((T=n==null?void 0:n.data)==null?void 0:T.result)},[t]),m.useEffect(()=>{var k,L;const{data:n,isFetching:P,isError:B,error:y}=d;if(!P&&B&&q.error((L=(k=y==null?void 0:y.data)==null?void 0:k.errors)==null?void 0:L.message),!P&&!B&&n){const T=_.clone((n==null?void 0:n.data)||{});_.unset(T,"corn_cmd_1"),_.unset(T,"corn_cmd_2"),S(T||{}),u((n==null?void 0:n.data)||{})}},[d]),m.useEffect(()=>{var k,L,T,z;const{data:n,isFetching:P,isError:B,error:y}=c;!P&&B&&q.error((L=(k=y==null?void 0:y.data)==null?void 0:k.errors)==null?void 0:L.message),!P&&!B&&n&&n!=null&&n.status&&(T=n==null?void 0:n.data)!=null&&T.result&&i((z=n==null?void 0:n.data)==null?void 0:z.result)},[c]);let E="";return p==="settings"?E=o("Mailboxes Settings"):F?E=o("Edit %s",o("Mailbox")):E=o("Add New %s",o("Mailbox")),s.jsxs(s.Fragment,{children:[s.jsxs(G,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:0},children:[s.jsx(a,{style:{paddingBottom:"8px"},children:s.jsx(Es,{level:5,style:{fontSize:"18px",margin:0},children:o("Mailboxes (Traditional)")})}),s.jsx(a,{style:{paddingBottom:"8px"},children:s.jsxs(N,{children:[s.jsx(R,{type:"primary",icon:s.jsx(fs,{}),onClick:()=>{w("settings"),l(!0)},ghost:!0}),s.jsx(R,{type:"primary",icon:s.jsx(us,{}),onClick:W,ghost:!0}),r!=null&&r.lg||r!=null&&r.xl||r!=null&&r.xxl?s.jsx(R,{type:"primary",icon:s.jsx(rs,{}),onClick:()=>{l(!0)},children:o("Add New")}):s.jsx(R,{type:"primary",icon:s.jsx(rs,{}),onClick:()=>{l(!0)}})]})})]}),s.jsx(Ss,{data:j,onEditClick:x,isLoading:t==null?void 0:t.isFetching,categorySelectList:A}),s.jsx(ys,{title:E,centered:!0,open:I,onCancel:C,onClose:C,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:p==="settings"?s.jsx(Cs,{isOpen:I,onCloseModal:C,data:h,extraData:f}):s.jsx(ws,{isOpen:I,onCloseModal:C,data:O,isEdit:F,categorySelectList:A})})]})}export{Ps as default};
