import{_ as i,u as vs,a as ws,s as us,b as js,c as Se,j as s,t as r,i as Hs,f as Ps,g as In,d as Fn,k as ye,l as En,m as zn,n as Rn,o as Sn,E as Ln}from"../main.aHgQEcd5.1748844857753.js";import{i as $s,j as J,s as P,b as ts,C as M,A as Es,p as Mn,q as An,n as ms,u as _,B as N,T as cs,o as me,v as Nn,w as Le,k as es,D as z,F as ns,d as ss,a0 as Me,a1 as Ae,r as Ne,V as $e,E as Os,U as Ws,I as Oe,m as hs,a2 as $n,a3 as On,a4 as Wn,a5 as Hn,a6 as Pn,a as _s,a7 as Yn,a8 as Un,N as Bn,a9 as qn,x as Gn,z as Kn,G as Qn,aa as _e,L as We,ab as Xn,ac as be,ad as we,X as Jn,ae as Zn,c as Vn,e as Dn,af as sr,f as er}from"./antd.v1CHGtH-.1748844857753.js";import{r as p,i as nr,j as rr,L as ve}from"./vendor.Cii7CkpR.1748844857753.js";import{A as fs}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{C as tr}from"./CopyButton.BHPgmrhV.1748844857753.js";import{S as bs}from"./ScreenGuard.CO_wY78U.1748844857753.js";import{U as Z,g as lr,c as Ce,a as Te,b as or}from"./file-upload.BfWYB1nD.1748844857753.js";import{t as as}from"./editor-value.B-WWB6lV.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{t as He,a as Pe}from"./time-format.CWvin_m1.1748844857753.js";import{w as Ye,R as Ue,T as Be,g as qe}from"./withQuillEditorConfig.C5Id3VCK.1748844857753.js";const{Text:ir}=cs,ke="YYYY-MM-DD";function cr({ticketId:t,fields:o,onCloseModal:j}){const g=i.cloneDeep(o),x={};for(const l of g){const e=(l==null?void 0:l.field_type)||"",m=(l==null?void 0:l.input_name)||"",c=(l==null?void 0:l.field_value)||"";if(e==="E")continue;let h=c;e==="N"?h=c?i.toNumber(c):"":e==="D"?h=c?$s(c):"":e==="S"?h=c?!!c:!1:h=i.trim(c),x[m]=h}const I=[],C=[],y=x||{},f=vs(),[F]=J.useForm(),[L,$]=p.useState(!0),[Y,G]=p.useState(""),[B,V]=ws(),Q=(l,e)=>{e=i.mapValues(e,function(c){return i.isString(c)?i.trim(c):c});for(const c of I){const h=l==null?void 0:l[c];h&&i.includes(h,"*")&&(e[c]=y[c])}for(const c of C)(l==null?void 0:l[c])&&(e[c]=as((l==null?void 0:l[c])||""));const m=i.pick(y,i.keys(e));i.isEqual(m,e)?$(!0):$(!1)},U=l=>{const e={};for(const m in l){const c=g.find(h=>(h==null?void 0:h.input_name)===m);if(c&&((c==null?void 0:c.is_editable)||!1)){const E=(c==null?void 0:c.field_type)||"";E==="N"?e[m]=i.toString(l[m]):E==="D"?e[m]=$s(l[m]).format(ke):E==="S"?e[m]=l[m]?1:0:e[m]=i.trim(l[m])}}B({params:{action:"ticket_field_edit",id:t||0},data:{...e}})};return p.useEffect(()=>{var h,E,K,q;const{data:l,isLoading:e,isError:m,error:c}=V;f(e?us():js()),!e&&m&&((E=(h=c==null?void 0:c.data)==null?void 0:h.errors)!=null&&E.message)&&P.error((q=(K=c==null?void 0:c.data)==null?void 0:K.errors)==null?void 0:q.message),!e&&!m&&l&&(l!=null&&l.msg&&(l!=null&&l.status?(G(""),P.success(l==null?void 0:l.msg)):(G(l==null?void 0:l.msg),Se())),l!=null&&l.status&&j())},[V,j,f]),s.jsx(J,{form:F,name:"ticketDataEdit",layout:"vertical",onFinish:U,onValuesChange:Q,initialValues:y,autoComplete:"off",children:s.jsxs(ts,{gutter:16,children:[Y?s.jsx(M,{span:24,children:s.jsx(Es,{message:Y,type:"error",showIcon:!0,closable:!0,afterClose:()=>G(""),style:{marginBottom:"24px"}})}):null,g==null?void 0:g.map(l=>{const e=(l==null?void 0:l.field_type)||"",m=(l==null?void 0:l.input_name)||"",c=(l==null?void 0:l.field_label)||"",h=(l==null?void 0:l.field_value)||"",E=(l==null?void 0:l.fld_option)||"",K=(l==null?void 0:l.help_text)||"",q=(l==null?void 0:l.is_required)==="Y",u=(l==null?void 0:l.is_half_field)==="Y",T=(l==null?void 0:l.is_editable)||!1;let A=[];m==="wc_store_id"?A=E==null?void 0:E.map(W=>({value:i.toString(W==null?void 0:W.id),label:W==null?void 0:W.title})):A=E?E.split(",").map(W=>({value:W,label:W})):[],e==="W"&&!A.find(W=>(W==null?void 0:W.value)===h)&&(A=[{value:"",label:`-- ${r("Select")} ---`},...A]);let w=null;e==="T"?w=s.jsx(me,{placeholder:K,disabled:!T}):e==="N"?w=s.jsx(Nn,{placeholder:K,disabled:!T,style:{width:"100%"}}):e==="D"?w=s.jsx(Mn,{placeholder:K||r("Select date"),format:ke,disabled:!T,style:{width:"100%"}}):e==="S"?w=s.jsx(Le,{disabled:!T}):e==="R"?w=s.jsx(An.Group,{options:A,disabled:!T}):e==="W"?w=s.jsx(ms,{placeholder:K||r("Select option"),options:A,disabled:!T,style:{width:"100%"}}):e==="U"&&(w=s.jsx(me,{disabled:!T}));const X={};return e==="R"&&(X.htmlFor=null),s.jsx(M,{span:u?12:24,children:e==="E"?s.jsx(ir,{style:{display:"block",marginBottom:"24px"},children:E}):s.jsx(J.Item,{label:c,name:m,rules:[{required:!!(T&&q),message:r("This field is required.")}],...X,children:w})},m)}),s.jsx(M,{span:24,children:s.jsxs(_,{children:[s.jsx(N,{type:"primary",htmlType:"submit",loading:!1,disabled:L,children:r("Save Changes")}),s.jsx(N,{htmlType:"button",onClick:j,children:r("Cancel")})]})})]})})}const{Text:os}=cs;function dr({data:t}){const{count:o,items:j}=t;return s.jsx(es,{size:"small",title:r("EDD Orders (%d)",o||0),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0,maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:s.jsx(_,{direction:"vertical",size:24,style:{padding:"8px 12px",width:"100%"},children:j==null?void 0:j.map((g,x)=>{const I=(g==null?void 0:g.downloads)||[],C=(g==null?void 0:g.totals)||[],y=(g==null?void 0:g.others)||[],f=(g==null?void 0:g.more_url)||"";return s.jsx(es,{size:"small",children:s.jsxs(_,{direction:"vertical",size:16,style:{width:"100%"},children:[I!=null&&I.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(os,{style:{fontWeight:500},children:r("Products")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:I==null?void 0:I.map((F,L)=>L?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)})]}):s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)}))})]}):null,C!=null&&C.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(os,{style:{fontWeight:500},children:r("Totals")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:C==null?void 0:C.map((F,L)=>L?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)})]}):s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)}))})]}):null,y!=null&&y.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(os,{style:{fontWeight:500},children:r("Others")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:y==null?void 0:y.map((F,L)=>L?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)})]}):s.jsx(os,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:F}},L)}))})]}):null,f?s.jsx(N,{size:"small",type:"primary",target:"_blank",href:f,ghost:!0,children:r("View Details")}):null]})},x)})})})}const{Text:is}=cs;function ar({data:t}){return s.jsx(es,{size:"small",title:r("Envato Items (%d)",(t==null?void 0:t.length)||0),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0,maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:t==null?void 0:t.map((o,j)=>s.jsxs(s.Fragment,{children:[j?s.jsx(z,{style:{margin:0}}):null,s.jsxs(_,{size:0,direction:"vertical",style:{padding:"8px 12px",width:"100%"},children:[s.jsx(is,{children:s.jsx("a",{target:"_blank",href:(o==null?void 0:o.url)||"#",rel:"noopener",children:(o==null?void 0:o.name)||""})}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsxs(ns,{wrap:!0,children:[s.jsx(is,{style:{marginRight:"8px"},children:r("License:")}),s.jsx(is,{children:(o==null?void 0:o.license)||""})]}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsxs(ns,{wrap:!0,children:[s.jsx(is,{style:{marginRight:"8px"},children:r("Purchase:")}),s.jsx(is,{children:(o==null?void 0:o.sold_at)||""})]}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsxs(ns,{wrap:!0,children:[s.jsx(is,{style:{marginRight:"8px"},children:r("Support:")}),s.jsx(is,{children:(o==null?void 0:o.supported_until)||""})]}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsxs(ns,{wrap:!0,children:[s.jsx(is,{style:{marginRight:"8px"},children:r("Code:")}),s.jsx(is,{copyable:!0,children:(o==null?void 0:o.code)||""})]})]},j)]}))})}const xr=Hs();function pr({data:t,onCloseModal:o,agentUserSelectList:j,categorySelectList:g,tagSelectList:x,statusSelectList:I}){const C=[],y=[],f=t?{assigned_on:i.toInteger(t==null?void 0:t.assigned_on)?t.assigned_on:"",cat_id:i.toInteger(t==null?void 0:t.cat_id)?t.cat_id:"",tag_ids:i.isArray(t==null?void 0:t.tag_ids)?t.tag_ids:[],status:(t==null?void 0:t.status)||""}:{assigned_on:"",cat_id:"",tag_ids:[],status:""},F=vs(),[L]=J.useForm(),[$,Y]=p.useState(!0),[G,B]=p.useState(""),[V,Q]=ws(),U=(e,m)=>{m=i.mapValues(m,function(h){return i.isString(h)?i.trim(h):h});for(const h of C){const E=e==null?void 0:e[h];E&&i.includes(E,"*")&&(m[h]=f[h])}for(const h of y)(e==null?void 0:e[h])&&(m[h]=as((e==null?void 0:e[h])||""));const c=i.pick(f,i.keys(m));i.isEqual(c,m)?Y(!0):Y(!1)},l=e=>{var K,q,u,T;const m=((K=e==null?void 0:e.assigned_on)==null?void 0:K.trim())||"",c=((q=e==null?void 0:e.cat_id)==null?void 0:q.trim())||"",h=((u=e==null?void 0:e.tag_ids)==null?void 0:u.map(A=>A==null?void 0:A.trim()))||[],E=((T=e==null?void 0:e.status)==null?void 0:T.trim())||"";if(!m&&!c&&!h&&!E){B(r("Invalid data."));return}V({params:{action:"ticket_edit",id:(t==null?void 0:t.id)||0},data:{assigned_on:m,cat_id:c,tag_ids:h,status:E}})};return p.useEffect(()=>{var E,K,q,u;const{data:e,isLoading:m,isError:c,error:h}=Q;F(m?us():js()),!m&&c&&((K=(E=h==null?void 0:h.data)==null?void 0:E.errors)!=null&&K.message)&&P.error((u=(q=h==null?void 0:h.data)==null?void 0:q.errors)==null?void 0:u.message),!m&&!c&&e&&(e!=null&&e.msg&&(e!=null&&e.status?(B(""),P.success(e==null?void 0:e.msg)):(B(e==null?void 0:e.msg),Se())),e!=null&&e.status&&o())},[Q,o,F]),s.jsx(J,{form:L,name:"ticketQuickEdit",layout:"vertical",onFinish:l,onValuesChange:U,initialValues:f,autoComplete:"off",children:s.jsxs(ts,{gutter:16,children:[G?s.jsx(M,{span:24,children:s.jsx(Es,{message:G,type:"error",showIcon:!0,closable:!0,afterClose:()=>B(""),style:{marginBottom:"24px"}})}):null,s.jsx(Z,{permissions:["edit-assigned"],children:s.jsx(M,{span:24,children:s.jsx(J.Item,{label:r("Agent"),name:"assigned_on",children:s.jsx(ms,{options:j==null?void 0:j.filter(e=>{if(!i.toInteger(t==null?void 0:t.assigned_on)||(e==null?void 0:e.value)!=="")return!0})})})})}),s.jsx(Z,{permissions:["edit-category"],children:s.jsx(M,{span:24,children:s.jsx(J.Item,{label:r("Category"),name:"cat_id",children:s.jsx(ms,{options:g==null?void 0:g.filter(e=>{if(!i.toInteger(t==null?void 0:t.cat_id)||(e==null?void 0:e.value)!=="")return!0})})})})}),xr?null:s.jsx(Z,{permissions:["edit-category"],children:s.jsx(M,{span:24,children:s.jsx(J.Item,{label:r("Tag"),name:"tag_ids",children:s.jsx(ms,{allowClear:!0,mode:"multiple",showSearch:!1,defaultValue:[],options:x==null?void 0:x.filter(e=>{if((e==null?void 0:e.value)!=="")return!0}),placeholder:`-- ${r("Select Tag")} --`,className:"sg-multiple-select"})})})}),s.jsx(Z,{permissions:["edit-status"],children:s.jsx(M,{span:24,children:s.jsx(J.Item,{label:r("Status"),name:"status",children:s.jsx(ms,{options:I})})})}),s.jsx(M,{span:24,children:s.jsxs(_,{children:[s.jsx(N,{type:"primary",htmlType:"submit",loading:!1,disabled:$,children:r("Save Changes")}),s.jsx(N,{htmlType:"button",onClick:o,children:r("Cancel")})]})})]})})}const{Text:As}=cs;function hr({data:t}){return s.jsx(es,{size:"small",title:r("Tutor LMS Courses (%d)",(t==null?void 0:t.length)||0),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0,maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:t==null?void 0:t.map((o,j)=>s.jsxs(s.Fragment,{children:[j?s.jsx(z,{style:{margin:0}}):null,s.jsxs(_,{size:0,direction:"vertical",style:{padding:"8px 12px",width:"100%"},children:[s.jsx(As,{children:s.jsx("a",{target:"_blank",href:(o==null?void 0:o.url)||"#",rel:"noopener",children:(o==null?void 0:o.name)||""})}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsxs(ns,{wrap:!0,children:[s.jsx(As,{style:{marginRight:"8px"},children:r("Status:")}),s.jsx(As,{children:r("Enrolled")})]})]},j)]}))})}const{Text:Ie}=cs;function ur({data:t}){return s.jsx(es,{size:"small",title:r("Ticket Logs (%d)",(t==null?void 0:t.length)||0),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0,maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:t==null?void 0:t.map((o,j)=>{var g;return s.jsxs(s.Fragment,{children:[j?s.jsx(z,{style:{margin:0}}):null,s.jsxs(_,{size:0,direction:"vertical",style:{padding:"8px 12px",width:"100%"},children:[s.jsxs(Ie,{children:[(o==null?void 0:o.log_msg)||""," - ",((g=o==null?void 0:o.log_by_obj)==null?void 0:g.display_name)||""]}),s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(ns,{children:s.jsx(ss,{title:He(o==null?void 0:o.entry_time),children:s.jsx(Ie,{style:{color:"rgba(0, 0, 0, 0.45)"},children:s.jsxs(ns,{align:"center",gap:4,wrap:!0,children:[s.jsx(Me,{}),Pe(o==null?void 0:o.entry_time)]})})})})]},j)]})})})}const jr=Ye(Ue,!0,[]),gr=t=>s.jsx(jr,{...t}),fr=qe(),yr=Hs();function mr({ticketId:t,setNoteOpen:o}){const j=[],g=["note_text"],x={note_text:""},I={note_text:""},C=Ps(),y=vs(),[f]=J.useForm(),[F,L]=p.useState(!0),[$,Y]=p.useState(""),[G,B]=ws(),V=(l,e)=>{e=i.mapValues(e,function(c){return i.isString(c)?i.trim(c):c});for(const c of j){const h=l==null?void 0:l[c];h&&i.includes(h,"*")&&(e[c]=I[c])}for(const c of g)(l==null?void 0:l[c])&&(e[c]=as((l==null?void 0:l[c])||""));const m=i.pick(I,i.keys(e));i.isEqual(m,e)?L(!0):L(!1)},Q=l=>{var m;const e=as(((m=l==null?void 0:l.note_text)==null?void 0:m.trim())||"");if(!e){f.setFieldValue("note_text",""),Y(r("%s is not valid.",r("Content")));return}G({params:{action:"ticket_note_add",id:t||0},data:{note_text:e}})},U=p.useCallback(()=>{o(!1)},[o]);return p.useEffect(()=>{var h,E,K,q;const{data:l,isLoading:e,isError:m,error:c}=B;y(e?us():js()),!e&&m&&((E=(h=c==null?void 0:c.data)==null?void 0:h.errors)!=null&&E.message)&&P.error((q=(K=c==null?void 0:c.data)==null?void 0:K.errors)==null?void 0:q.message),!e&&!m&&l&&(l!=null&&l.msg&&(l!=null&&l.status?(Y(""),P.success(l==null?void 0:l.msg)):Y(l==null?void 0:l.msg)),l!=null&&l.status&&U())},[B,U,y]),s.jsx(ts,{children:s.jsx(M,{span:24,children:s.jsx(es,{size:"small",styles:{body:{background:"#fffbe6"}},style:{margin:"0 0 32px 0"},children:s.jsx(J,{form:f,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:Q,onValuesChange:V,initialValues:x,children:s.jsxs(ts,{children:[$?s.jsx(M,{span:24,children:s.jsx(Es,{message:$,type:"error",showIcon:!0,closable:!0,afterClose:()=>Y(""),style:{marginBottom:"24px"}})}):null,s.jsx(M,{span:24,children:s.jsx(J.Item,{name:"note_text",rules:[{required:!0,message:r("%s is required.",r("Content")),whitespace:!0},{validator:(l,e)=>{const m=as(e||"");return!e||m?Promise.resolve():Promise.reject(new Error(r("%s is not valid.",r("Content"))))}}],htmlFor:null,children:!yr&&fr==="quill"?s.jsx(gr,{focus:!0,style:{background:"#ffffff"}}):s.jsx(Be,{id:"note",focus:!0})})}),s.jsx(M,{span:24,children:s.jsxs(_,{children:[s.jsx(N,{type:"primary",htmlType:"submit",loading:!1,disabled:F,children:C.xs?r("Add Note"):r("Add Internal Note")}),C.xs||C.lg?s.jsx(N,{color:"danger",variant:"text",icon:s.jsx(Ae,{}),onClick:U}):s.jsx(N,{color:"danger",variant:"text",onClick:U,children:r("Cancel")})]})})]})})})})})}const _r=Ye(Ue,!0,[],!0),br=t=>s.jsx(_r,{...t}),{Dragger:wr}=Ws,vr=qe(),Cr=Hs();function Tr({ticketId:t,ticketData:o,setReplyOpen:j,savedRepliesData:g,fileSettingsData:x}){const I=[],C=["reply_text"],y={reply_text:"",close:!1},f={reply_text:"",close:!1},F=Ps(),L=vs(),[$]=J.useForm(),[Y,G]=p.useState([]),[B,V]=p.useState(!0),[Q,U]=p.useState(""),[l,e]=In(),m=(u,T)=>{i.unset(T,"attached"),T=i.mapValues(T,function(w){return i.isString(w)?i.trim(w):w});for(const w of I){const X=u==null?void 0:u[w];X&&i.includes(X,"*")&&(T[w]=f[w])}for(const w of C)(u==null?void 0:u[w])&&(T[w]=as((u==null?void 0:u[w])||""));const A=i.pick(f,i.keys(T));i.isEqual(A,T)?V(!0):V(!1)},c=u=>{var X;const T=as(((X=u==null?void 0:u.reply_text)==null?void 0:X.trim())||""),A=u!=null&&u.close?"Y":"N";if(!T){$.setFieldValue("reply_text",""),U(r("%s is not valid.",r("Content")));return}const w=new FormData;w.append("ticket_id",t||0),w.append("is_private","N"),w.append("reply_text",T),w.append("close",A),Y.forEach(W=>{w.append("attached[]",W.originFileObj)}),l({params:{action:"ticket_reply_add"},data:w,headers:{"Content-Type":"multipart/form-data"}})},h=p.useCallback(()=>{j(!1)},[j]),E=u=>{const T=u.size,A=u.type,w=Ce(x==null?void 0:x.file_upload_size);return Te(x==null?void 0:x.allowed_type).includes(A)?T>w?(P.error(r("File size must be smaller than %s.",((x==null?void 0:x.file_upload_size)||2)+" MB")),Ws.LIST_IGNORE):!0:(P.error(r("Invalid file type.")),Ws.LIST_IGNORE)},K=({fileList:u,file:T})=>{const A=T.size,w=T.type,X=Ce(x==null?void 0:x.file_upload_size);if(!Te(x==null?void 0:x.allowed_type).includes(w)){P.error(r("Invalid file type."));return}if(A>X){P.error(r("File size must be smaller than %s.",((x==null?void 0:x.file_upload_size)||2)+" MB"));return}G(u)},q=u=>{const T=Y.indexOf(u),A=Y.slice().splice(T,1);G(A)};return p.useEffect(()=>{var X,W,Cs,gs;const{data:u,isLoading:T,isError:A,error:w}=e;L(T?us():js()),!T&&A&&((W=(X=w==null?void 0:w.data)==null?void 0:X.errors)!=null&&W.message)&&P.error((gs=(Cs=w==null?void 0:w.data)==null?void 0:Cs.errors)==null?void 0:gs.message),!T&&!A&&u&&(u!=null&&u.msg&&(u!=null&&u.status?(U(""),P.success(u==null?void 0:u.msg),G([])):U(u==null?void 0:u.msg)),u!=null&&u.status&&h())},[e,h,L]),s.jsx(ts,{children:s.jsx(M,{span:24,children:s.jsx(es,{size:"small",style:{margin:"0 0 32px 0"},children:s.jsx(J,{form:$,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:c,onValuesChange:m,initialValues:y,children:s.jsxs(ts,{children:[Q?s.jsx(M,{span:24,children:s.jsx(Es,{message:Q,type:"error",showIcon:!0,closable:!0,afterClose:()=>U(""),style:{marginBottom:"24px"}})}):null,s.jsx(M,{span:24,children:s.jsx(J.Item,{name:"reply_text",rules:[{required:!0,message:r("%s is required.",r("Content")),whitespace:!0},{validator:(u,T)=>{const A=as(T||"");return!T||A?Promise.resolve():Promise.reject(new Error(r("%s is not valid.",r("Content"))))}}],htmlFor:null,children:!Cr&&vr==="quill"?s.jsx(br,{focus:!0,savedReplies:g,style:{background:"#ffffff"}}):s.jsx(Be,{id:"reply",focus:!0,savedReplies:g})})}),x!=null&&x.ticket_file_upload?s.jsx(M,{span:24,children:s.jsx(J.Item,{name:"attached",children:s.jsx(wr,{multiple:!0,name:"attached",fileList:Y,onChange:K,onRemove:q,beforeUpload:E,accept:lr((x==null?void 0:x.allowed_type)||[],!0,!0),children:s.jsxs(ns,{align:"center",justify:"center",gap:4,wrap:!0,children:[s.jsx(Ne,{}),r("Click or drag file to upload")]})})})}):null,s.jsx(M,{span:24,hidden:!0,children:s.jsx(J.Item,{name:"close",valuePropName:"checked",hidden:!0,children:s.jsx(Le,{})})}),s.jsx(M,{span:24,children:s.jsxs(_,{children:[s.jsx(N,{color:"primary",variant:"solid",disabled:B,onClick:()=>{$.setFieldValue("close",!1),$.submit()},children:r("Submit Reply")}),i.includes(["C","D"],o==null?void 0:o.status)?null:s.jsx(bs,{hideOn:["xs"],children:s.jsx($e,{title:r("Reply and close ticket"),description:r("Are you sure want to submit reply and close ticket?"),onConfirm:()=>{$.setFieldValue("close",!0),$.submit()},okText:r("Yes"),cancelText:r("No"),icon:s.jsx(Os,{style:{color:"#faad14"}}),overlayStyle:{maxWidth:"300px"},children:s.jsx(N,{color:"danger",variant:"solid",disabled:B,children:r("Submit & Close Ticket")})})}),F.xs||F.lg?s.jsx(N,{color:"danger",variant:"text",icon:s.jsx(Ae,{}),onClick:h}):s.jsx(N,{color:"danger",variant:"text",onClick:h,children:r("Cancel")})]})})]})})})})})}const{Text:kr}=cs;function Ir({file:t,fileImagePopup:o,imageMimeTypes:j}){const g=(t==null?void 0:t.type)||"",x=(t==null?void 0:t.url)||"",I=i.last(x.split("/")),C=i.startsWith(g,"image/")||i.includes(j,g),[y,f]=p.useState(!1);return I?s.jsxs(s.Fragment,{children:[C&&o?s.jsx(Oe,{width:0,height:0,src:x,preview:{mask:null,visible:y,onVisibleChange:F=>{f(F)}},style:{display:"none",borderRadius:"6px",border:"1px solid #f9f0ff",cursor:"pointer",objectFit:"cover"}}):null,s.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",onClick:F=>{C&&o&&(F.preventDefault(),f(!0))},style:{display:"inline-block",lineHeight:0},children:s.jsxs(_,{children:[s.jsx(Ne,{style:{color:"#1677ff"}}),s.jsx(kr,{children:I})]})})]}):null}function Fr({file:t,fileImagePopup:o,imageMimeTypes:j,videoMimeTypes:g,audioMimeTypes:x,pdfMimeTypes:I,zipMimeTypes:C}){const y=(t==null?void 0:t.type)||"",f=(t==null?void 0:t.url)||"";if(i.startsWith(y,"image/")||i.includes(j,y))return s.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",onClick:F=>{o&&F.preventDefault()},style:{display:"inline-block",lineHeight:0},children:s.jsx(Oe,{width:24,height:24,src:f,preview:{mask:null,visible:o?void 0:!1},style:{borderRadius:"6px",border:"1px solid #f9f0ff",cursor:"pointer",objectFit:"cover"}})});{let F=s.jsx($n,{}),L="#e6f4ff",$="#1677ff";return i.startsWith(y,"video/")||i.includes(g,y)?(F=s.jsx(On,{}),L="#d6e4ff",$="#1d39c4"):i.startsWith(y,"audio/")||i.includes(x,y)?(F=s.jsx(Wn,{}),L="#f9f0ff",$="#531dab"):i.includes(C,y)?(F=s.jsx(Hn,{}),L="#fff2e8",$="#d4380d"):i.includes(I,y)&&(F=s.jsx(Pn,{}),L="#fde3cf",$="#f56a00"),s.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",lineHeight:0},children:s.jsx(hs,{shape:"square",size:24,icon:F,onClick:()=>window==null?void 0:window.open(f,"_blank","noopener,noreferrer"),style:{backgroundColor:L,color:$,cursor:"pointer"}})})}}const{Text:Ns}=cs,rs=or(),Fe=(rs==null?void 0:rs.image)||[],Er=(rs==null?void 0:rs.video)||[],zr=(rs==null?void 0:rs.audio)||[],Rr=(rs==null?void 0:rs.pdf)||[],Sr=(rs==null?void 0:rs.zip)||[];function Ee({data:t,ticket:o,fileSettingsData:j}){const g=(t==null?void 0:t.is_note)||!1,x=(t==null?void 0:t.replied_by_type)==="A",I=(t==null?void 0:t.reply_user)||null,C=(t==null?void 0:t.attached_files)||[],y=(j==null?void 0:j.file_image_popup)||!1,f=(j==null?void 0:j.file_preview_mode)||!1,F=i.toInteger((o==null?void 0:o.ticket_user)||0),$=i.toInteger((t==null?void 0:t.replied_by)||0)===F;let Y="#84adff",G="geekblue",B=r("Agent");return x||($?(Y="#ffbd8b",G="volcano",B=r("Starter")):(Y="#20d5f0",G="cyan",B=r("Participant"))),s.jsxs(ts,{style:{background:g?"#fffbe6":"transparent",borderLeft:`3px solid ${Y}`,padding:"24px 12px"},children:[s.jsx(M,{span:24,style:{marginBottom:"12px"},children:s.jsx(_s,{bordered:!1,color:G,children:g?r("Note by %s",B):B})}),s.jsx(M,{span:24,style:{marginBottom:"20px"},children:s.jsxs(_,{children:[s.jsx(hs,{size:"large",src:I==null?void 0:I.img}),s.jsxs(_,{direction:"vertical",size:0,children:[s.jsx(Ns,{style:{fontWeight:500},children:I==null?void 0:I.display_name}),s.jsx(ss,{title:He(t==null?void 0:t.reply_time),children:s.jsx(Ns,{style:{color:"rgba(0, 0, 0, 0.45)"},children:s.jsxs(ns,{align:"center",gap:4,children:[s.jsx(Me,{}),Pe(t==null?void 0:t.reply_time)]})})})]})]})}),s.jsx(M,{span:24,children:s.jsx("div",{className:"sg-reply-text",dangerouslySetInnerHTML:{__html:t==null?void 0:t.reply_text}})}),j&&(C!=null&&C.length)?s.jsxs(M,{span:24,children:[s.jsx(z,{orientation:"left",variant:"dashed",orientationMargin:0,style:{margin:"24px 0"},plain:!0,children:s.jsx(Ns,{children:r("Attachments (%d)",C==null?void 0:C.length)})}),f?s.jsx(_,{children:C==null?void 0:C.map((V,Q)=>s.jsx(Fr,{file:V,fileImagePopup:y,imageMimeTypes:Fe,videoMimeTypes:Er,audioMimeTypes:zr,pdfMimeTypes:Rr,zipMimeTypes:Sr},Q))}):s.jsx(_,{direction:"vertical",style:{width:"100%"},children:C==null?void 0:C.map((V,Q)=>s.jsx(Ir,{file:V,fileImagePopup:y,imageMimeTypes:Fe},Q))})]}):null]})}const{Text:D}=cs;function Lr({data:t}){const o=(t==null?void 0:t.products)||[],j=(t==null?void 0:t.shippings)||[],g=(t==null?void 0:t.totals)||[],x=(t==null?void 0:t.payments)||[],I=(t==null?void 0:t.others)||[],C=(t==null?void 0:t.more_link)||"";return s.jsx(es,{size:"small",title:r("Order Details"),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:"8px 12px",maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:s.jsxs(_,{direction:"vertical",size:16,style:{width:"100%"},children:[o!=null&&o.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(D,{style:{fontWeight:500},children:r("Products")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:o==null?void 0:o.map((y,f)=>f?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)})]}):s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)}))})]}):null,j!=null&&j.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(D,{style:{fontWeight:500},children:r("Shipping")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:j==null?void 0:j.map((y,f)=>f?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)})]}):s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)}))})]}):null,g!=null&&g.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(D,{style:{fontWeight:500},children:r("Totals")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:g==null?void 0:g.map((y,f)=>f?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)})]}):s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)}))})]}):null,x!=null&&x.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(D,{style:{fontWeight:500},children:r("Payment")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:x==null?void 0:x.map((y,f)=>f?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)})]}):s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)}))})]}):null,I!=null&&I.length?s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(D,{style:{fontWeight:500},children:r("Others")}),s.jsx(z,{style:{margin:"4px 0"}}),s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:I==null?void 0:I.map((y,f)=>f?s.jsxs(s.Fragment,{children:[s.jsx(z,{variant:"dashed",style:{margin:"4px 0"}}),s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)})]}):s.jsx(D,{style:{color:"rgba(0, 0, 0, 0.75)"},children:s.jsx("span",{dangerouslySetInnerHTML:{__html:y}},f)}))})]}):null,C?s.jsx(N,{size:"small",type:"primary",target:"_blank",href:C,ghost:!0,children:r("View Details")}):null]})})}const{Content:Mr,Sider:Ar}=We,{Text:ls,Title:Nr,Paragraph:ys}=cs;var Re;const ze=((Re=window==null?void 0:window.support_genix_config)==null?void 0:Re.lite)||!1,$r=[{key:"trash",label:r("Move to Trash")},{key:"remove",label:r("Delete"),danger:!0}],Or=[{value:"0",label:r("All Agents")}],Wr=[{value:"0",label:r("All Categories")}],Hr=[{value:"0",label:r("All Tags")}];function Vr(){var ce,de,ae,xe,pe,he,ue,je,ge;const t=Ps(),o=vs(),j=nr(),{hasAnyPermission:g}=Fn(),{ticketId:x}=rr(),[I,C]=p.useState(""),[y,f]=p.useState(!1),[F,L]=p.useState(!1),[$,Y]=p.useState(!1),[G,B]=p.useState(!1),[V,Q]=p.useState(!1),[U,l]=p.useState(null),[e,m]=p.useState(null),[c,h]=p.useState([]),[E,K]=p.useState([]),[q,u]=p.useState([]),[T,A]=p.useState([]),[w,X]=p.useState([]),[W,Cs]=p.useState([]),[gs,Ge]=p.useState([]),[Ys,Ke]=p.useState([]),[Us,Qe]=p.useState([]),[Bs,Xe]=p.useState(""),[xs,Je]=p.useState([]),[Ts,Ze]=p.useState(Or),[Ve,De]=p.useState(Wr),[ks,sn]=p.useState(Hr),[zs,en]=p.useState(null),[nn,qs]=p.useState(!0),[Gs,rn]=p.useState(!0),[Ks,tn]=p.useState(!0),[Qs,ln]=p.useState(!0),[Xs,on]=p.useState(!0),[Js,cn]=p.useState(!0),Rs=ye({action:"ticket_data_single",id:x}),Zs=ye({action:"ticket_status_for_select"}),Vs=En({action:"role_agent_for_select",select:!0}),Ds=zn({action:"ticket_category_data_for_select",select:!0}),se=Rn({action:"ticket_tag_data_for_select",select:!0}),ee=Sn({action:"settings_data_file"}),[Ss,ne]=ws(),[dn,re]=ws(),Is=p.useCallback(()=>{f(!1)},[]),an=p.useCallback(()=>{L(!1)},[]),xn=()=>{dn({params:{action:"ticket_download",id:x||0}})},pn=()=>{Rs.refetch()},te=n=>{let a="";n==="trash"?a="ticket_trash_item":n==="restore"?a="ticket_restore_item":n==="remove"&&(a="ticket_delete_item"),a&&Ss({params:{action:a,id:x||0}})},Fs=(n,a)=>{Ss({params:{action:"ticket_edit",id:x||0},data:{[n]:a}})},le=n=>{Ss({params:{action:"ticket_privacy_edit",id:x||0},data:{public:n}})},oe=()=>{let n=[];return(e==null?void 0:e.status)==="D"?(n=["trash"],g(["delete-ticket"])||n.push("remove")):(g(["move-to-trash"])||n.push("trash"),g(["delete-ticket"])||n.push("remove")),i.filter(i.map($r,function(v){return{...v,label:s.jsx(fs,{action:v.key,onConfirm:()=>{te(v.key),Q(!1)},onCancel:()=>{Q(!1)},children:s.jsx("span",{children:v.label})})}}),function(v){return!i.includes(n,v.key||"")})},hn=n=>{const{fileName:a,fileContent:v}=n;if(a&&v){const b=new Blob([v],{type:"application/pdf"}),k=document.createElement("a"),R=URL.createObjectURL(b);k.href=R,k.setAttribute("download",a),document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(R)}},Ls=(e==null?void 0:e.tag_ids)||[],ps=Ls==null?void 0:Ls.map(n=>ks==null?void 0:ks.find(({value:a})=>a===n));p.useEffect(()=>{!Gs&&!Ks&&!Qs&&!Xs&&!Js&&qs(!1)},[Gs,Ks,Qs,Xs,Js,qs]),p.useEffect(()=>{var k,R,O;const{data:n,isFetching:a,isError:v,error:b}=Rs;if(rn(a),!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n)if(!(n!=null&&n.status))j("/",{replace:!0});else{const d=(n==null?void 0:n.data)||null;if(!d)return;const ds=(d==null?void 0:d.user)||null,S=(d==null?void 0:d.ticket)||null,Ms=i.clone(d==null?void 0:d.replies)||[],un=(d==null?void 0:d.attached_files)||[],jn=(d==null?void 0:d.user_tickets)||[],gn=((O=d==null?void 0:d.custom_fields)==null?void 0:O.filter(H=>(H==null?void 0:H.input_name)&&(H==null?void 0:H.status)==="A"&&(H==null?void 0:H.where_to_create)==="T"))||[],fn=(d==null?void 0:d.cannedMsg)||[],yn=(d==null?void 0:d.order_details)||[],mn=(d==null?void 0:d.edd_orders)||[],_n=(d==null?void 0:d.envato_items)||[],bn=(d==null?void 0:d.tutorlms_items)||[],wn=(d==null?void 0:d.notes)||[],vn=(d==null?void 0:d.logs)||[],Cn=(d==null?void 0:d.hotlink)||"";Ms.unshift({asigned_by:(S==null?void 0:S.assigned_on)||"",attached_files:un,is_private:"N",is_user_seen:"N",replied_by:(S==null?void 0:S.ticket_user)||"",replied_by_type:(S==null?void 0:S.user_type)||"",reply_id:"0",reply_text:(S==null?void 0:S.ticket_body)||"",reply_time:(S==null?void 0:S.opened_time)||"",reply_user:ds,seen_time:"0000-00-00 00:00:00",ticket_id:(S==null?void 0:S.id)||"",ticket_status:(S==null?void 0:S.status)||""});let fe=1;for(const H of wn){const kn=1e3+fe;Ms.push({asigned_by:(S==null?void 0:S.assigned_on)||"",attached_files:[],is_private:"N",is_user_seen:"N",replied_by:(H==null?void 0:H.added_by)||"",replied_by_type:"A",reply_id:i.toString(kn),reply_text:(H==null?void 0:H.note_text)||"",reply_time:(H==null?void 0:H.entry_date)||"",reply_user:(H==null?void 0:H.added_by_obj)||null,seen_time:"0000-00-00 00:00:00",ticket_id:(S==null?void 0:S.id)||"",ticket_status:(S==null?void 0:S.status)||"",is_note:!0}),fe++}const Tn=i.orderBy(Ms,H=>$s(H.reply_time),"desc");l(ds),m(S),h(Tn),K(jn),u(gn),A(fn),X(yn),Cs(mn),Ge(_n),Ke(bn),Qe(vn),Xe(Cn)}},[Rs,j]),p.useEffect(()=>{var k,R,O,d;const{data:n,isFetching:a,isError:v,error:b}=Zs;tn(a),!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n&&n!=null&&n.status&&(O=n==null?void 0:n.data)!=null&&O.result&&Je((d=n==null?void 0:n.data)==null?void 0:d.result)},[Zs]),p.useEffect(()=>{var k,R,O,d;const{data:n,isFetching:a,isError:v,error:b}=Vs;ln(a),!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n&&n!=null&&n.status&&(O=n==null?void 0:n.data)!=null&&O.result&&Ze((d=n==null?void 0:n.data)==null?void 0:d.result)},[Vs]),p.useEffect(()=>{var k,R,O,d;const{data:n,isFetching:a,isError:v,error:b}=Ds;on(a),!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n&&n!=null&&n.status&&(O=n==null?void 0:n.data)!=null&&O.result&&De((d=n==null?void 0:n.data)==null?void 0:d.result)},[Ds]),p.useEffect(()=>{var k,R,O,d;const{data:n,isFetching:a,isError:v,error:b}=se;!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n&&n!=null&&n.status&&(O=n==null?void 0:n.data)!=null&&O.result&&sn((d=n==null?void 0:n.data)==null?void 0:d.result)},[se]),p.useEffect(()=>{var k,R;const{data:n,isFetching:a,isError:v,error:b}=ee;cn(a),!a&&v&&P.error((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)==null?void 0:R.message),!a&&!v&&n&&en((n==null?void 0:n.data)||{})},[ee]),p.useEffect(()=>{var R,O,d,ds,S;const{originalArgs:n,data:a,isLoading:v,isError:b,error:k}=ne;o(v?us():js()),!v&&b&&((O=(R=k==null?void 0:k.data)==null?void 0:R.errors)!=null&&O.message)&&P.error((ds=(d=k==null?void 0:k.data)==null?void 0:d.errors)==null?void 0:ds.message),!v&&!b&&a&&(a!=null&&a.msg&&(a!=null&&a.status?P.success(a==null?void 0:a.msg):P.error(a==null?void 0:a.msg)),a!=null&&a.status&&((S=n==null?void 0:n.params)==null?void 0:S.action)==="ticket_delete_item"&&j("/",{replace:!0}))},[ne,j,o]),p.useEffect(()=>{var k,R,O,d;const{data:n,isLoading:a,isError:v,error:b}=re;o(a?us():js()),!a&&v&&((R=(k=b==null?void 0:b.data)==null?void 0:k.errors)!=null&&R.message)&&P.error((d=(O=b==null?void 0:b.data)==null?void 0:O.errors)==null?void 0:d.message),!a&&!v&&n&&(n!=null&&n.msg&&(n!=null&&n.status?P.success(n==null?void 0:n.msg):P.error(n==null?void 0:n.msg)),n!=null&&n.status&&hn(n==null?void 0:n.data))},[re,o]);const ie=s.jsx(ts,{children:s.jsxs(M,{span:24,children:[s.jsx(es,{size:"small",styles:{body:{background:"#fafafa"}},children:s.jsxs(ns,{align:"center",justify:"space-between",gap:8,wrap:!0,children:[s.jsx(ss,{title:r("Ticket Track ID"),children:s.jsx(ls,{children:`#${e==null?void 0:e.ticket_track_id}`})}),s.jsxs(_,{children:[s.jsx(bs,{hideOn:["xs","sm","md","lg","xl","xxl"],children:s.jsx(ss,{title:r("Export Ticket"),children:s.jsx(N,{size:"small",icon:s.jsx(Yn,{}),onClick:xn})})}),s.jsx(Z,{permissions:["show-ticket-hotlink"],children:Bs?s.jsx(ss,{title:r("Copy Hotlink"),children:s.jsx("span",{children:s.jsx(tr,{size:"small",type:"default",icon:s.jsx(Un,{}),text:Bs})})}):null}),s.jsx(Z,{permissions:["change-privacy"],children:(e==null?void 0:e.is_public)==="Y"?s.jsx(fs,{action:"private",onConfirm:()=>le("N"),children:s.jsx(ss,{title:s.jsxs(_,{direction:"vertical",align:"center",size:0,children:[s.jsx("span",{children:r("Public Ticket")}),s.jsx("span",{children:r("Click to make it private.")})]}),children:s.jsx(N,{size:"small",color:"cyan",variant:"solid",icon:s.jsx(Bn,{}),style:{color:"#389e0d",background:"#f6ffed",borderColor:"#b7eb8f"},children:r("Public")})})}):s.jsx(fs,{action:"public",onConfirm:()=>le("Y"),children:s.jsx(ss,{title:s.jsxs(_,{direction:"vertical",align:"center",size:0,children:[s.jsx("span",{children:r("Private Ticket")}),s.jsx("span",{children:r("Click to make it public.")})]}),children:s.jsx(N,{size:"small",icon:s.jsx(qn,{}),style:{color:"#cf1322"}})})})})]})]})}),s.jsxs(es,{size:"small",style:{marginTop:"24px"},children:[s.jsxs(_,{direction:"vertical",style:{width:"100%"},children:[s.jsx(hs,{size:50,src:U==null?void 0:U.img}),s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsx(ls,{style:{fontWeight:500},children:U==null?void 0:U.display_name}),s.jsx(Z,{permissions:["show-ticket-email"],children:s.jsx(ls,{copyable:!0,children:(U==null?void 0:U.email)||""})})]})]}),!ze||(e==null?void 0:e.email_notification)!=="Y"?s.jsxs(s.Fragment,{children:[s.jsx(z,{style:{margin:"8px 0"}}),s.jsx($e,{title:r("Email notification"),description:(e==null?void 0:e.email_notification)==="Y"?r("Are you sure want to disable email notification to customer for this ticket?"):r("Are you sure want to enable email notification to customer for this ticket?"),onConfirm:()=>{Fs("email_notification",(e==null?void 0:e.email_notification)!=="Y"?"Y":"N")},okText:r("Yes"),cancelText:r("No"),icon:s.jsx(Os,{style:{color:"#faad14"}}),overlayStyle:{maxWidth:"300px"},children:s.jsx(ss,{title:r("Email notification to customer for this ticket."),children:s.jsx(Gn,{checked:(e==null?void 0:e.email_notification)==="Y",children:r("Email notification.")})})})]}):null]}),i.isEmpty(E)?null:s.jsx(es,{size:"small",title:r("Other Tickets (%d)",(E==null?void 0:E.length)||0),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0,maxHeight:"200px",overflowY:"auto"}},style:{marginTop:"24px"},children:E==null?void 0:E.map((n,a)=>{const v=(n==null?void 0:n.status)||"",b=v?xs==null?void 0:xs.find(({value:d})=>d===v):null,k=i.includes(["C","D"],v)?s.jsx(Kn,{}):v==="I"?s.jsx(Os,{}):s.jsx(Qn,{}),R=i.includes(["C","D"],v)?"#cf1322":v==="I"?"#d46b08":"#1d39c4",O=!i.includes(["I","C","D"],n==null?void 0:n.status)&&(n==null?void 0:n.last_replied_by_type)!=="A";return a?s.jsxs(s.Fragment,{children:[s.jsx(z,{style:{margin:0}}),s.jsxs(_,{direction:"vertical",size:4,style:{padding:"8px 12px"},children:[s.jsx(ve,{to:`/ticket/${n==null?void 0:n.id}`,children:s.jsx(ls,{children:n==null?void 0:n.title})}),s.jsxs(_,{size:4,children:[s.jsx(ss,{title:r("Status"),children:s.jsx(_s,{icon:k,bordered:!1,style:{color:R,margin:0},children:b==null?void 0:b.label})}),O?s.jsx(_s,{color:"red",bordered:!1,style:{margin:0},children:r("Need Reply")}):null]})]},n==null?void 0:n.id)]}):s.jsxs(_,{direction:"vertical",size:4,style:{padding:"8px 12px"},children:[s.jsx(ve,{to:`/ticket/${n==null?void 0:n.id}`,children:s.jsx(ls,{children:n==null?void 0:n.title})}),s.jsxs(_,{size:4,children:[s.jsx(ss,{title:r("Status"),children:s.jsx(_s,{icon:k,bordered:!1,style:{color:R,margin:0},children:b==null?void 0:b.label})}),O?s.jsx(_s,{color:"red",bordered:!1,style:{margin:0},children:r("Need Reply")}):null]})]},n==null?void 0:n.id)})}),e?s.jsx(es,{size:"small",title:r("Information"),extra:s.jsx(Z,{permissions:["edit-assigned","edit-category","edit-status"],children:s.jsx(ss,{title:r("Edit"),children:s.jsx(N,{type:"primary",icon:s.jsx(_e,{}),size:"small",ghost:!0,onClick:()=>{C("info"),f(!0)}})})}),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0}},style:{marginTop:"24px"},children:s.jsxs(_,{direction:"vertical",size:0,style:{width:"100%"},children:[s.jsxs(ns,{wrap:!0,style:{padding:"8px 12px"},children:[s.jsx(ls,{style:{fontWeight:500,marginRight:"8px"},children:r("Agent:")}),s.jsx(ys,{style:{margin:0},children:((ce=e==null?void 0:e.assigned_on_obj)==null?void 0:ce.display_name)||s.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:r("N/A")})})]}),s.jsx(z,{style:{margin:0}}),s.jsxs(ns,{wrap:!0,style:{padding:"8px 12px"},children:[s.jsx(ls,{style:{fontWeight:500,marginRight:"8px"},children:r("Category:")}),s.jsx(ys,{style:{margin:0},children:((de=e==null?void 0:e.cat_obj)==null?void 0:de.title)||s.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:r("N/A")})})]}),s.jsx(z,{style:{margin:0}}),ze?null:s.jsxs(s.Fragment,{children:[s.jsxs(ns,{wrap:!0,style:{padding:"8px 12px"},children:[s.jsx(ls,{style:{fontWeight:500,marginRight:"8px"},children:1<(ps==null?void 0:ps.length)?r("Tags:"):r("Tag:")}),s.jsx(ys,{style:{margin:0},children:i.isEmpty(ps)?s.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:r("N/A")}):(ae=ps==null?void 0:ps.map(n=>n==null?void 0:n.label))==null?void 0:ae.join(", ")})]}),s.jsx(z,{style:{margin:0}})]}),s.jsxs(ns,{wrap:!0,style:{padding:"8px 12px"},children:[s.jsx(ls,{style:{fontWeight:500,marginRight:"8px"},children:r("Status:")}),s.jsx(ys,{style:{margin:0},children:((xe=xs==null?void 0:xs.find(n=>(n==null?void 0:n.value)===(e==null?void 0:e.status)))==null?void 0:xe.label)||s.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:r("N/A")})})]})]})}):null,i.isEmpty(q)?null:s.jsx(es,{size:"small",title:r("Additional Data"),extra:s.jsx(Z,{permissions:["edit-custom-field","edit-wc-order-source","edit-envato-purchase-code","edit-elite-purchase-code"],children:s.jsx(ss,{title:r("Edit"),children:s.jsx(N,{type:"primary",icon:s.jsx(_e,{}),size:"small",ghost:!0,onClick:()=>{C("data"),f(!0)}})})}),styles:{header:{background:"#fafafa",fontWeight:500},body:{padding:0}},style:{marginTop:"24px"},children:s.jsx(_,{direction:"vertical",size:0,style:{width:"100%"},children:q==null?void 0:q.map((n,a)=>{var ds;const v=(n==null?void 0:n.field_type)||"",b=(n==null?void 0:n.input_name)||"",k=(n==null?void 0:n.field_label)||"",R=(n==null?void 0:n.field_value)||"",O=(n==null?void 0:n.fld_option)||"";let d=R;return v==="S"?d=R?r("Yes"):r("No"):(d=i.trim(R),b==="wc_store_id"&&(d=((ds=i.find(O,{id:i.toInteger(R)}))==null?void 0:ds.title)||""),d||(d=s.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:r("N/A")}))),s.jsxs(s.Fragment,{children:[a?s.jsx(z,{style:{margin:0}}):null,s.jsxs(ns,{wrap:!0,style:{padding:"8px 12px"},children:[s.jsx(ls,{style:{fontWeight:500,marginRight:"8px"},children:r("%s:",k)}),s.jsx(ys,{style:{margin:0},children:d})]},b)]})})})}),w!=null&&w.valid?s.jsx(Lr,{data:w}):null,W!=null&&W.valid?s.jsx(dr,{data:W}):null,i.isEmpty(gs)?null:s.jsx(ar,{data:gs}),i.isEmpty(Ys)?null:s.jsx(hr,{data:Ys}),i.isEmpty(Us)?null:s.jsx(ur,{data:Us})]})});return nn?s.jsx(Ln,{}):s.jsxs(s.Fragment,{children:[s.jsxs(We,{style:{background:"transparent",minHeight:t!=null&&t.wsm?"calc(100vh - 265px)":"calc(100vh - 210px)",padding:"16px 0"},children:[s.jsxs(Mr,{style:{padding:"0 16px"},children:[s.jsx(ts,{children:s.jsx(M,{span:24,children:s.jsxs(es,{size:"small",styles:{body:{background:"#fafafa"}},style:{margin:"0 0 32px 0"},children:[s.jsx(ts,{gutter:8,align:"middle",children:s.jsxs(M,{children:[s.jsx(N,{size:"small",color:"default",variant:"text",style:{display:"inline",marginRight:"4px"},onClick:()=>{j("/")},children:s.jsx(Xn,{})}),s.jsx(Nr,{level:5,style:{display:"inline",fontWeight:500,margin:0},children:e==null?void 0:e.title})]})}),s.jsx(z,{style:{margin:"12px 0"}}),s.jsxs(ts,{gutter:8,align:"middle",children:[s.jsx(M,{xs:{order:3},sm:{order:1},children:s.jsxs(_,{children:[s.jsx(Z,{permissions:["ticket-reply"],children:s.jsx(N,{color:"default",variant:"outlined",onClick:()=>{$||Y(!0),B(!1)},disabled:$,children:r("Reply")})}),s.jsx(Z,{permissions:["create-note"],children:s.jsx(N,{color:"default",variant:"outlined",onClick:()=>{G||B(!0),Y(!1)},disabled:G,children:r("Note")})}),g(["edit-assigned"])?s.jsx(be,{menu:{items:(pe=Ts==null?void 0:Ts.filter(n=>{if((n==null?void 0:n.value)!=="")return!0}))==null?void 0:pe.map(n=>({...n,key:n==null?void 0:n.value})),onClick:n=>{(e==null?void 0:e.assigned_on)!==(n==null?void 0:n.key)&&Fs("assigned_on",(n==null?void 0:n.key)||"")},defaultSelectedKeys:e!=null&&e.assigned_on?[e.assigned_on]:[],selectable:!0},placement:"bottom",trigger:["click"],children:s.jsx(ss,{title:e!=null&&e.assigned_on_obj?s.jsxs(_,{direction:"vertical",align:"center",size:0,children:[s.jsx("span",{children:r("Assigned on:")}),s.jsx("span",{children:(he=e==null?void 0:e.assigned_on_obj)==null?void 0:he.display_name})]}):r("Unassigned"),children:e!=null&&e.assigned_on_obj?s.jsx(hs,{src:((ue=e==null?void 0:e.assigned_on_obj)==null?void 0:ue.img)||"",style:{cursor:"pointer"}}):s.jsx(hs,{icon:s.jsx(we,{}),style:{cursor:"pointer"}})})}):s.jsx(ss,{title:e!=null&&e.assigned_on_obj?s.jsxs(_,{direction:"vertical",align:"center",size:0,children:[s.jsx("span",{children:r("Assigned on:")}),s.jsx("span",{children:(je=e==null?void 0:e.assigned_on_obj)==null?void 0:je.display_name})]}):r("Unassigned"),children:e!=null&&e.assigned_on_obj?s.jsx(hs,{src:((ge=e==null?void 0:e.assigned_on_obj)==null?void 0:ge.img)||""}):s.jsx(hs,{icon:s.jsx(we,{})})})]})}),t!=null&&t.xs?s.jsx(M,{xs:{order:2},span:24,children:s.jsx(z,{style:{margin:"12px 0"}})}):s.jsx(M,{sm:{order:2},flex:"auto"}),s.jsx(M,{xs:{order:1},sm:{order:3},children:s.jsxs(_,{children:[s.jsx(N,{icon:s.jsx(Jn,{}),onClick:pn}),(e==null?void 0:e.status)==="D"?s.jsx(Z,{permissions:["restore-ticket"],children:s.jsx(fs,{action:"restore",onConfirm:()=>te("restore"),children:s.jsx(N,{children:r("Restore")})})}):s.jsx(Z,{permissions:["edit-status"],children:s.jsx(fs,{action:(e==null?void 0:e.status)==="C"?"reopen":"close",onConfirm:()=>{(e==null?void 0:e.status)==="C"?Fs("status","R"):Fs("status","C")},children:s.jsx(N,{children:(e==null?void 0:e.status)==="C"?r("Re-open"):r("Close")})})}),i.isEmpty(oe())?null:s.jsx(be,{menu:{items:oe()},onOpenChange:(n,a)=>{(a.source==="trigger"||n)&&Q(n)},open:V,placement:"bottomRight",trigger:["click"],overlayClassName:"sg-confirm-dropdown",children:s.jsx(N,{icon:s.jsx(Zn,{})})}),s.jsx(bs,{showOn:["xs","sm","md"],children:F?s.jsx(N,{icon:s.jsx(Vn,{}),onClick:()=>{L(!1)}}):s.jsx(ss,{title:r("Ticket Data"),children:s.jsx(N,{icon:s.jsx(Dn,{}),onClick:()=>{L(!0)}})})})]})})]})]})})}),s.jsx(Z,{permissions:["ticket-reply"],children:$?s.jsx(Tr,{ticketId:x,ticketData:e,setReplyOpen:Y,savedRepliesData:T,fileSettingsData:zs}):null}),s.jsx(Z,{permissions:["create-note"],children:G?s.jsx(mr,{ticketId:x,setNoteOpen:B}):null}),s.jsx(ts,{children:s.jsx(M,{span:24,children:s.jsx(es,{size:"small",styles:{body:{padding:"0"}},style:{overflow:"hidden"},children:c==null?void 0:c.map((n,a)=>a?s.jsxs(s.Fragment,{children:[s.jsx(z,{style:{margin:"2px 0"}}),s.jsx(Ee,{data:n,ticket:e,fileSettingsData:zs},n==null?void 0:n.reply_id)]}):s.jsx(Ee,{data:n,ticket:e,fileSettingsData:zs},n==null?void 0:n.reply_id))})})})]}),s.jsx(bs,{showOn:["lg","xl","xxl"],children:s.jsx(Ar,{width:300,style:{background:"transparent",borderInlineStart:"1px solid rgba(5, 5, 5, 0.06)",padding:"0 16px"},children:ie})})]}),s.jsx(bs,{showOn:["xs","sm","md"],children:s.jsx(sr,{title:r("Ticket Data"),onClose:an,open:F,children:ie})}),s.jsx(er,{title:I==="info"?r("Edit %s",r("Information")):r("Edit %s",r("Additional Data")),centered:!0,open:y,onCancel:Is,onClose:Is,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:I==="info"?s.jsx(Z,{permissions:["edit-assigned","edit-category","edit-status"],children:s.jsx(pr,{data:e,onCloseModal:Is,agentUserSelectList:Ts,categorySelectList:Ve,tagSelectList:ks,statusSelectList:xs})}):s.jsx(cr,{ticketId:x,fields:q,onCloseModal:Is})})]})}export{Vr as default};
