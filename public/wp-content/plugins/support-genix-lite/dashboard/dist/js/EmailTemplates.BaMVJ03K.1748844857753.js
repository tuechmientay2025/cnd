import{j as e,u as de,K as me,s as ue,b as xe,c as je,t,_ as ee,i as fe,f as ge,L as Ee}from"../main.aHgQEcd5.1748844857753.js";import{r as u,u as Ce,k as ke}from"./vendor.Cii7CkpR.1748844857753.js";import{t as oe}from"./editor-value.B-WWB6lV.1748844857753.js";import{w as _,R as $,T as S,g as we}from"./withQuillEditorConfig.C5Id3VCK.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{g as L}from"./shortcode.DqNlmgdn.1748844857753.js";import{j as J,s as G,b as Z,C as g,u as Q,a as P,A as Ae,o as be,w as ye,B as D,T as te,aq as pe,ar as Te,as as he,F as ae,aa as le,Q as Se,n as Re,X as Oe,f as _e}from"./antd.v1CHGtH-.1748844857753.js";import{A as $e}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";const Le=L("email-template-AAT"),Ne=_($,!0,Le),Be=r=>e.jsx(Ne,{...r}),Me=L("email-template-ANR"),Fe=_($,!0,Me),Ie=r=>e.jsx(Fe,{...r}),qe=L("email-template-ANT"),Qe=_($,!0,qe),Ue=r=>e.jsx(Qe,{...r}),ve=L("email-template-EOT"),ze=_($,!0,ve),Pe=r=>e.jsx(ze,{...r}),Ge=L("email-template-ETC"),De=_($,!0,Ge),He=r=>e.jsx(De,{...r}),Xe=L("email-template-ETR"),Je=_($,!0,Xe),We=r=>e.jsx(Je,{...r}),Ye=L("email-template-TCL"),Ze=_($,!0,Ye),Ke=r=>e.jsx(Ze,{...r}),Ve=L("email-template-TRR"),et=_($,!0,Ve),tt=r=>e.jsx(et,{...r}),st=L("email-template-UOT"),it=_($,!0,st),rt=r=>e.jsx(it,{...r}),{Text:nt}=te,R=we(),O=fe(),ot=(r,i,p)=>{let b=i==null?void 0:i[r],N=p==null?void 0:p[r],o="default",j=null;switch(r){case"UOT":case"TRR":case"TCL":o="blue",j=e.jsx(he,{});break;case"EOT":case"ETR":case"ETC":o="purple",j=e.jsx(Te,{});break;default:o="orange",j=e.jsx(pe,{});break}return{title:b,recipient:N,color:o,icon:j}},at=r=>{let i=null;switch(r){case"ANT":i=!O&&R==="quill"?e.jsx(Ue,{onModal:!0}):e.jsx(S,{id:"ANT",kword:"email-template-ANT"});break;case"ANR":i=!O&&R==="quill"?e.jsx(Ie,{onModal:!0}):e.jsx(S,{id:"ANR",kword:"email-template-ANR"});break;case"AAT":i=!O&&R==="quill"?e.jsx(Be,{onModal:!0}):e.jsx(S,{id:"AAT",kword:"email-template-AAT"});break;case"UOT":i=!O&&R==="quill"?e.jsx(rt,{onModal:!0}):e.jsx(S,{id:"UOT",kword:"email-template-UOT"});break;case"TRR":i=!O&&R==="quill"?e.jsx(tt,{onModal:!0}):e.jsx(S,{id:"TRR",kword:"email-template-TRR"});break;case"TCL":i=!O&&R==="quill"?e.jsx(Ke,{onModal:!0}):e.jsx(S,{id:"TCL",kword:"email-template-TCL"});break;case"EOT":i=!O&&R==="quill"?e.jsx(Pe,{onModal:!0}):e.jsx(S,{id:"EOT",kword:"email-template-EOT"});break;case"ETR":i=!O&&R==="quill"?e.jsx(We,{onModal:!0}):e.jsx(S,{id:"ETR",kword:"email-template-ETR"});break;case"ETC":i=!O&&R==="quill"?e.jsx(He,{onModal:!0}):e.jsx(S,{id:"ETC",kword:"email-template-ETC"});break;default:i=null;break}return i};function lt({data:r,isEdit:i,onCloseModal:p,dataRoot:b,groupRoot:N}){const o=r?{...r,status:(r==null?void 0:r.status)==="A"}:{status:!0},j=de(),[E]=J.useForm(),[I,C]=u.useState(""),l=ot(o==null?void 0:o.k_word,b,N),U=at(o==null?void 0:o.k_word),[q,k]=me(),v=n=>{var w,A;const c=((w=n==null?void 0:n.subject)==null?void 0:w.trim())||"",x=oe(((A=n==null?void 0:n.content)==null?void 0:A.trim())||""),T=n!=null&&n.status?"A":"I";if(!x){E.setFieldValue("content",""),C(t("%s is not valid.",t("Content")));return}const y={content:x,status:T};ee.includes(["UOT","TRR","TCL","EOT","ETR","ETC"],o==null?void 0:o.k_word)||(y.subject=c),q({params:{action:"email_template_edit",id:o==null?void 0:o.k_word},data:y})};return u.useEffect(()=>{var y,w,A,z;const{data:n,isLoading:c,isError:x,error:T}=k;j(c?ue():xe()),!c&&x&&((w=(y=T==null?void 0:T.data)==null?void 0:y.errors)!=null&&w.message)&&G.error((z=(A=T==null?void 0:T.data)==null?void 0:A.errors)==null?void 0:z.message),!c&&!x&&n&&(n!=null&&n.msg&&(n!=null&&n.status?(C(""),G.success(n==null?void 0:n.msg)):(C(n==null?void 0:n.msg),je())),n!=null&&n.status&&p())},[k,p,j]),e.jsx(J,{form:E,name:"createEmailTemplate",layout:"vertical",onFinish:v,initialValues:o,autoComplete:"off",children:e.jsxs(Z,{gutter:16,children:[e.jsx(g,{span:24,children:e.jsxs(Q,{align:"center",style:{width:"100%",marginBottom:"24px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",padding:"6px 0"},children:[e.jsx(P,{color:l==null?void 0:l.color,style:{margin:0},bordered:!1,children:l==null?void 0:l.icon}),e.jsxs(nt,{children:[e.jsx("span",{style:{fontWeight:"500"},children:l==null?void 0:l.title}),e.jsx("span",{style:{margin:"0 4px"},children:"â€”"}),e.jsx("span",{children:l==null?void 0:l.recipient})]})]})}),I?e.jsx(g,{span:24,children:e.jsx(Ae,{message:I,type:"error",showIcon:!0,closable:!0,afterClose:()=>C(""),style:{marginBottom:"24px"}})}):null,e.jsx(g,{span:24,children:e.jsx(J.Item,{label:t("Subject"),name:"subject",rules:[{required:!0,message:t("%s is required.",t("Subject")),whitespace:!0}],children:e.jsx(be,{readOnly:ee.includes(["UOT","TRR","TCL","EOT","ETR","ETC"],o==null?void 0:o.k_word)})})}),e.jsx(g,{span:24,children:e.jsx(J.Item,{label:t("Content"),name:"content",rules:[{required:!0,message:t("%s is required.",t("Content")),whitespace:!0},{validator:(n,c)=>{const x=oe(c||"");return!c||x?Promise.resolve():Promise.reject(new Error(t("%s is not valid.",t("Content"))))}}],htmlFor:null,children:U})}),e.jsx(g,{span:24,children:e.jsx(J.Item,{label:t("Status"),name:"status",valuePropName:"checked",children:e.jsx(ye,{})})}),e.jsx(g,{span:24,style:{textAlign:"right"},children:e.jsxs(Q,{children:[e.jsx(D,{htmlType:"button",onClick:p,children:t("Cancel")}),e.jsx(D,{type:"primary",htmlType:"submit",loading:k==null?void 0:k.isLoading,children:i?t("Update"):t("Create")})]})})]})})}const{Text:ce}=te;function ct({data:r,total:i,limit:p,page:b,onPageChange:N,onSizeChange:o,rowSelection:j,bulkAction:E,setBulkAction:I,bulkActionIds:C,onEditClick:l,isLoading:U,resetBulkAction:q,sortOrder:k,handleSort:v,dataRoot:n,groupRoot:c}){const x=ge(),T=de(),[y,w]=me(),A=[];for(const s of Object.keys(n))A.push(r.find(d=>d.k_word===s));const z=()=>{let s="";E==="activate"?s="email_template_activate_items":E==="deactivate"&&(s="email_template_deactivate_items"),s&&y({params:{action:s,ids:C}})},B=(s,d,h,{action:m})=>{m==="sort"&&v(h)},M=s=>k===`${s}-asc`?"ascend":k===`${s}-desc`?"descend":null,K=[{title:t("Title"),dataIndex:"k_word",render:(s,d)=>{let h=null,m="default";switch(s){case"UOT":case"TRR":case"TCL":h=e.jsx(he,{}),m="blue";break;case"EOT":case"ETR":case"ETC":h=e.jsx(Te,{}),m="purple";break;default:h=e.jsx(pe,{}),m="orange";break}return e.jsxs(Q,{direction:"vertical",children:[e.jsxs(Q,{align:"center",children:[e.jsx(P,{color:m,style:{margin:0},bordered:!1,children:h}),n==null?void 0:n[s]]}),x.xs||x.sm||x.md||x.lg?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{gap:"0 8px",wrap:!0,children:[e.jsx(ce,{children:t("Recipient:")}),(c==null?void 0:c[d==null?void 0:d.k_word])||""]}),e.jsxs(ae,{gap:"0 8px",wrap:!0,children:[e.jsx(ce,{children:t("Status:")}),(d==null?void 0:d.status)==="A"?e.jsx(P,{color:"green",children:t("Active")}):e.jsx(P,{color:"default",children:t("Inactive")})]}),x.xs?e.jsx(Q,{children:e.jsx(D,{type:"primary",icon:e.jsx(le,{}),size:"small",ghost:!0,onClick:()=>l(d)})}):null]}):null]})},sorter:!1,sortDirections:["ascend","descend","ascend"],sortOrder:M("title")},{title:t("Recipient"),dataIndex:"k_word",render:s=>(c==null?void 0:c[s])||"",responsive:["xl"]},{title:t("Status"),dataIndex:"status",render:s=>s==="A"?e.jsx(P,{color:"green",children:t("Active")}):e.jsx(P,{color:"default",children:t("Inactive")}),responsive:["xl"]},{title:t("Action"),width:100,align:"right",render:s=>e.jsx(Q,{children:e.jsx(D,{type:"primary",icon:e.jsx(le,{}),size:"small",ghost:!0,onClick:()=>l(s)})}),responsive:["sm"]}],V=()=>{const s=i?(b-1)*p+1:0,d=ee.min([s+p-1,i]),h=t("Showing %1$d - %2$d of %3$d",s,d,i);return e.jsxs(Z,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(g,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(Z,{align:"middle",gutter:8,children:[e.jsx(g,{children:e.jsx(Re,{value:E,style:{width:140},onChange:m=>I(m),options:[{value:"",label:t("Bulk Actions")},{value:"activate",label:t("Activate")},{value:"deactivate",label:t("Deactivate")}],disabled:!(C!=null&&C.length)})}),e.jsx(g,{children:e.jsx($e,{action:E,onConfirm:()=>z(),children:e.jsx(D,{type:"primary",disabled:!E,children:t("Apply")})})})]})}),e.jsx(g,{style:{marginTop:"4px",marginBottom:"4px"},children:h})]})};return u.useEffect(()=>{var W,H,X,a;const{data:s,isLoading:d,isError:h,error:m}=w;T(d?ue():xe()),!d&&h&&((H=(W=m==null?void 0:m.data)==null?void 0:W.errors)!=null&&H.message)&&G.error((a=(X=m==null?void 0:m.data)==null?void 0:X.errors)==null?void 0:a.message),!d&&!h&&s&&(s!=null&&s.msg&&(s!=null&&s.status?G.success(s==null?void 0:s.msg):G.error(s==null?void 0:s.msg)),s!=null&&s.status&&q())},[w,q,T]),e.jsx(Se,{rowKey:s=>s==null?void 0:s.k_word,rowSelection:j,columns:K,dataSource:A,footer:V,loading:U,onChange:B,pagination:{total:i,pageSize:p,current:b,onChange:N,onShowSizeChange:o,showSizeChanger:i>10,style:{marginBottom:0}}})}const{Title:dt}=te;function gt(){const r=Ce(),[i,p]=ke(),[b,N]=u.useState((i==null?void 0:i.get("limit"))||20),[o,j]=u.useState((i==null?void 0:i.get("page"))||1),[E,I]=u.useState((i==null?void 0:i.get("sort"))||""),[C,l]=u.useState(""),[U,q]=u.useState([]),[k,v]=u.useState(!1),[n,c]=u.useState(null),[x,T]=u.useState(!1),[y,w]=u.useState(0),[A,z]=u.useState([]),B=Ee({action:"email_template_data",limit:b,page:o,sort:E||"id-asc"}),M=u.useCallback(()=>{l(""),q([])},[]),K=a=>{a===1?i.delete("page"):i.set("page",a),j(a),p(i),M()},V=(a,f)=>{f===20?i.delete("limit"):i.set("limit",f),N(f),p(i),M()},s={selectedRowKeys:U,onChange:a=>{a!=null&&a.length||M(),q(a)}},d=a=>{c(a),T(!0),v(!0)},h=u.useCallback(()=>{v(!1),c(null),T(!1)},[]),m=()=>{B.refetch(),M()},W=a=>{const{field:f,order:Y}=a||{};let F=f;Y==="ascend"?F+="-asc":F+="-desc",I(F),j(1),i.delete("page"),i.set("sort",F),p(i),M()};u.useEffect(()=>{var se,ie,re,ne;const{data:a,isFetching:f,isError:Y,error:F}=B;!f&&Y&&G.error((ie=(se=F==null?void 0:F.data)==null?void 0:se.errors)==null?void 0:ie.message),!f&&!Y&&a&&(z((re=a==null?void 0:a.data)==null?void 0:re.result),w(((ne=a==null?void 0:a.data)==null?void 0:ne.total)||0))},[B]),u.useEffect(()=>{const{search:a}=r,f=new URLSearchParams(a);f.has("limit")||N(20),f.has("page")||j(1),f.has("sort")||I("")},[r]);const H={ANT:t("Ticket Created"),ANR:t("Ticket Replied"),AAT:t("Ticket Assigned"),UOT:t("Ticket Created"),TRR:t("Ticket Replied"),TCL:t("Ticket Closed"),EOT:t("Ticket Created"),ETR:t("Ticket Replied"),ETC:t("Ticket Closed")},X={ANT:t("Admin or Agent"),ANR:t("Admin or Agent"),AAT:t("Admin or Agent"),UOT:t("Customer (Ticket Portal)"),TRR:t("Customer (Ticket Portal)"),TCL:t("Customer (Ticket Portal)"),EOT:t("Customer (Email to Ticket)"),ETR:t("Customer (Email to Ticket)"),ETC:t("Customer (Email to Ticket)")};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(g,{style:{paddingBottom:"8px"},children:e.jsx(dt,{level:5,style:{fontSize:"18px",margin:0},children:t("Email Notifications")})}),e.jsx(g,{style:{paddingBottom:"8px"},children:e.jsx(Q,{children:e.jsx(D,{type:"primary",icon:e.jsx(Oe,{}),onClick:m,ghost:!0})})})]}),e.jsx(ct,{data:A,total:y,limit:b,page:o,onPageChange:K,onSizeChange:V,rowSelection:s,bulkAction:C,setBulkAction:l,bulkActionIds:U,onEditClick:d,isLoading:B==null?void 0:B.isFetching,resetBulkAction:M,sortOrder:E,handleSort:W,dataRoot:H,groupRoot:X}),e.jsx(_e,{title:x?t("Edit %s",t("Email Notification")):t("Add New %s",t("Email Notification")),centered:!0,open:k,onCancel:h,onClose:h,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(lt,{isOpen:k,onCloseModal:h,data:n,isEdit:x,dataRoot:H,groupRoot:X})})]})}export{gt as default};
