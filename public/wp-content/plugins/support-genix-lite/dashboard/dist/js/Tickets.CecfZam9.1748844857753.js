import{j as e,_ as p,u as Fe,a as Ae,s as Ee,b as Se,c as Xe,t as n,i as ze,d as Es,e as Vs,f as Ss,g as Ds,h as et,k as ms,l as st,m as js,n as tt,o as nt}from"../main.aHgQEcd5.1748844857753.js";import{r as d,i as it,L as rt}from"./vendor.Cii7CkpR.1748844857753.js";import{S as Te}from"./ScreenGuard.CO_wY78U.1748844857753.js";import{g as Is,c as Pe,a as Ye,U as ke}from"./file-upload.BfWYB1nD.1748844857753.js";import{i as gs,j as B,s as Y,b as J,C as a,A as me,F as le,B as V,k as Ve,l as Ce,m as De,n as ce,o as he,p as lt,q as Rs,r as As,u as ne,T as Ie,U as we,v as ot,w as es,x as ct,y as Je,S as at,z as pt,E as zs,G as dt,d as oe,H as Ze,J as ys,K as fs,a as ae,N as ut,O as ht,P as xt,Q as mt,V as jt,L as Bs,W as gt,X as yt,D as _s,Y as ft,f as _t,Z as bt,_ as kt,$ as Tt}from"./antd.v1CHGtH-.1748844857753.js";import{t as xe}from"./editor-value.B-WWB6lV.1748844857753.js";import{w as ss,R as ts,T as ns,g as is,f as bs}from"./withQuillEditorConfig.C5Id3VCK.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{t as Ne,a as qe}from"./time-format.CWvin_m1.1748844857753.js";import{A as Ct}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{u as wt,a as Ft}from"./useSetToStorage.BQgVaF7I.1748844857753.js";const Et=ss(ts,!0,[]),St=o=>e.jsx(Et,{...o}),{Text:ks}=Ie,{Dragger:It}=we,Rt=is(),At=ze(),Ts="YYYY-MM-DD";function zt({setFormType:o,ticketUserData:m,onCloseModal:S,categorySelectList:g,fileSettingsData:r,basicSettings:b}){var ie;const I=((ie=b==null?void 0:b.custom_fields)==null?void 0:ie.ticket_form)||[],T={};for(const i of I){const h=(i==null?void 0:i.field_type)||"",y=(i==null?void 0:i.input_name)||"",t=(i==null?void 0:i.field_value)||"";if(h==="E")continue;let x=t;h==="N"?x=t?p.toNumber(t):"":h==="D"?x=t?gs(t):"":h==="S"?x=t?!!t:!1:x=p.trim(t),T[y]=x}const U={...T,cat_id:""},w=Fe(),[q]=B.useForm(),[c,L]=d.useState(""),[E,M]=d.useState([]),[l,_]=d.useState(""),[z,f]=Ae(),u=i=>{p.has(i,"cat_id")&&L((i==null?void 0:i.cat_id)||"")},R=i=>{var Q,re,D,W;const h=((Q=m==null?void 0:m.id)==null?void 0:Q.trim())||"",y=((re=i==null?void 0:i.cat_id)==null?void 0:re.trim())||"0",t=((D=i==null?void 0:i.title)==null?void 0:D.trim())||"",x=xe(((W=i==null?void 0:i.ticket_body)==null?void 0:W.trim())||"");if(!x){q.setFieldValue("ticket_body",""),_(n("%s is not valid.",n("Description")));return}const k={};for(const N in i){const F=I.find(H=>(H==null?void 0:H.input_name)===N);if(F){const H=(F==null?void 0:F.categories)||"";if(!p.isEmpty(H)&&!p.includes(H,y)&&!p.includes(H,"0"))return null;if(p.has(F,"is_editable")?(F==null?void 0:F.is_editable)||!1:!0){const je=(F==null?void 0:F.field_type)||"";je==="N"?k[N]=p.toString(i[N]):je==="D"?k[N]=gs(i[N]).format(Ts):je==="S"?k[N]=i[N]?1:0:k[N]=p.trim(i[N])}}}const C=new FormData;C.append("ticket_user",h),C.append("cat_id",y),C.append("title",t),C.append("ticket_body",x),C.append("custom_fields",JSON.stringify(k)),E.forEach(N=>{C.append("attached[]",N.originFileObj)}),z({params:{action:"ticket_add",id:U==null?void 0:U.id},data:C,headers:{"Content-Type":"multipart/form-data"}})},P=i=>{const h=i.size,y=i.type,t=Pe(r==null?void 0:r.file_upload_size);return Ye(r==null?void 0:r.allowed_type).includes(y)?h>t?(_(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB")),we.LIST_IGNORE):!0:(_(n("Invalid file type.")),we.LIST_IGNORE)},A=({fileList:i,file:h})=>{const y=h.size,t=h.type,x=Pe(r==null?void 0:r.file_upload_size);if(!Ye(r==null?void 0:r.allowed_type).includes(t)){_(n("Invalid file type."));return}if(y>x){n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB");return}M(i)},Z=i=>{const h=E.indexOf(i),y=E.slice().splice(h,1);M(y)};return d.useEffect(()=>{var x,k,C,Q;const{data:i,isLoading:h,isError:y,error:t}=f;w(h?Ee():Se()),!h&&y&&((k=(x=t==null?void 0:t.data)==null?void 0:x.errors)!=null&&k.message)&&Y.error((Q=(C=t==null?void 0:t.data)==null?void 0:C.errors)==null?void 0:Q.message),!h&&!y&&i&&(i!=null&&i.msg&&(i!=null&&i.status?(_(""),Y.success(i==null?void 0:i.msg)):(_(i==null?void 0:i.msg),Xe())),i!=null&&i.status&&S())},[f,S,w]),e.jsx(B,{form:q,name:"createTicket",layout:"vertical",onFinish:R,onValuesChange:u,initialValues:U,autoComplete:"off",children:e.jsxs(J,{gutter:16,children:[l?e.jsx(a,{span:24,children:e.jsx(me,{message:l,type:"error",showIcon:!0,closable:!0,afterClose:()=>_(""),style:{marginBottom:"24px"}})}):null,m?e.jsx(a,{span:24,children:e.jsxs(J,{children:[e.jsx(a,{span:24,children:e.jsxs(le,{align:"center",justify:"space-between",style:{marginBottom:"8px"},children:[e.jsx(ks,{children:n("Ticket User")}),e.jsx(V,{size:"small",onClick:()=>{o("search-user")},children:n("Change User")})]})}),e.jsx(a,{span:24,children:e.jsx(Ve,{size:"small",styles:{body:{padding:0}},style:{borderColor:"#d9d9d9",marginBottom:"24px"},children:e.jsx(Ce,{itemLayout:"horizontal",dataSource:[m],renderItem:i=>e.jsx(Ce.Item,{style:{padding:"8px",margin:0},children:e.jsx(Ce.Item.Meta,{avatar:e.jsx(De,{src:(i==null?void 0:i.avatar)||""}),title:i==null?void 0:i.name,description:i==null?void 0:i.email})}),className:"sg-ticket-users-list"})})})]})}):null,e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Category"),name:"cat_id",children:e.jsx(ce,{options:g})})}),e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Subject"),name:"title",rules:[{required:!0,message:n("%s is required.",n("Subject")),whitespace:!0}],children:e.jsx(he,{})})}),I==null?void 0:I.map(i=>{const h=(i==null?void 0:i.categories)||"";if(!p.isEmpty(h)&&!p.includes(h,c)&&!p.includes(h,"0"))return null;const y=(i==null?void 0:i.field_type)||"",t=(i==null?void 0:i.input_name)||"",x=(i==null?void 0:i.field_label)||"",k=(i==null?void 0:i.field_value)||"",C=(i==null?void 0:i.fld_option)||"",Q=(i==null?void 0:i.help_text)||"",re=(i==null?void 0:i.is_required)==="Y",D=(i==null?void 0:i.is_half_field)==="Y",W=p.has(i,"is_editable")?(i==null?void 0:i.is_editable)||!1:!0;let N=[];t==="wc_store_id"?N=C==null?void 0:C.map(X=>({value:p.toString(X==null?void 0:X.id),label:X==null?void 0:X.title})):N=C?C.split(",").map(X=>({value:X,label:X})):[],y==="W"&&!N.find(X=>(X==null?void 0:X.value)===k)&&(N=[{value:"",label:`-- ${n("Select")} ---`},...N]);let F=null;y==="T"?F=e.jsx(he,{placeholder:Q,disabled:!W}):y==="N"?F=e.jsx(ot,{placeholder:Q,disabled:!W,style:{width:"100%"}}):y==="D"?F=e.jsx(lt,{placeholder:Q||n("Select date"),format:Ts,disabled:!W,style:{width:"100%"}}):y==="S"?F=e.jsx(es,{disabled:!W}):y==="R"?F=e.jsx(Rs.Group,{options:N,disabled:!W}):y==="W"?F=e.jsx(ce,{placeholder:Q||n("Select option"),options:N,disabled:!W,style:{width:"100%"}}):y==="U"&&(F=e.jsx(he,{disabled:!W}));const H={};return y==="R"&&(H.htmlFor=null),e.jsx(a,{span:D?12:24,children:y==="E"?e.jsx(ks,{style:{display:"block",marginBottom:"24px"},children:C}):e.jsx(B.Item,{label:x,name:t,rules:[{required:!!(W&&re),message:n("This field is required.")}],...H,children:F})},t)}),e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Description"),name:"ticket_body",rules:[{required:!0,message:n("%s is required.",n("Description")),whitespace:!0},{validator:(i,h)=>{const y=xe(h||"");return!h||y?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Description"))))}}],htmlFor:null,children:!At&&Rt==="quill"?e.jsx(St,{onModal:!0}):e.jsx(ns,{id:"ticket"})})}),r!=null&&r.ticket_file_upload?e.jsx(a,{span:24,children:e.jsx(B.Item,{name:"attached",children:e.jsx(It,{multiple:!0,name:"attached",fileList:E,onChange:A,onRemove:Z,beforeUpload:P,accept:Is((r==null?void 0:r.allowed_type)||[],!0,!0),children:e.jsxs(le,{align:"center",justify:"center",gap:4,wrap:!0,children:[e.jsx(As,{}),n("Click or drag file to upload")]})})})}):null,e.jsx(a,{span:24,style:{textAlign:"right"},children:e.jsxs(ne,{children:[e.jsx(V,{htmlType:"button",onClick:S,children:n("Cancel")}),e.jsx(V,{type:"primary",htmlType:"submit",loading:f==null?void 0:f.isLoading,children:n("Create")})]})})]})})}function Bt({setFormType:o,setSearchTerm:m,setTicketUserData:S}){const g={email:"",first_name:"",last_name:"",notify:!0},r=Fe(),[b]=B.useForm(),[I,T]=d.useState(""),[U,w]=Ae(),q=c=>{var _,z,f;const L=((_=c==null?void 0:c.email)==null?void 0:_.trim())||"",E=((z=c==null?void 0:c.first_name)==null?void 0:z.trim())||"",M=((f=c==null?void 0:c.last_name)==null?void 0:f.trim())||"",l=c!=null&&c.notify?"Y":"N";U({params:{action:"users_add",id:g==null?void 0:g.id},data:{email:L,first_name:E,last_name:M,notify:l}})};return d.useEffect(()=>{var l,_,z,f,u;const{data:c,isLoading:L,isError:E,error:M}=w;r(L?Ee():Se()),!L&&E&&((_=(l=M==null?void 0:M.data)==null?void 0:l.errors)!=null&&_.message)&&Y.error((f=(z=M==null?void 0:M.data)==null?void 0:z.errors)==null?void 0:f.message),!L&&!E&&c&&(c!=null&&c.msg&&(c!=null&&c.status?T(""):(T(c==null?void 0:c.msg),Xe())),c!=null&&c.status&&(S(c==null?void 0:c.data),m(((u=c==null?void 0:c.data)==null?void 0:u.email)||""),o("create-ticket")))},[w,S,m,o,r]),e.jsx(B,{form:b,name:"createUser",layout:"vertical",onFinish:q,initialValues:g,autoComplete:"off",children:e.jsxs(J,{gutter:16,children:[I?e.jsx(a,{span:24,children:e.jsx(me,{message:I,type:"error",showIcon:!0,closable:!0,afterClose:()=>T(""),style:{marginBottom:"24px"}})}):null,e.jsx(a,{span:12,children:e.jsx(B.Item,{label:n("First Name"),name:"first_name",rules:[{required:!0,message:n("%s is required.",n("First name")),whitespace:!0}],children:e.jsx(he,{})})}),e.jsx(a,{span:12,children:e.jsx(B.Item,{label:n("Last Name"),name:"last_name",rules:[{required:!0,message:n("%s is required.",n("Last name")),whitespace:!0}],children:e.jsx(he,{})})}),e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Email Address"),name:"email",rules:[{required:!0,message:n("%s is required.",n("Email address")),whitespace:!0}],children:e.jsx(he,{})})}),e.jsx(a,{span:24,children:e.jsx(B.Item,{name:"notify",valuePropName:"checked",children:e.jsx(ct,{children:n("Send the new user an email about their account.")})})}),e.jsx(a,{span:24,style:{textAlign:"right"},children:e.jsxs(ne,{children:[e.jsx(V,{htmlType:"button",onClick:()=>{o("search-user")},children:n("Back")}),e.jsx(V,{type:"primary",htmlType:"submit",loading:w==null?void 0:w.isLoading,children:n("Create")})]})})]})})}const{Search:Lt}=he,{Text:$t}=Ie;function Mt({setFormType:o,searchTerm:m,setSearchTerm:S,setTicketUserData:g}){const r={search_term:m},{hasAnyPermission:b}=Es(),[I]=B.useForm(),[T,U]=d.useState(!1),[w,q]=d.useState(""),[c,L]=d.useState([]),E=Vs({action:"users_data_search",term:m}),M=l=>{var _;S(((_=l==null?void 0:l.search_term)==null?void 0:_.trim())||"")};return d.useEffect(()=>{I.submit()},[I]),d.useEffect(()=>{var u,R;const{data:l,isFetching:_,isError:z,error:f}=E;U(_),!_&&z&&Y.error((R=(u=f==null?void 0:f.data)==null?void 0:u.errors)==null?void 0:R.message),!_&&!z&&l&&L((l==null?void 0:l.data)||[])},[E]),e.jsxs(e.Fragment,{children:[e.jsx(B,{form:I,name:"searchUser",layout:"vertical",onFinish:M,initialValues:r,autoComplete:"off",children:e.jsxs(J,{gutter:16,children:[w?e.jsx(a,{span:24,children:e.jsx(me,{message:w,type:"error",showIcon:!0,closable:!0,afterClose:()=>q(""),style:{marginBottom:"24px"}})}):null,e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Search User"),name:"search_term",rules:[{whitespace:!0}],children:e.jsx(Lt,{enterButton:!0,allowClear:!0,onSearch:()=>{I.submit()},onClear:()=>{I.submit()}})})})]})}),e.jsxs(J,{children:[e.jsx(a,{span:24,children:e.jsxs(le,{align:"center",justify:"space-between",style:{marginBottom:"8px"},children:[e.jsx($t,{children:n("Select User")}),b(["create-ticket-user"])?e.jsx(V,{size:"small",icon:e.jsx(Je,{}),onClick:()=>{o("create-user")},children:n("Create User")}):null]})}),e.jsx(a,{span:24,children:e.jsx(Ve,{size:"small",styles:{body:{padding:0}},style:{borderColor:"#d9d9d9",overflow:"hidden"},children:e.jsx(at,{spinning:T,style:{maxHeight:"unset"},children:e.jsx(Ce,{itemLayout:"horizontal",dataSource:c,renderItem:l=>e.jsx(Ce.Item,{onClick:()=>{g(l),o("create-ticket")},style:{cursor:"pointer",padding:"8px",margin:0},children:e.jsx(Ce.Item.Meta,{avatar:e.jsx(De,{src:(l==null?void 0:l.avatar)||""}),title:l==null?void 0:l.name,description:l==null?void 0:l.email})}),className:"sg-search-users-list"})})})})]})]})}function Ot({setCreateTitle:o,onCloseModal:m,categorySelectList:S,fileSettingsData:g,basicSettings:r}){const[b,I]=d.useState("search-user"),[T,U]=d.useState(""),[w,q]=d.useState(null);d.useEffect(()=>{switch(b){case"create-user":o(n("Add New %s",n("User")));break;case"create-ticket":o(n("Add New %s",n("Ticket")));break;default:o(n("Choose User"));break}},[b,o]);function c(){let L=null;switch(b){case"create-user":L=e.jsx(Bt,{setFormType:I,setSearchTerm:U,setTicketUserData:q});break;case"create-ticket":L=e.jsx(zt,{setFormType:I,ticketUserData:w,onCloseModal:m,categorySelectList:S,fileSettingsData:g,basicSettings:r});break;default:L=e.jsx(Mt,{setFormType:I,searchTerm:T,setSearchTerm:U,setTicketUserData:q});break}return L}return e.jsx(e.Fragment,{children:c()})}const Ke=(o="")=>{var g;const m=((g=(o==null?void 0:o.trim())||"")==null?void 0:g.split(/\s+/))||[],S={full:o,first:o,last:""};return 2>m.length?S.first=m[0]:(S.last=m.pop(),S.first=m.join(" ")),S},{Paragraph:Nt,Text:pe}=Ie,Re=ze();function qt({data:o,total:m,limit:S,page:g,onPageChange:r,onSizeChange:b,rowSelection:I,bulkAction:T,setBulkAction:U,bulkActionIds:w,onActionClick:q,isLoading:c,resetBulkAction:L,handleSort:E,bulkActionList:M,statusSelectList:l,agentUserSelectList:_,categorySelectList:z,tagSelectList:f}){const u=Fe(),R=it(),[P,A]=Ae(),Z=()=>{let t="";T==="edit"?q("edit"):T==="reply"&&!Re?q("reply"):T==="note"&&!Re?q("note"):T==="trash"?t="ticket_trash_items":T==="restore"?t="ticket_restore_items":T==="remove"&&(t="ticket_delete_items"),t&&P({params:{action:t,ids:w}})},ie=(t,x,k,{action:C})=>{C==="sort"&&E(k)},i=t=>{R(`/ticket/${t==null?void 0:t.id}`)},h=[{title:"",width:40,render:t=>e.jsx(De,{size:"large",src:(t==null?void 0:t.user_img)||""}),responsive:["lg"]},{title:n("Title"),render:t=>{var ge,Be;const x=(t==null?void 0:t.status)||"",k=x?l==null?void 0:l.find(({value:G})=>G===x):null,C=p.includes(["C","D"],x)?e.jsx(pt,{}):x==="I"?e.jsx(zs,{}):e.jsx(dt,{}),Q=p.includes(["C","D"],x)?"#cf1322":x==="I"?"#d46b08":"#1d39c4",re=(t==null?void 0:t.cat_id)||"0",D=re&&re!=="0"?z==null?void 0:z.find(({value:G})=>G===re):null,W=(t==null?void 0:t.assigned_on)||"0",N=W&&W!=="0"?_==null?void 0:_.find(({value:G})=>G===W):null,F=N?Ke(N==null?void 0:N.label):null,H=Ke(t==null?void 0:t.display_name),X=((ge=bs(t==null?void 0:t.last_reply_text))==null?void 0:ge.result)||((Be=bs(t==null?void 0:t.ticket_body))==null?void 0:Be.result)||"",je=!p.includes(["I","C","D"],t==null?void 0:t.status)&&(t==null?void 0:t.last_replied_by_type)!=="A",ye=(t==null?void 0:t.tag_ids)||[],fe=ye==null?void 0:ye.map(G=>f==null?void 0:f.find(({value:Ue})=>Ue===G));return e.jsxs(J,{children:[e.jsxs(a,{span:24,children:[e.jsx(rt,{to:`/ticket/${t==null?void 0:t.id}`,onClick:G=>G.stopPropagation(),children:e.jsx(pe,{style:{fontWeight:500,marginRight:"8px"},children:t==null?void 0:t.title})}),e.jsx(oe,{title:H==null?void 0:H.full,children:e.jsx(pe,{style:{display:"inline-block",fontWeight:300},children:n("by %s",H==null?void 0:H.first)})})]}),e.jsx(a,{span:24,children:e.jsx(Nt,{style:{color:"rgba(0, 0, 0, 0.45)",height:"22px",width:"100%",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",margin:0,padding:0},children:X})}),e.jsx(Te,{showOn:["lg"],children:F?e.jsx(a,{span:24,style:{marginTop:8,marginBottom:4},children:e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Agent:")}),e.jsx("span",{children:F==null?void 0:F.full})]}),children:e.jsx(pe,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(Ze,{}),F==null?void 0:F.first]})})})}):null}),e.jsx(Te,{showOn:["xs","sm","md"],children:e.jsx(a,{span:24,style:{marginTop:8,marginBottom:4},children:e.jsxs(le,{gap:"0 8px",wrap:!0,children:[F?e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Agent:")}),e.jsx("span",{children:F==null?void 0:F.full})]}),children:e.jsx(pe,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(Ze,{}),F==null?void 0:F.first]})})}):null,e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Replied:")}),e.jsx("span",{children:Ne(t==null?void 0:t.last_reply_time)})]}),children:e.jsx(pe,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(ys,{}),qe(t==null?void 0:t.last_reply_time)]})})}),e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Created:")}),e.jsx("span",{children:Ne(t==null?void 0:t.opened_time)})]}),children:e.jsx(pe,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(fs,{}),qe(t==null?void 0:t.opened_time)]})})})]})})}),e.jsx(a,{span:24,style:{marginTop:8},children:e.jsxs(le,{gap:"4px 8px",align:"center",wrap:!0,children:[(t==null?void 0:t.is_public)==="Y"?e.jsx(oe,{title:n("Public Ticket"),children:e.jsx(ae,{icon:e.jsx(ut,{}),style:{color:"#389e0d",background:"#f6ffed",borderColor:"#b7eb8f",margin:0},children:n("Public")})}):null,e.jsx(oe,{title:n("Status"),children:e.jsx(ae,{icon:C,bordered:!1,style:{color:Q,margin:0},children:k==null?void 0:k.label})}),D?e.jsx(oe,{title:n("Category"),children:e.jsx(ae,{icon:e.jsx(ht,{}),bordered:!1,style:{color:"#0958d9",margin:0},children:D==null?void 0:D.label})}):null,!Re&&!p.isEmpty(fe)&&(fe==null?void 0:fe.map(G=>e.jsx(oe,{title:n("Tag"),children:e.jsx(ae,{icon:e.jsx(xt,{}),bordered:!1,style:{color:"#08979c",margin:0},children:G==null?void 0:G.label})},G==null?void 0:G.value))),e.jsx(oe,{title:n("Ticket Track ID"),children:e.jsx(ae,{bordered:!1,style:{color:"rgba(0, 0, 0, 0.45)",margin:0},children:`#${t==null?void 0:t.ticket_track_id}`})})]})}),e.jsx(Te,{showOn:["xs","sm","md"],children:e.jsx(a,{span:24,style:{marginTop:8},children:e.jsxs(le,{gap:"4px 8px",align:"center",wrap:!0,children:[e.jsx(oe,{title:n("Reply"),children:e.jsx(ae,{style:{margin:0},children:p.toInteger(t==null?void 0:t.reply_counter)||0})}),je?e.jsx(ae,{color:"red",style:{margin:0},children:n("Need Reply")}):null]})})})]})}},{title:n("Reply"),render:t=>{const x=!p.includes(["I","C","D"],t==null?void 0:t.status)&&(t==null?void 0:t.last_replied_by_type)!=="A";return e.jsxs(ne,{direction:"vertical",size:4,children:[e.jsx(ae,{style:{margin:0},children:p.toInteger(t==null?void 0:t.reply_counter)||0}),x?e.jsx(ae,{color:"red",style:{margin:0},children:n("Need Reply")}):null]})},responsive:["lg"]},{title:n("Agent"),dataIndex:"assigned_on",render:t=>{const x=t?_==null?void 0:_.find(({value:k})=>k===t):null;if(x){const k=Ke(x==null?void 0:x.label);return e.jsx(oe,{title:k==null?void 0:k.full,children:e.jsx(pe,{style:{whiteSpace:"nowrap"},children:k==null?void 0:k.first})})}return e.jsx("span",{children:"â€”"})},responsive:["xl"]},{title:n("Date"),width:100,render:t=>e.jsxs(ne,{direction:"vertical",size:4,children:[e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Replied:")}),e.jsx("span",{children:Ne(t==null?void 0:t.last_reply_time)})]}),children:e.jsx(pe,{style:{whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(ys,{}),qe(t==null?void 0:t.last_reply_time)]})})}),e.jsx(oe,{title:e.jsxs(ne,{direction:"vertical",align:"center",size:0,children:[e.jsx("span",{children:n("Created:")}),e.jsx("span",{children:Ne(t==null?void 0:t.opened_time)})]}),children:e.jsx(pe,{style:{color:"rgba(0, 0, 0, 0.45)",whiteSpace:"nowrap"},children:e.jsxs(le,{align:"center",gap:4,children:[e.jsx(fs,{}),qe(t==null?void 0:t.opened_time)]})})})]}),responsive:["lg"]}],y=()=>{const t=m?(g-1)*S+1:0,x=p.min([t+S-1,m]),k=n("Showing %1$d - %2$d of %3$d",t,x,m);return e.jsxs(J,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(a,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(J,{align:"middle",gutter:8,children:[e.jsx(a,{children:e.jsx(ce,{value:T,style:{width:140},onChange:C=>U(C),options:M,disabled:!(w!=null&&w.length)})}),e.jsx(a,{children:e.jsx(Ct,{action:T,onConfirm:()=>Z(),children:e.jsx(V,{type:"primary",disabled:!T,onClick:()=>{(T==="edit"||T==="reply"&&!Re||T==="note"&&!Re)&&Z()},children:n("Apply")})})})]})}),e.jsx(a,{style:{marginTop:"4px",marginBottom:"4px"},children:k})]})};return d.useEffect(()=>{var Q,re,D,W;const{data:t,isLoading:x,isError:k,error:C}=A;u(x?Ee():Se()),!x&&k&&((re=(Q=C==null?void 0:C.data)==null?void 0:Q.errors)!=null&&re.message)&&Y.error((W=(D=C==null?void 0:C.data)==null?void 0:D.errors)==null?void 0:W.message),!x&&!k&&t&&(t!=null&&t.msg&&(t!=null&&t.status?Y.success(t==null?void 0:t.msg):Y.error(t==null?void 0:t.msg)),t!=null&&t.status&&L())},[A,L,u]),e.jsx(mt,{rowKey:t=>t==null?void 0:t.id,rowSelection:I,columns:h,dataSource:o,footer:y,loading:c,onChange:ie,onRow:t=>({onClick:()=>i(t),style:{cursor:"pointer"}}),pagination:{total:m,pageSize:S,current:g,onChange:r,onShowSizeChange:b,showSizeChanger:m>10,style:{marginBottom:0}},className:"sg-tickets-table"})}const Pt=ze();function Yt({resetBulkAction:o,onCloseModal:m,bulkActionIds:S,statusSelectList:g,agentUserSelectList:r,categorySelectList:b,tagSelectList:I}){const T={assigned_on:"",cat_id:"",tag_ids:[],status:""},U=Fe(),[w]=B.useForm(),[q,c]=d.useState(""),[L,E]=Ae(),M=l=>{var R,P,A,Z;const _=((R=l==null?void 0:l.assigned_on)==null?void 0:R.trim())||"",z=((P=l==null?void 0:l.cat_id)==null?void 0:P.trim())||"",f=((A=l==null?void 0:l.tag_ids)==null?void 0:A.map(ie=>ie==null?void 0:ie.trim()))||[],u=((Z=l==null?void 0:l.status)==null?void 0:Z.trim())||"";if(!_&&!z&&!f&&!u){c(n("Invalid data."));return}L({params:{action:"ticket_bulk_edit",ids:S},data:{assigned_on:_,cat_id:z,tag_ids:f,status:u}})};return d.useEffect(()=>{var u,R,P,A;const{data:l,isLoading:_,isError:z,error:f}=E;U(_?Ee():Se()),!_&&z&&((R=(u=f==null?void 0:f.data)==null?void 0:u.errors)!=null&&R.message)&&Y.error((A=(P=f==null?void 0:f.data)==null?void 0:P.errors)==null?void 0:A.message),!_&&!z&&l&&(l!=null&&l.msg&&(l!=null&&l.status?(c(""),Y.success(l==null?void 0:l.msg)):(c(l==null?void 0:l.msg),Xe())),l!=null&&l.status&&(o(),m()))},[E,o,m,U]),e.jsx(B,{form:w,name:"quickEditTicket",layout:"vertical",onFinish:M,initialValues:T,autoComplete:"off",children:e.jsxs(J,{gutter:16,children:[q?e.jsx(a,{span:24,children:e.jsx(me,{message:q,type:"error",showIcon:!0,closable:!0,afterClose:()=>c(""),style:{marginBottom:"24px"}})}):null,e.jsx(ke,{permissions:["edit-assigned"],children:e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Assign Agent"),name:"assigned_on",children:e.jsx(ce,{options:r})})})}),e.jsx(ke,{permissions:["edit-category"],children:e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Set Category"),name:"cat_id",children:e.jsx(ce,{options:b})})})}),Pt?null:e.jsx(ke,{permissions:["edit-category"],children:e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Set Tag"),name:"tag_ids",children:e.jsx(ce,{allowClear:!0,mode:"multiple",showSearch:!1,defaultValue:[],options:I==null?void 0:I.filter(l=>{if((l==null?void 0:l.value)!=="")return!0}),placeholder:`-- ${n("Select Tag")} --`,className:"sg-multiple-select"})})})}),e.jsx(ke,{permissions:["edit-status"],children:e.jsx(a,{span:24,children:e.jsx(B.Item,{label:n("Set Status"),name:"status",children:e.jsx(ce,{options:g})})})}),e.jsx(a,{span:24,style:{textAlign:"right"},children:e.jsxs(ne,{children:[e.jsx(V,{htmlType:"button",onClick:m,children:n("Cancel")}),e.jsx(V,{type:"primary",htmlType:"submit",loading:E==null?void 0:E.isLoading,children:n("Update")})]})})]})})}const Ut=ss(ts,!0,[]),Qt=o=>e.jsx(Ut,{...o}),{Text:Cs}=Ie,Gt=is(),Wt=ze();function vt({ticketIds:o,resetBulkAction:m,onCloseModal:S}){const g=(o==null?void 0:o.length)||0,r=[],b=["note_text"],I={note_text:""},T={note_text:""},U=Ss(),w=Fe(),[q]=B.useForm(),[c,L]=d.useState(!0),[E,M]=d.useState(""),[l,_]=Ae(),z=(u,R)=>{R=p.mapValues(R,function(A){return p.isString(A)?p.trim(A):A});for(const A of r){const Z=u==null?void 0:u[A];Z&&p.includes(Z,"*")&&(R[A]=T[A])}for(const A of b)(u==null?void 0:u[A])&&(R[A]=xe((u==null?void 0:u[A])||""));const P=p.pick(T,p.keys(R));p.isEqual(P,R)?L(!0):L(!1)},f=u=>{var P;const R=xe(((P=u==null?void 0:u.note_text)==null?void 0:P.trim())||"");if(!R){q.setFieldValue("note_text",""),M(n("%s is not valid.",n("Content")));return}l({params:{action:"ticket_note_add_bulk",ids:o||[]},data:{note_text:R}})};return d.useEffect(()=>{var Z,ie,i,h;const{data:u,isLoading:R,isError:P,error:A}=_;w(R?Ee():Se()),!R&&P&&((ie=(Z=A==null?void 0:A.data)==null?void 0:Z.errors)!=null&&ie.message)&&Y.error((h=(i=A==null?void 0:A.data)==null?void 0:i.errors)==null?void 0:h.message),!R&&!P&&u&&(u!=null&&u.msg&&(u!=null&&u.status?(M(""),Y.success(u==null?void 0:u.msg)):M(u==null?void 0:u.msg)),u!=null&&u.status&&(m(),S()))},[_,m,S,w]),e.jsx(J,{style:{marginTop:"12px"},children:e.jsx(a,{span:24,children:e.jsx(B,{form:q,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:f,onValuesChange:z,initialValues:I,children:e.jsxs(J,{children:[20<g?e.jsx(a,{span:24,children:e.jsx(me,{message:e.jsxs(ne,{direction:"vertical",size:0,children:[e.jsx(Cs,{style:{fontWeight:500},children:n("You've selected %d tickets to add internal note to at once.",g)}),e.jsx(Cs,{children:n("For the best performance and reliability, we recommend selecting no more than 20 tickets at a time.")})]}),type:"warning",showIcon:!0,style:{marginBottom:"24px"}})}):null,E?e.jsx(a,{span:24,children:e.jsx(me,{message:E,type:"error",showIcon:!0,closable:!0,afterClose:()=>M(""),style:{marginBottom:"24px"}})}):null,e.jsx(a,{span:24,children:e.jsx(B.Item,{name:"note_text",rules:[{required:!0,message:n("%s is required.",n("Content")),whitespace:!0},{validator:(u,R)=>{const P=xe(R||"");return!R||P?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Content"))))}}],htmlFor:null,children:!Wt&&Gt==="quill"?e.jsx(Qt,{focus:!0,style:{background:"#ffffff"}}):e.jsx(ns,{id:"note",focus:!0})})}),e.jsx(a,{span:24,children:e.jsxs(ne,{children:[e.jsx(V,{type:"primary",htmlType:"submit",loading:!1,disabled:c,children:U.xs?n("Add Note"):n("Add Internal Note")}),e.jsx(V,{color:"danger",variant:"text",onClick:S,children:n("Cancel")})]})})]})})})})}const Kt=ss(ts,!0,[],!0),Ht=o=>e.jsx(Kt,{...o}),{Text:ws}=Ie,{Dragger:Jt}=we,Zt=is(),Xt=ze();function Vt({ticketIds:o,resetBulkAction:m,onCloseModal:S,savedRepliesData:g,fileSettingsData:r}){const b=(o==null?void 0:o.length)||0,I=[],T=["reply_text"],U={reply_text:"",close:!1},w={reply_text:"",close:!1},q=Fe(),[c]=B.useForm(),[L,E]=d.useState([]),[M,l]=d.useState(!0),[_,z]=d.useState(""),[f,u]=Ds(),R=(i,h)=>{p.unset(h,"attached"),h=p.mapValues(h,function(t){return p.isString(t)?p.trim(t):t});for(const t of I){const x=i==null?void 0:i[t];x&&p.includes(x,"*")&&(h[t]=w[t])}for(const t of T)(i==null?void 0:i[t])&&(h[t]=xe((i==null?void 0:i[t])||""));const y=p.pick(w,p.keys(h));p.isEqual(y,h)?l(!0):l(!1)},P=i=>{var x;const h=xe(((x=i==null?void 0:i.reply_text)==null?void 0:x.trim())||""),y=i!=null&&i.close?"Y":"N";if(!h){c.setFieldValue("reply_text",""),z(n("%s is not valid.",n("Content")));return}const t=new FormData;t.append("ticket_ids",o||[]),t.append("is_private","N"),t.append("reply_text",h),t.append("close",y),L.forEach(k=>{t.append("attached[]",k.originFileObj)}),f({params:{action:"ticket_reply_add_bulk"},data:t,headers:{"Content-Type":"multipart/form-data"}})},A=i=>{const h=i.size,y=i.type,t=Pe(r==null?void 0:r.file_upload_size);return Ye(r==null?void 0:r.allowed_type).includes(y)?h>t?(Y.error(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB")),we.LIST_IGNORE):!0:(Y.error(n("Invalid file type.")),we.LIST_IGNORE)},Z=({fileList:i,file:h})=>{const y=h.size,t=h.type,x=Pe(r==null?void 0:r.file_upload_size);if(!Ye(r==null?void 0:r.allowed_type).includes(t)){Y.error(n("Invalid file type."));return}if(y>x){Y.error(n("File size must be smaller than %s.",((r==null?void 0:r.file_upload_size)||2)+" MB"));return}E(i)},ie=i=>{const h=L.indexOf(i),y=L.slice().splice(h,1);E(y)};return d.useEffect(()=>{var x,k,C,Q;const{data:i,isLoading:h,isError:y,error:t}=u;q(h?Ee():Se()),!h&&y&&((k=(x=t==null?void 0:t.data)==null?void 0:x.errors)!=null&&k.message)&&Y.error((Q=(C=t==null?void 0:t.data)==null?void 0:C.errors)==null?void 0:Q.message),!h&&!y&&i&&(i!=null&&i.msg&&(i!=null&&i.status?(z(""),Y.success(i==null?void 0:i.msg),E([])):z(i==null?void 0:i.msg)),i!=null&&i.status&&(m(),S()))},[u,m,S,q]),e.jsx(J,{style:{marginTop:"12px"},children:e.jsx(a,{span:24,children:e.jsx(B,{form:c,name:"replyForm",layout:"vertical",autoComplete:"off",onFinish:P,onValuesChange:R,initialValues:U,children:e.jsxs(J,{children:[20<b?e.jsx(a,{span:24,children:e.jsx(me,{message:e.jsxs(ne,{direction:"vertical",size:0,children:[e.jsx(ws,{style:{fontWeight:500},children:n("You've selected %d tickets to reply to at once.",b)}),e.jsx(ws,{children:n("For the best performance and reliability, we recommend selecting no more than 20 tickets at a time.")})]}),type:"warning",showIcon:!0,style:{marginBottom:"24px"}})}):null,_?e.jsx(a,{span:24,children:e.jsx(me,{message:_,type:"error",showIcon:!0,closable:!0,afterClose:()=>z(""),style:{marginBottom:"24px"}})}):null,e.jsx(a,{span:24,children:e.jsx(B.Item,{name:"reply_text",rules:[{required:!0,message:n("%s is required.",n("Content")),whitespace:!0},{validator:(i,h)=>{const y=xe(h||"");return!h||y?Promise.resolve():Promise.reject(new Error(n("%s is not valid.",n("Content"))))}}],htmlFor:null,children:!Xt&&Zt==="quill"?e.jsx(Ht,{focus:!0,savedReplies:g,style:{background:"#ffffff"}}):e.jsx(ns,{id:"reply",focus:!0,savedReplies:g})})}),r!=null&&r.ticket_file_upload?e.jsx(a,{span:24,children:e.jsx(B.Item,{name:"attached",children:e.jsx(Jt,{multiple:!0,name:"attached",fileList:L,onChange:Z,onRemove:ie,beforeUpload:A,accept:Is((r==null?void 0:r.allowed_type)||[],!0,!0),children:e.jsxs(le,{align:"center",justify:"center",gap:4,wrap:!0,children:[e.jsx(As,{}),n("Click or drag file to upload")]})})})}):null,e.jsx(a,{span:24,hidden:!0,children:e.jsx(B.Item,{name:"close",valuePropName:"checked",hidden:!0,children:e.jsx(es,{})})}),e.jsx(a,{span:24,children:e.jsxs(ne,{children:[e.jsx(V,{color:"primary",variant:"solid",disabled:M,onClick:()=>{c.setFieldValue("close",!1),c.submit()},children:n("Submit Reply")}),e.jsx(Te,{hideOn:["xs"],children:e.jsx(jt,{title:n("Reply and close ticket"),description:n("Are you sure want to submit reply and close ticket?"),onConfirm:()=>{c.setFieldValue("close",!0),c.submit()},okText:n("Yes"),cancelText:n("No"),icon:e.jsx(zs,{style:{color:"#faad14"}}),overlayStyle:{maxWidth:"300px"},children:e.jsx(V,{color:"danger",variant:"solid",disabled:M,children:n("Submit & Close Ticket")})})}),e.jsx(V,{color:"danger",variant:"text",onClick:S,children:n("Cancel")})]})})]})})})})}const{Content:Dt}=Bs,{Search:en}=he,{Text:Ls}=Ie;var Fs;const de=((Fs=window==null?void 0:window.support_genix_config)==null?void 0:Fs.lite)||!1,sn=[{key:"T",label:n("All Tickets"),icon:e.jsx(bt,{})},{key:"MY",label:n("My Tickets"),icon:e.jsx(Ze,{})},{key:"UA",label:n("Unassigned"),icon:e.jsx(kt,{})},{key:"D",label:n("Trashed"),icon:e.jsx(Tt,{})}],tn=[{value:"A",label:n("Active")},{value:"I",label:n("Inactive")},{value:"C",label:n("Closed")},{value:"ST",label:n("All")}],nn=[{value:"last_reply_time-desc",label:n("Sort: Reply Date (Newest First)")},{value:"last_reply_time-asc",label:n("Sort: Reply Date (Oldest First)")},{value:"opened_time-desc",label:n("Sort: Opening Date (Newest First)")},{value:"opened_time-asc",label:n("Sort: Opening Date (Oldest First)")}],rn=[{value:"",label:n("Bulk Actions")},{value:"edit",label:n("Quick Edit")},{value:"reply",label:n("Quick Reply")},{value:"note",label:n("Quick Note")},{value:"trash",label:n("Move to Trash")},{value:"restore",label:n("Restore")},{value:"remove",label:n("Delete")}],ln=[{value:"0",label:n("All Agents")}],on=[{value:"0",label:n("All Categories")}],cn=[{value:"0",label:n("All Categories")}],an=[{value:"0",label:n("All Tags")}],ue=(o,m="")=>(o=p.cloneDeep(o),o=p.filter(o,({value:S})=>S!=="0"),m&&o.unshift({value:"",label:m}),o),He=(o,m,S,g,r)=>e.jsx(J,{children:e.jsx(a,{span:24,style:{padding:"4px 0"},children:e.jsxs(J,{gutter:8,wrap:!1,children:[e.jsx(a,{flex:"none",children:e.jsx(Ls,{children:1<((o==null?void 0:o.length)||0)?g:r})}),e.jsx(a,{flex:"auto",children:e.jsx(le,{gap:"4px 8px",wrap:!0,children:o==null?void 0:o.map(b=>{var I;return e.jsx(ae,{closeIcon:!0,onClose:()=>{S(p.without(o,b))},style:{margin:0},children:((I=m==null?void 0:m.find(T=>T.value===b))==null?void 0:I.label)||b},b)})})})]})})});function bn(){const o=Ss(),{hasAnyPermission:m}=Es(),{getBasicSettings:S}=et(),g=Ft(),r=wt(),[b,I]=d.useState(r("tkt-type","T","tickets")),[T,U]=d.useState(r("sub-type","A","tickets")),[w,q]=d.useState(r("category","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[c,L]=d.useState(r("tag","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[E,M]=d.useState(r("agent","","tickets",[],s=>s&&(s==null?void 0:s.split(","))||[])),[l,_]=d.useState(r("limit",20,"tickets")),[z,f]=d.useState(r("page",1,"tickets")),[u,R]=d.useState(r("sort","last_reply_time-desc","tickets")),[P,A]=d.useState(r("search","","tickets")),[Z,ie]=d.useState(r("search","","tickets")),[i,h]=d.useState(r("need-reply","N","tickets")),[y,t]=d.useState(""),[x,k]=d.useState([]),[C,Q]=d.useState(""),[re,D]=d.useState(!1),[W,N]=d.useState(n("Add New %s",n("Ticket"))),[F,H]=d.useState(0),[X,je]=d.useState([]),[ye,fe]=d.useState([]),[ge,Be]=d.useState(ln),[G,Ue]=d.useState(on),[$s,Ms]=d.useState(cn),[Le,Os]=d.useState(an),[rs,Ns]=d.useState(null),$e=S(),qs=($e==null?void 0:$e.cannedMsg)||[],Ps=p.includes(["D"],b)||p.includes(["I","C"],T),_e=ms({action:"ticket_data",tkt_type:b,sub_type:T,category:w,tag:c,agent:E,search:P,need_reply:i,limit:l,page:z,sort:u||"last_reply_time-desc"}),ls=ms({action:"ticket_status_for_select"}),os=st({action:"role_agent_for_select",select_all:!0}),cs=js({action:"ticket_category_data_for_select",select_all:!0}),as=js({action:"ticket_category_data_for_select",select_all:!0,has_role:!de||void 0}),ps=tt({action:"ticket_tag_data_for_select",select_all:!0}),ds=nt({action:"settings_data_file"}),Ys=s=>{f(1),I(s),g("page",1,"tickets"),g("tkt-type",s,"tickets"),ee()},us=s=>{const j=b==="D"?"ST":s.target.value||"A";f(1),U(j),g("page",1,"tickets"),g("sub-type",j,"tickets"),ee()},Qe=s=>{f(1),h(s),g("page",1,"tickets"),g("need-reply",s,"tickets"),ee()},hs=s=>{s=(s==null?void 0:s.trim())||"",f(1),A(s),ie(s),g("page",1,"tickets"),g("search",s,"tickets"),ee()},Ge=s=>{f(1),q(s),g("page",1,"tickets"),g("category",(s==null?void 0:s.join(","))||"","tickets"),ee()},We=s=>{f(1),L(s),g("page",1,"tickets"),g("tag",(s==null?void 0:s.join(","))||"","tickets"),ee()},ve=s=>{f(1),M(s),g("page",1,"tickets"),g("agent",(s==null?void 0:s.join(","))||"","tickets"),ee()},xs=s=>{f(1),R(s),g("page",1,"tickets"),g("sort",s,"tickets"),ee()},ee=d.useCallback(()=>{t(""),k([])},[]),Us=s=>{f(s),g("page",s,"tickets"),ee()},Qs=(s,j)=>{_(j),g("limit",j,"tickets"),ee()},Gs={selectedRowKeys:x,onChange:s=>{s!=null&&s.length||ee(),k(s)}},Ws=s=>{Q(s),D(!0)},be=d.useCallback(()=>{Q(""),D(!1)},[]),vs=()=>{_e.refetch(),ee()},Ks=()=>{us({target:{value:b==="D"?"ST":"A"}}),hs(""),Ge([]),We([]),ve([]),Qe("N"),xs("last_reply_time-desc"),ee()},Hs=()=>{let s=sn;return m(["trash-ticket-menu"])||(s=p.filter(s,function(j){return j.key!=="D"})),m(["manage-unassigned-ticket"])||(s=p.filter(s,function(j){return j.key!=="UA"})),s},Js=()=>{let s=tn;return m(["closed-ticket-list"])||(s=p.filter(s,function(j){return j.value!=="C"})),b==="D"&&(s=p.map(s,function(j){const $=p.cloneDeep(j);return $.value!=="ST"&&($.disabled=!0),$})),s},Zs=()=>{let s=[];return b==="D"?(s=["edit","reply","note","trash"],m(["restore-ticket"])||s.push("restore"),m(["delete-ticket"])||s.push("remove")):(s=["restore"],m(["edit-assigned","edit-category","edit-status"])||s.push("edit"),m(["ticket-reply"])||s.push("reply"),m(["create-note"])||s.push("note"),m(["move-to-trash"])||s.push("trash"),m(["delete-ticket"])||s.push("remove")),de&&(s=["reply","note",...s]),p.filter(rn,function($){return!p.includes(s,$.value||"")})},Xs=()=>{let s=!0;return s&&(s=b==="D"||T==="A"),s&&(s=P===""),s&&(s=!(w!=null&&w.length)),s&&(s=de||!(c!=null&&c.length)),s&&(s=!m(["manage-other-agents-ticket"])||p.includes(["MY","UA"],b)||!(E!=null&&E.length)),s&&(s=i==="N"),s&&(s=u==="last_reply_time-desc"),s};d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=_e;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&(je((se=s==null?void 0:s.data)==null?void 0:se.rowdata),H(((te=s==null?void 0:s.data)==null?void 0:te.total)||0))},[_e]),d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=ls;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&s!=null&&s.status&&(se=s==null?void 0:s.data)!=null&&se.result&&fe((te=s==null?void 0:s.data)==null?void 0:te.result)},[ls]),d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=os;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&s!=null&&s.status&&(se=s==null?void 0:s.data)!=null&&se.result&&Be((te=s==null?void 0:s.data)==null?void 0:te.result)},[os]),d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=cs;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&s!=null&&s.status&&(se=s==null?void 0:s.data)!=null&&se.result&&Ue((te=s==null?void 0:s.data)==null?void 0:te.result)},[cs]),d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=as;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&s!=null&&s.status&&(se=s==null?void 0:s.data)!=null&&se.result&&Ms((te=s==null?void 0:s.data)==null?void 0:te.result)},[as]),d.useEffect(()=>{var v,K,se,te;const{data:s,isFetching:j,isError:$,error:O}=ps;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&s!=null&&s.status&&(se=s==null?void 0:s.data)!=null&&se.result&&Os((te=s==null?void 0:s.data)==null?void 0:te.result)},[ps]),d.useEffect(()=>{var v,K;const{data:s,isFetching:j,isError:$,error:O}=ds;!j&&$&&Y.error((K=(v=O==null?void 0:O.data)==null?void 0:v.errors)==null?void 0:K.message),!j&&!$&&s&&Ns((s==null?void 0:s.data)||{})},[ds]);let Me=W,Oe=e.jsx(Ot,{isOpen:re,setCreateTitle:N,onCloseModal:be,categorySelectList:ue(G,`-- ${n("Select Category")} --`),fileSettingsData:rs,basicSettings:$e});return C==="edit"?(Me=n("Quick Edit"),Oe=e.jsx(Yt,{isOpen:re,resetBulkAction:ee,onCloseModal:be,bulkActionIds:x,statusSelectList:ue(ye,`-- ${n("Select Status")} --`),agentUserSelectList:ue(ge,`-- ${n("Select Agent")} --`),categorySelectList:ue(G,`-- ${n("Select Category")} --`),tagSelectList:ue(Le,`-- ${n("Select Tag")} --`)})):C==="reply"&&!de?(Me=n("Quick Reply"),Oe=e.jsx(Vt,{ticketIds:x,resetBulkAction:ee,onCloseModal:be,savedRepliesData:qs,fileSettingsData:rs})):C==="note"&&!de&&(Me=n("Quick Note"),Oe=e.jsx(vt,{ticketIds:x,resetBulkAction:ee,onCloseModal:be})),e.jsxs(e.Fragment,{children:[e.jsx(Bs,{style:{background:"transparent",minHeight:o!=null&&o.wsm?"calc(100vh - 265px)":"calc(100vh - 210px)"},children:e.jsxs(Dt,{style:{padding:"8px 16px 16px 16px"},children:[e.jsx(J,{children:e.jsx(a,{span:24,children:e.jsx(gt,{tabBarExtraContent:e.jsxs(ne,{children:[e.jsx(V,{type:"primary",icon:e.jsx(yt,{}),onClick:vs,ghost:!0}),e.jsx(ke,{permissions:["create-ticket"],children:o!=null&&o.lg||o!=null&&o.xl||o!=null&&o.xxl?e.jsx(V,{type:"primary",icon:e.jsx(Je,{}),onClick:()=>{D(!0)},children:n("Add Ticket")}):e.jsx(V,{type:"primary",icon:e.jsx(Je,{}),onClick:()=>{D(!0)}})})]}),items:Hs(),activeKey:b,defaultActiveKey:b,onChange:Ys,animated:!1,style:{margin:"0 0 16px 0"}})})}),e.jsx(J,{children:e.jsx(a,{span:24,children:e.jsxs(Ve,{size:"small",styles:{body:{background:"#fafafa",padding:"8px 12px"}},style:{margin:"0 0 32px 0"},children:[e.jsxs(J,{gutter:8,align:"middle",children:[e.jsx(a,{xs:{order:1},lg:{order:1},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(Rs.Group,{options:Js(),onChange:us,value:b!=="D"?T:"ST",defaultValue:b!=="D"?T:"ST",optionType:"button",buttonStyle:"solid"})}),Ps?null:e.jsx(a,{xs:{order:3},lg:{order:2},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsxs(ne,{align:"center",children:[e.jsx(es,{size:"small",value:i==="Y",onChange:()=>{Qe(i==="Y"?"N":"Y")}}),e.jsx(Ls,{onClick:()=>{Qe(i==="Y"?"N":"Y")},style:{cursor:"pointer"},children:n("Need Reply")})]})}),e.jsx(Te,{showOn:["lg","xl","xxl"],children:e.jsx(a,{lg:{order:3},flex:"auto"})}),e.jsx(a,{xs:{order:2},lg:{order:4},style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(en,{enterButton:!0,allowClear:!0,value:Z,onChange:s=>{var j;return ie(((j=s==null?void 0:s.target)==null?void 0:j.value)||"")},defaultValue:P,placeholder:n("Search keyword"),onSearch:hs})})]}),e.jsx(_s,{style:{margin:"8px 0"}}),e.jsxs(J,{gutter:8,align:"middle",children:[e.jsx(a,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(ce,{allowClear:!0,mode:"multiple",showSearch:!1,value:w,defaultValue:[],onChange:Ge,options:ue($s),maxTagCount:0,placeholder:n("All Categories"),maxTagPlaceholder:s=>{const j=(s==null?void 0:s.length)||0;return 1<j?n("%d Categories",j||0):n("%d Category",j||0)},style:{width:"auto",minWidth:"150px"},className:"sg-multiple-select"})}),de?null:e.jsx(a,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(ce,{allowClear:!0,mode:"multiple",showSearch:!1,value:c,defaultValue:[],onChange:We,options:ue(Le),maxTagCount:0,placeholder:n("All Tags"),maxTagPlaceholder:s=>{const j=(s==null?void 0:s.length)||0;return 1<j?n("%d Tags",j||0):n("%d Tag",j||0)},style:{width:"auto",minWidth:"130px"},className:"sg-multiple-select"})}),e.jsx(ke,{permissions:["manage-other-agents-ticket"],children:p.includes(["MY","UA"],b)?null:e.jsx(a,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(ce,{allowClear:!0,mode:"multiple",showSearch:!1,value:E,defaultValue:[],onChange:ve,options:ue(ge),maxTagCount:0,placeholder:n("All Agents"),maxTagPlaceholder:s=>{const j=(s==null?void 0:s.length)||0;return 1<j?n("%d Agents",j||0):n("%d Agent",j||0)},style:{width:"auto",minWidth:"140px"},className:"sg-multiple-select"})})}),e.jsx(a,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(ce,{value:u,defaultValue:"last_reply_time-desc",onChange:xs,options:nn,style:{width:"270px",maxWidth:"100%"}})}),e.jsx(Te,{showOn:["lg","xl","xxl"],children:e.jsx(a,{flex:"auto"})}),e.jsx(a,{style:{paddingTop:"4px",paddingBottom:"4px"},children:e.jsx(V,{icon:e.jsx(ft,{}),color:"danger",variant:"outlined",onClick:Ks,disabled:Xs(),children:n("Reset Filters")})})]}),!p.isEmpty(w)||!de&&!p.isEmpty(c)||!p.isEmpty(E)&&!p.includes(["MY","UA"],b)&&m(["manage-other-agents-ticket"])?e.jsxs(e.Fragment,{children:[e.jsx(_s,{style:{margin:"8px 0"}}),e.jsxs(le,{gap:"0 16px",wrap:!0,children:[p.isEmpty(w)?null:He(w,G,Ge,n("Categories:"),n("Category:")),!de&&!p.isEmpty(c)?He(c,Le,We,n("Tags:"),n("Tag:")):null,!p.isEmpty(E)&&!p.includes(["MY","UA"],b)&&m(["manage-other-agents-ticket"])?He(E,ge,ve,n("Agents:"),n("Agent:")):null]})]}):null]})})}),e.jsx(qt,{data:X,total:F,limit:l,page:z,onPageChange:Us,onSizeChange:Qs,rowSelection:Gs,bulkAction:y,setBulkAction:t,bulkActionIds:x,onActionClick:Ws,isLoading:_e==null?void 0:_e.isFetching,resetBulkAction:ee,sortOrder:u,bulkActionList:Zs(),statusSelectList:ye,agentUserSelectList:ge,categorySelectList:G,tagSelectList:Le})]})}),e.jsx(_t,{title:Me,centered:!0,open:re,onCancel:be,onClose:be,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},styles:C==="note"?{content:{backgroundColor:"#fffbe6"},header:{background:"#fffbe6"}}:{},destroyOnClose:!0,children:Oe})]})}export{bn as default};
