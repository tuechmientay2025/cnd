import{u as Z,a4 as v,a5 as V,_ as d,s as tt,b as st,C as et,j as t,t as e}from"../main.aHgQEcd5.1748844857753.js";import{r as h}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{C as it}from"./CopyButton.BHPgmrhV.1748844857753.js";import{j,s as T,b as f,C as o,A as P,u as w,w as z,o as F,x as y,D as nt,d as I,ak as S,B as k,T as O,al as H,k as ot}from"./antd.v1CHGtH-.1748844857753.js";function rt(){const K=["twilio_auth_token"],Q={twilio_status:!1,twilio_sid:"",twilio_auth_token:"",twilio_wa_number:"",notification_events:[],whatsapp_response:!1},A=Z(),[x]=j.useForm(),[r,U]=h.useState(null),[a,W]=h.useState(null),[p,B]=h.useState(!0),[D,_]=h.useState(!0),[E,$]=h.useState(""),[R,C]=h.useState(""),[J,q]=v(),{Text:L}=O,G=V({action:"whatsapp_data"}),b=(s,i)=>{i=d.mapValues(i,function(n){return d.isString(n)?d.trim(n):n});for(const n of K){const l=s==null?void 0:s[n];l&&d.includes(l,"*")&&(i[n]=r[n])}W(i||{}),B(!(i!=null&&i.twilio_status)||!1);const c=d.pick(r,d.keys(i));d.isEqual(c,i)?_(!0):r!=null&&r.twilio_status||i!=null&&i.twilio_status?_(!1):_(!0)},X=async s=>{var m,M,N;const i=s!=null&&s.twilio_status?"A":"I",c=((m=s==null?void 0:s.twilio_sid)==null?void 0:m.trim())||"",n=((M=s==null?void 0:s.twilio_auth_token)==null?void 0:M.trim())||"",l=((N=s==null?void 0:s.twilio_wa_number)==null?void 0:N.trim())||"",u=(s==null?void 0:s.notification_events)||[],g=s!=null&&s.whatsapp_response?"A":"I";J({params:{action:"whatsapp"},data:{twilio_status:i,twilio_sid:c,twilio_auth_token:n,twilio_wa_number:l,notification_events:u,whatsapp_response:g}})},Y=()=>{x.setFieldsValue(r||{}),b(null,r)};return h.useEffect(()=>{x.setFieldsValue(r||{}),W(r||{}),B(!(r!=null&&r.twilio_status)||!1),_(!0)},[r,x]),h.useEffect(()=>{var l,u,g;const{data:s,isFetching:i,isError:c,error:n}=G;if(!i&&c&&T.error((u=(l=n==null?void 0:n.data)==null?void 0:l.errors)==null?void 0:u.message),!i&&!c&&s){const m=d.clone((s==null?void 0:s.data)||{});d.unset(m,"whatsapp_endpoint"),$(((g=s==null?void 0:s.data)==null?void 0:g.whatsapp_endpoint)||""),U(m||{})}},[G]),h.useEffect(()=>{var l,u,g,m;const{data:s,isLoading:i,isError:c,error:n}=q;A(i?tt():st()),!i&&c&&((u=(l=n==null?void 0:n.data)==null?void 0:l.errors)!=null&&u.message)&&T.error((m=(g=n==null?void 0:n.data)==null?void 0:g.errors)==null?void 0:m.message),!i&&!c&&s&&s!=null&&s.msg&&(s!=null&&s.status?(C(""),T.success(s==null?void 0:s.msg)):(C(s==null?void 0:s.msg),et()))},[q,A]),t.jsx(j,{form:x,name:"saveWhatsApp",layout:"vertical",autoComplete:"off",onFinish:X,onValuesChange:b,initialValues:Q,children:t.jsxs(f,{children:[R?t.jsx(o,{span:24,children:t.jsx(P,{message:R,type:"error",showIcon:!0,closable:!0,afterClose:()=>C(""),style:{marginBottom:"24px"}})}):null,t.jsx(o,{span:24,children:t.jsxs(w,{align:"center",style:{marginBottom:"24px"},children:[t.jsx(j.Item,{name:"twilio_status",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(z,{})}),t.jsx(L,{onClick:()=>{x.setFieldValue("twilio_status",!(a!=null&&a.twilio_status)),b(null,x.getFieldsValue())},style:{cursor:"pointer"},children:a!=null&&a.twilio_status?e("Click to disable."):e("Click to enable and setup.")})]})}),t.jsx(o,{span:24,children:t.jsx(j.Item,{label:e("Twilio Account SID"),name:"twilio_sid",rules:[{required:!0,message:e("%s is required.",e("Twilio Account SID")),whitespace:!0}],help:p?"":void 0,children:t.jsx(F,{disabled:p})})}),t.jsx(o,{span:24,children:t.jsx(j.Item,{label:e("Twilio Auth Token"),name:"twilio_auth_token",rules:[{required:!0,message:e("%s is required.",e("Twilio Auth Token")),whitespace:!0}],help:p?"":void 0,tooltip:e("Value containing any asterisk (*) will not be updated."),children:t.jsx(F,{disabled:p})})}),t.jsx(o,{span:24,children:t.jsx(j.Item,{label:e("Twilio WhatsApp Number"),name:"twilio_wa_number",rules:[{required:!0,message:e("%s is required.",e("Twilio WhatsApp number")),whitespace:!0}],help:p?"":void 0,children:t.jsx(F,{disabled:p})})}),t.jsx(o,{span:24,children:t.jsx(j.Item,{label:e("Notification Events"),name:"notification_events",htmlFor:null,children:t.jsx(y.Group,{disabled:p,children:t.jsxs(f,{children:[t.jsx(o,{span:24,children:t.jsx(y,{value:"ticket-created",style:{lineHeight:"32px"},children:e("Ticket Created")})}),t.jsx(o,{span:24,children:t.jsx(y,{value:"ticket-replied",style:{lineHeight:"32px"},children:e("Ticket Replied")})}),t.jsx(o,{span:24,children:t.jsx(y,{value:"ticket-assigned",style:{lineHeight:"32px"},children:e("Ticket Assigned")})})]})})})}),t.jsx(nt,{style:{margin:"0 0 24px 0"}}),t.jsx(o,{span:24,children:t.jsxs(w,{align:"center",style:{marginBottom:"24px"},children:[t.jsx(j.Item,{name:"whatsapp_response",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(z,{size:"small",disabled:p})}),t.jsx(L,{onClick:()=>{p||(x.setFieldValue("whatsapp_response",!(a!=null&&a.whatsapp_response)),b(null,x.getFieldsValue()))},style:{cursor:p?"not-allowed":"pointer"},disabled:p,children:e("Response from WhatsApp.")})]})}),a!=null&&a.whatsapp_response?t.jsx(o,{span:24,children:t.jsx(P,{message:t.jsxs(w,{children:[t.jsx(I,{title:e("Please use this URL into your Twilio settings to enable your agent to respond to tickets via WhatsApp."),children:t.jsx(S,{})}),E||e("Loading...")]}),action:t.jsx(it,{text:E}),style:{backgroundColor:"rgba(0, 0, 0, 0.04)",borderColor:"#d9d9d9",marginBottom:"24px"}})}):null,t.jsx(o,{span:24,children:t.jsxs(w,{children:[t.jsx(k,{type:"primary",htmlType:"submit",loading:!1,disabled:D,children:e("Save Changes")}),t.jsx(k,{htmlType:"button",onClick:Y,disabled:D,children:e("Discard")})]})})]})})}const{Title:at}=O;function xt(){return t.jsx(f,{justify:"space-around",children:t.jsxs(o,{span:24,style:{maxWidth:"960px"},children:[t.jsxs(f,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"8px"},children:[t.jsx(o,{style:{paddingBottom:"8px"},children:t.jsx(at,{level:5,style:{fontSize:"18px",margin:0},children:e("%s Integration",e("WhatsApp"))})}),t.jsx(o,{style:{paddingBottom:"8px"},children:t.jsxs(w,{children:[t.jsx(I,{title:t.jsxs(w,{align:"center",children:[t.jsx(S,{}),t.jsx("span",{children:e("Learn more")})]}),children:t.jsx(k,{icon:t.jsx(S,{}),href:"https://supportgenix.com/integrations/whatsapp/",target:"_blank"})}),t.jsx(I,{title:t.jsxs(w,{align:"center",children:[t.jsx(H,{}),t.jsx("span",{children:e("Documentation")})]}),children:t.jsx(k,{icon:t.jsx(H,{}),href:"https://supportgenix.com/doc/whatsapp-integration/",target:"_blank"})})]})})]}),t.jsx(f,{children:t.jsx(o,{span:24,children:t.jsx(ot,{size:"small",styles:{header:{background:"#fafafa"},body:{padding:"20px 24px 24px 24px"}},children:t.jsx(rt,{})})})})]})})}export{xt as default};
