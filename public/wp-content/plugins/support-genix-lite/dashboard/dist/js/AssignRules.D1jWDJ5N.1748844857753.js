import{_ as D,u as de,I as ge,s as pe,b as me,c as Ce,j as e,t as r,f as fe,J as Ae,l as le,m as be}from"../main.aHgQEcd5.1748844857753.js";import{r as c,u as we,k as Ie}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as X,s as G,b as se,C as b,A as Se,n as L,w as Fe,u as H,B as v,a as N,ap as Re,F as ee,aa as ae,$ as ce,H as Te,aq as Ee,Q as Be,T as xe,X as ke,y as ue,f as $e}from"./antd.v1CHGtH-.1748844857753.js";import{A as ie}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";function qe({data:a,isEdit:w,onCloseModal:o,userRoleSelectList:Q,agentUserSelectList:Y,categorySelectList:Z}){var C;const f=a?{...a,rule_id:D.toInteger(a==null?void 0:a.rule_id)?a.rule_id:"",category_arr:((C=a==null?void 0:a.cat_ids)==null?void 0:C.split(","))||["0"],status:(a==null?void 0:a.status)==="A"}:{rule_type:"A",rule_id:"",category_arr:["0"],status:!0},j=de(),[I]=X.useForm(),[B,P]=c.useState(""),[U,J]=c.useState(f==null?void 0:f.rule_type),[W,k]=ge(),_=n=>{var p;D.has(n,"rule_type")&&(J(n==null?void 0:n.rule_type),(n==null?void 0:n.rule_type)!==(f==null?void 0:f.rule_type)?I.setFieldValue("rule_id",""):I.setFieldValue("rule_id",f==null?void 0:f.rule_id)),D.has(n,"category_arr")&&((p=n==null?void 0:n.category_arr)!=null&&p.length||I.setFieldValue("category_arr",["0"]))},$=n=>{var O,q;const p=((O=n==null?void 0:n.rule_type)==null?void 0:O.trim())||"",A=((q=n==null?void 0:n.rule_id)==null?void 0:q.trim())||"",h=(n==null?void 0:n.category_arr)||["0"],M=n!=null&&n.status?"A":"I";W({params:{action:w?"ticket_assign_rule_edit":"ticket_assign_rule_add",id:f==null?void 0:f.id},data:{rule_type:p,rule_id:A,category_arr:h,status:M}})};return c.useEffect(()=>{var M,O,q,K;const{data:n,isLoading:p,isError:A,error:h}=k;j(p?pe():me()),!p&&A&&((O=(M=h==null?void 0:h.data)==null?void 0:M.errors)!=null&&O.message)&&G.error((K=(q=h==null?void 0:h.data)==null?void 0:q.errors)==null?void 0:K.message),!p&&!A&&n&&(n!=null&&n.msg&&(n!=null&&n.status?(P(""),G.success(n==null?void 0:n.msg)):(P(n==null?void 0:n.msg),Ce())),n!=null&&n.status&&o())},[k,o,j]),e.jsx(X,{form:I,name:"createAssignRule",layout:"vertical",onFinish:$,onValuesChange:_,initialValues:f,autoComplete:"off",children:e.jsxs(se,{gutter:16,children:[B?e.jsx(b,{span:24,children:e.jsx(Se,{message:B,type:"error",showIcon:!0,closable:!0,afterClose:()=>P(""),style:{marginBottom:"24px"}})}):null,e.jsx(b,{span:24,children:e.jsx(X.Item,{label:r("Rule Type"),name:"rule_type",rules:[{required:!0,message:r("%s is required.",r("Rule type"))}],children:e.jsx(L,{style:{width:"100%"},options:[{value:"A",label:r("Assign to role")},{value:"S",label:r("Assign to agent")},{value:"N",label:r("Notify to agent")}]})})}),e.jsx(b,{span:24,children:U==="A"?e.jsx(X.Item,{label:r("Select Role"),name:"rule_id",rules:[{required:!0,message:r("%s is required.",r("Role"))}],children:e.jsx(L,{options:Q})}):e.jsx(X.Item,{label:r("Select Agent"),name:"rule_id",rules:[{required:!0,message:r("%s is required.",r("Agent"))}],children:e.jsx(L,{options:Y})})}),e.jsx(b,{span:24,children:e.jsx(X.Item,{label:r("Choose Category"),name:"category_arr",rules:[{required:!0,message:r("%s is required.",r("Category"))}],children:e.jsx(L,{allowClear:!0,mode:"multiple",options:Z,onSelect:n=>{const p=I.getFieldValue("category_arr"),A=n==="0"?["0"]:p==null?void 0:p.filter(h=>h!=="0");I.setFieldValue("category_arr",A),_({category_arr:A})}})})}),e.jsx(b,{span:24,children:e.jsx(X.Item,{label:r("Status"),name:"status",valuePropName:"checked",children:e.jsx(Fe,{})})}),e.jsx(b,{span:24,style:{textAlign:"right"},children:e.jsxs(H,{children:[e.jsx(v,{htmlType:"button",onClick:o,children:r("Cancel")}),e.jsx(v,{type:"primary",htmlType:"submit",loading:k==null?void 0:k.isLoading,children:w?r("Update"):r("Create")})]})})]})})}const{Text:oe}=xe;function ze({data:a,total:w,limit:o,page:Q,onPageChange:Y,onSizeChange:Z,rowSelection:f,bulkAction:j,setBulkAction:I,bulkActionIds:B,onEditClick:P,isLoading:U,resetBulkAction:J,sortOrder:W,handleSort:k,userRoleSelectList:_,agentUserSelectList:$,categorySelectList:C}){const n=fe(),p=de(),[A,h]=ge(),M=t=>{A({params:{action:"ticket_assign_rule_delete_item",id:t}})},O=()=>{let t="";j==="remove"?t="ticket_assign_rule_delete_items":j==="activate"?t="ticket_assign_rule_activate_items":j==="deactivate"&&(t="ticket_assign_rule_deactivate_items"),t&&A({params:{action:t,ids:B}})},q=(t,i,u,{action:l})=>{l==="sort"&&k(u)},K=t=>W===`${t}-asc`?"ascend":W===`${t}-desc`?"descend":null,V=[{title:r("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:K("id")},{title:r("Rule Type"),dataIndex:"rule_type",render:(t,i)=>{var m,z;const u=D.split(i==null?void 0:i.cat_ids,","),l=[];for(const x of u){const S=C==null?void 0:C.find(({value:ne})=>ne===x);S!=null&&S.label?l.push(S.label):l.push(x)}if(t==="A")return e.jsxs(H,{direction:"vertical",children:[e.jsxs(H,{align:"center",children:[e.jsx(N,{color:"blue",style:{margin:0},bordered:!1,children:e.jsx(Re,{})}),r("Assign to role")]}),n.xs||n.sm||n.md||n.lg?e.jsxs(e.Fragment,{children:[e.jsxs(ee,{gap:"0 8px",wrap:!0,children:[e.jsx(oe,{children:r("Role or Agent:")}),(i==null?void 0:i.rule_type)==="A"?((m=_==null?void 0:_.find(({value:x})=>x===(i==null?void 0:i.rule_id)))==null?void 0:m.label)||"":((z=$==null?void 0:$.find(({value:x})=>x===(i==null?void 0:i.rule_id)))==null?void 0:z.label)||""]}),e.jsxs(ee,{gap:"0 8px",wrap:!0,children:[e.jsx(oe,{children:r("Categories:")}),e.jsx(ee,{gap:"4px 0",wrap:!0,children:l.map((x,S)=>e.jsx(N,{bordered:!1,children:x},S))})]}),e.jsxs(ee,{gap:"0 8px",wrap:!0,children:[e.jsx(oe,{children:r("Status:")}),(i==null?void 0:i.status)==="A"?e.jsx(N,{color:"green",children:r("Active")}):e.jsx(N,{color:"default",children:r("Inactive")})]}),n.xs?e.jsxs(H,{children:[e.jsx(v,{type:"primary",icon:e.jsx(ae,{}),size:"small",ghost:!0,onClick:()=>P(i)}),e.jsx(ie,{action:"remove",onConfirm:()=>M(i==null?void 0:i.id),children:e.jsx(v,{type:"primary",icon:e.jsx(ce,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]});if(t==="S")return e.jsxs(H,{align:"center",children:[e.jsx(N,{color:"purple",style:{margin:0},bordered:!1,children:e.jsx(Te,{})}),r("Assign to agent")]});if(t==="N")return e.jsxs(H,{align:"center",children:[e.jsx(N,{color:"orange",style:{margin:0},bordered:!1,children:e.jsx(Ee,{})}),r("Notify to agent")]})}},{title:r("Role or Agent"),dataIndex:"rule_id",render:(t,i)=>{var u,l;return(i==null?void 0:i.rule_type)==="A"?((u=_==null?void 0:_.find(({value:m})=>m===t))==null?void 0:u.label)||"":((l=$==null?void 0:$.find(({value:m})=>m===t))==null?void 0:l.label)||""},responsive:["xl"]},{title:r("Categories"),dataIndex:"cat_ids",render:t=>{const i=D.split(t,","),u=[];for(const l of i){const m=C==null?void 0:C.find(({value:z})=>z===l);m!=null&&m.label?u.push(m.label):u.push(l)}return e.jsx(e.Fragment,{children:u.map((l,m)=>e.jsx(N,{bordered:!1,children:l},m))})},responsive:["xl"]},{title:r("Status"),dataIndex:"status",render:t=>t==="A"?e.jsx(N,{color:"green",children:r("Active")}):e.jsx(N,{color:"default",children:r("Inactive")}),responsive:["xl"]},{title:r("Action"),width:100,align:"right",render:t=>e.jsxs(H,{children:[e.jsx(v,{type:"primary",icon:e.jsx(ae,{}),size:"small",ghost:!0,onClick:()=>P(t)}),e.jsx(ie,{action:"remove",onConfirm:()=>M(t==null?void 0:t.id),children:e.jsx(v,{type:"primary",icon:e.jsx(ce,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],te=()=>{const t=w?(Q-1)*o+1:0,i=D.min([t+o-1,w]),u=r("Showing %1$d - %2$d of %3$d",t,i,w);return e.jsxs(se,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(b,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(se,{align:"middle",gutter:8,children:[e.jsx(b,{children:e.jsx(L,{value:j,style:{width:140},onChange:l=>I(l),options:[{value:"",label:r("Bulk Actions")},{value:"activate",label:r("Activate")},{value:"deactivate",label:r("Deactivate")},{value:"remove",label:r("Delete")}],disabled:!(B!=null&&B.length)})}),e.jsx(b,{children:e.jsx(ie,{action:j,onConfirm:()=>O(),children:e.jsx(v,{type:"primary",disabled:!j,children:r("Apply")})})})]})}),e.jsx(b,{style:{marginTop:"4px",marginBottom:"4px"},children:u})]})};return c.useEffect(()=>{var m,z,x,S;const{data:t,isLoading:i,isError:u,error:l}=h;p(i?pe():me()),!i&&u&&((z=(m=l==null?void 0:l.data)==null?void 0:m.errors)!=null&&z.message)&&G.error((S=(x=l==null?void 0:l.data)==null?void 0:x.errors)==null?void 0:S.message),!i&&!u&&t&&(t!=null&&t.msg&&(t!=null&&t.status?G.success(t==null?void 0:t.msg):G.error(t==null?void 0:t.msg)),t!=null&&t.status&&J())},[h,J,p]),e.jsx(Be,{rowKey:t=>t==null?void 0:t.id,rowSelection:f,columns:V,dataSource:a,footer:te,loading:U,onChange:q,pagination:{total:w,pageSize:o,current:Q,onChange:Y,onShowSizeChange:Z,showSizeChanger:w>10,style:{marginBottom:0}}})}const{Title:ve}=xe;function Pe(){const a=fe(),w=we(),[o,Q]=Ie(),[Y,Z]=c.useState((o==null?void 0:o.get("limit"))||20),[f,j]=c.useState((o==null?void 0:o.get("page"))||1),[I,B]=c.useState((o==null?void 0:o.get("sort"))||""),[P,U]=c.useState(""),[J,W]=c.useState([]),[k,_]=c.useState(!1),[$,C]=c.useState(null),[n,p]=c.useState(!1),[A,h]=c.useState(0),[M,O]=c.useState([]),[q,K]=c.useState([]),[V,te]=c.useState([]),[t,i]=c.useState([]),u=Ae({action:"ticket_assign_rule_data",limit:Y,page:f,sort:I||"id-asc"}),l=le({action:"role_data_for_select",select:!0}),m=le({action:"role_agent_for_select",select:!0}),z=be({action:"ticket_category_data_for_select",select_all:!0}),x=c.useCallback(()=>{U(""),W([])},[]),S=s=>{s===1?o.delete("page"):o.set("page",s),j(s),Q(o),x()},ne=(s,d)=>{d===20?o.delete("limit"):o.set("limit",d),Z(d),Q(o),x()},he={selectedRowKeys:J,onChange:s=>{s!=null&&s.length||x(),W(s)}},je=s=>{C(s),p(!0),_(!0)},re=c.useCallback(()=>{_(!1),C(null),p(!1)},[]),_e=()=>{u.refetch(),x()},ye=s=>{const{field:d,order:y}=s||{};let g=d;y==="ascend"?g+="-asc":g+="-desc",B(g),j(1),o.delete("page"),o.set("sort",g),Q(o),x()};return c.useEffect(()=>{var F,R,T,E;const{data:s,isFetching:d,isError:y,error:g}=u;!d&&y&&G.error((R=(F=g==null?void 0:g.data)==null?void 0:F.errors)==null?void 0:R.message),!d&&!y&&s&&(O((T=s==null?void 0:s.data)==null?void 0:T.result),h(((E=s==null?void 0:s.data)==null?void 0:E.total)||0))},[u]),c.useEffect(()=>{var F,R,T,E;const{data:s,isFetching:d,isError:y,error:g}=l;!d&&y&&G.error((R=(F=g==null?void 0:g.data)==null?void 0:F.errors)==null?void 0:R.message),!d&&!y&&s&&s!=null&&s.status&&(T=s==null?void 0:s.data)!=null&&T.result&&K((E=s==null?void 0:s.data)==null?void 0:E.result)},[l]),c.useEffect(()=>{var F,R,T,E;const{data:s,isFetching:d,isError:y,error:g}=m;!d&&y&&G.error((R=(F=g==null?void 0:g.data)==null?void 0:F.errors)==null?void 0:R.message),!d&&!y&&s&&s!=null&&s.status&&(T=s==null?void 0:s.data)!=null&&T.result&&te((E=s==null?void 0:s.data)==null?void 0:E.result)},[m]),c.useEffect(()=>{var F,R,T,E;const{data:s,isFetching:d,isError:y,error:g}=z;!d&&y&&G.error((R=(F=g==null?void 0:g.data)==null?void 0:F.errors)==null?void 0:R.message),!d&&!y&&s&&s!=null&&s.status&&(T=s==null?void 0:s.data)!=null&&T.result&&i((E=s==null?void 0:s.data)==null?void 0:E.result)},[z]),c.useEffect(()=>{const{search:s}=w,d=new URLSearchParams(s);d.has("limit")||Z(20),d.has("page")||j(1),d.has("sort")||B("")},[w]),e.jsxs(e.Fragment,{children:[e.jsxs(se,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(b,{style:{paddingBottom:"8px"},children:e.jsx(ve,{level:5,style:{fontSize:"18px",margin:0},children:r("Assign Rules")})}),e.jsx(b,{style:{paddingBottom:"8px"},children:e.jsxs(H,{children:[e.jsx(v,{type:"primary",icon:e.jsx(ke,{}),onClick:_e,ghost:!0}),a!=null&&a.lg||a!=null&&a.xl||a!=null&&a.xxl?e.jsx(v,{type:"primary",icon:e.jsx(ue,{}),onClick:()=>{_(!0)},children:r("Add New")}):e.jsx(v,{type:"primary",icon:e.jsx(ue,{}),onClick:()=>{_(!0)}})]})})]}),e.jsx(ze,{data:M,total:A,limit:Y,page:f,onPageChange:S,onSizeChange:ne,rowSelection:he,bulkAction:P,setBulkAction:U,bulkActionIds:J,onEditClick:je,isLoading:u==null?void 0:u.isFetching,resetBulkAction:x,sortOrder:I,handleSort:ye,userRoleSelectList:q,agentUserSelectList:V,categorySelectList:t}),e.jsx($e,{title:n?r("Edit %s",r("Assign Rule")):r("Add New %s",r("Assign Rule")),centered:!0,open:k,onCancel:re,onClose:re,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(qe,{isOpen:k,onCloseModal:re,data:$,isEdit:n,userRoleSelectList:q,agentUserSelectList:V,categorySelectList:t})})]})}export{Pe as default};
