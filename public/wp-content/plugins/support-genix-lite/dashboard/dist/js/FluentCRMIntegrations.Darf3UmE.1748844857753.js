import{u as ae,a2 as oe,s as le,b as ce,c as je,j as e,t,_ as te,f as he,a3 as Ce}from"../main.aHgQEcd5.1748844857753.js";import{r as c,u as ye,k as _e}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as F,s as T,b as Z,C as d,A as Se,n as ie,o as se,x as V,w as Ie,u as H,B as j,F as ee,a as L,aa as de,$ as me,d as re,at as be,ao as we,Q as ke,T as pe,Y as Re,X as Fe,y as xe,f as Te}from"./antd.v1CHGtH-.1748844857753.js";import{A as N}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";import{S as Me}from"./ScreenGuard.CO_wY78U.1748844857753.js";function Ee({data:m,isEdit:C,onCloseModal:y}){const a=m?{...m,status:(m==null?void 0:m.status)==="A"}:{same_site:"Y",contact_status:"P",trigger_events:[],status:!0},w=ae(),[D]=F.useForm(),[B,u]=c.useState(""),[M,k]=c.useState((a==null?void 0:a.same_site)==="Y"),[O,R]=oe(),A=n=>{te.has(n,"same_site")&&k((n==null?void 0:n.same_site)==="Y")},v=n=>{var z,q,P,s,i;const p=((z=n==null?void 0:n.same_site)==null?void 0:z.trim())||"",f=((q=n==null?void 0:n.webhook_url)==null?void 0:q.trim())||"",g=((P=n==null?void 0:n.list_ids)==null?void 0:P.trim())||"",_=((s=n==null?void 0:n.tag_ids)==null?void 0:s.trim())||"",S=((i=n==null?void 0:n.contact_status)==null?void 0:i.trim())||"",I=(n==null?void 0:n.trigger_events)||[],E=n!=null&&n.status?"A":"I",U={same_site:p,list_ids:g,tag_ids:_,contact_status:S,trigger_events:I,status:E};M||(U.webhook_url=f),O({params:{action:C?"fluentcrm_edit":"fluentcrm_add",id:a==null?void 0:a.id},data:U})};return c.useEffect(()=>{var _,S,I,E;const{data:n,isLoading:p,isError:f,error:g}=R;w(p?le():ce()),!p&&f&&((S=(_=g==null?void 0:g.data)==null?void 0:_.errors)!=null&&S.message)&&T.error((E=(I=g==null?void 0:g.data)==null?void 0:I.errors)==null?void 0:E.message),!p&&!f&&n&&(n!=null&&n.msg&&(n!=null&&n.status?(u(""),T.success(n==null?void 0:n.msg)):(u(n==null?void 0:n.msg),je())),n!=null&&n.status&&y())},[R,y,w]),e.jsx(F,{form:D,name:"createFluentCRMIntegration",layout:"vertical",onFinish:v,onValuesChange:A,initialValues:a,autoComplete:"off",children:e.jsxs(Z,{gutter:16,children:[B?e.jsx(d,{span:24,children:e.jsx(Se,{message:B,type:"error",showIcon:!0,closable:!0,afterClose:()=>u(""),style:{marginBottom:"24px"}})}):null,e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Type"),name:"same_site",rules:[{required:!0,message:t("%s is required.",t("Type"))}],children:e.jsx(ie,{style:{width:"100%"},options:[{value:"Y",label:t("FluentCRM in same site")},{value:"N",label:t("FluentCRM in external site")}]})})}),M?null:e.jsx(e.Fragment,{children:e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Webhook URL"),name:"webhook_url",rules:[{required:!0,message:t("%s is required.",t("Webhook URL")),whitespace:!0},{type:"url",message:t("Please enter a valid URL.")}],children:e.jsx(se,{})})})}),e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("List IDs"),name:"list_ids",tooltip:t("Comma-separated IDs of list (example: 1,2,3,4)."),children:e.jsx(se,{})})}),e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Tag IDs"),name:"tag_ids",tooltip:t("Comma-separated IDs of tag (example: 1,2,3,4)."),children:e.jsx(se,{})})}),e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Contact status"),name:"contact_status",rules:[{required:!0,message:t("%s is required.",t("Contact status"))}],children:e.jsx(ie,{style:{width:"100%"},options:[{value:"P",label:t("Pending")},{value:"S",label:t("Subscribed")},{value:"U",label:t("Unsubscribed")}]})})}),e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Trigger Events"),name:"trigger_events",htmlFor:null,children:e.jsx(V.Group,{children:e.jsxs(Z,{children:[e.jsx(d,{span:24,children:e.jsx(V,{value:"ticket-created",style:{lineHeight:"32px"},children:t("Ticket Created")})}),e.jsx(d,{span:24,children:e.jsx(V,{value:"ticket-replied",style:{lineHeight:"32px"},children:t("Ticket Replied")})}),e.jsx(d,{span:24,children:e.jsx(V,{value:"ticket-closed",style:{lineHeight:"32px"},children:t("Ticket Closed")})})]})})})}),e.jsx(d,{span:24,children:e.jsx(F.Item,{label:t("Status"),name:"status",valuePropName:"checked",children:e.jsx(Ie,{})})}),e.jsx(d,{span:24,style:{textAlign:"right"},children:e.jsxs(H,{children:[e.jsx(j,{htmlType:"button",onClick:y,children:t("Cancel")}),e.jsx(j,{type:"primary",htmlType:"submit",loading:R==null?void 0:R.isLoading,children:C?t("Update"):t("Create")})]})})]})})}const{Text:ne}=pe;function Le({data:m,total:C,limit:y,page:a,onPageChange:w,onSizeChange:D,rowSelection:B,bulkAction:u,setBulkAction:M,bulkActionIds:k,onEditClick:O,isLoading:R,resetBulkAction:A,sortOrder:v,handleSort:n}){const p=he(),f=ae(),[g,_]=oe(),S=(s,i)=>{g({params:{action:"fluentcrm_order_change",id:s,typ:i}})},I=s=>{g({params:{action:"fluentcrm_delete_item",id:s}})},E=()=>{let s="";u==="remove"?s="fluentcrm_delete_items":u==="activate"?s="fluentcrm_activate_items":u==="deactivate"&&(s="fluentcrm_deactivate_items"),s&&g({params:{action:s,ids:k}})},U=(s,i,o,{action:l})=>{l==="sort"&&n(o)},z=s=>v===`${s}-asc`?"ascend":v===`${s}-desc`?"descend":null,q=[{title:t("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:z("id")},{title:t("Site"),dataIndex:"site_url",render:(s,i)=>{const o=(i==null?void 0:i.trigger_events)||[],l=[];for(const b of o)b==="ticket-created"&&l.push(t("Ticket Created")),b==="ticket-replied"&&l.push(t("Ticket Replied")),b==="ticket-closed"&&l.push(t("Ticket Closed"));return e.jsxs(H,{direction:"vertical",children:[(i==null?void 0:i.same_site)==="Y"?e.jsxs(ee,{gap:"4px 8px",wrap:!0,children:[e.jsx("span",{children:s}),e.jsx(L,{color:"blue",style:{marginRight:0},children:t("Same-site")})]}):e.jsx(ne,{children:s}),p.xs||p.sm||p.md||p.lg?e.jsxs(e.Fragment,{children:[e.jsxs(ee,{gap:"0 8px",wrap:!0,children:[e.jsx(ne,{children:t("Events:")}),te.isEmpty(l)?e.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:t("N/A")}):e.jsx(ee,{gap:"4px 0",wrap:!0,children:l.map((b,Y)=>e.jsx(L,{bordered:!1,children:b},Y))})]}),e.jsxs(ee,{gap:"0 8px",wrap:!0,children:[e.jsx(ne,{children:t("Status:")}),(i==null?void 0:i.status)==="A"?e.jsx(L,{color:"green",children:t("Active")}):e.jsx(L,{color:"default",children:t("Inactive")})]}),p.xs?e.jsxs(H,{children:[e.jsx(j,{type:"primary",icon:e.jsx(de,{}),size:"small",ghost:!0,onClick:()=>O(i)}),e.jsx(N,{action:"remove",onConfirm:()=>I(i==null?void 0:i.id),children:e.jsx(j,{type:"primary",icon:e.jsx(me,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]})}},{title:t("Events"),dataIndex:"trigger_events",render:s=>{if(te.isEmpty(s))return e.jsx("span",{children:"â€”"});const i=[];for(const o of s)o==="ticket-created"&&i.push(t("Ticket Created")),o==="ticket-replied"&&i.push(t("Ticket Replied")),o==="ticket-closed"&&i.push(t("Ticket Closed"));return e.jsx(e.Fragment,{children:i.map((o,l)=>e.jsx(L,{bordered:!1,children:o},l))})},responsive:["xl"]},{title:t("Status"),dataIndex:"status",render:s=>s==="A"?e.jsx(L,{color:"green",children:t("Active")}):e.jsx(L,{color:"default",children:t("Inactive")}),responsive:["xl"]},{title:t("Order"),dataIndex:"int_order",width:100,render:(s,i)=>e.jsxs(H,{size:4,children:[e.jsx(N,{action:"orderup",onConfirm:()=>S(i==null?void 0:i.id,"u"),children:e.jsx(re,{title:t("Order Up"),children:e.jsx(j,{icon:e.jsx(be,{}),size:"small"})})}),e.jsx(L,{style:{lineHeight:"22px",margin:0},children:s||0}),e.jsx(N,{action:"orderdown",onConfirm:()=>S(i==null?void 0:i.id,"d"),children:e.jsx(re,{title:t("Order Down"),children:e.jsx(j,{icon:e.jsx(we,{}),size:"small"})})})]}),sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:z("int_order"),responsive:["hidden"]},{title:t("Action"),width:100,align:"right",render:s=>e.jsxs(H,{children:[e.jsx(j,{type:"primary",icon:e.jsx(de,{}),size:"small",ghost:!0,onClick:()=>O(s)}),e.jsx(N,{action:"remove",onConfirm:()=>I(s==null?void 0:s.id),children:e.jsx(j,{type:"primary",icon:e.jsx(me,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],P=()=>{const s=C?(a-1)*y+1:0,i=te.min([s+y-1,C]),o=t("Showing %1$d - %2$d of %3$d",s,i,C);return e.jsxs(Z,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(d,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(Z,{align:"middle",gutter:8,children:[e.jsx(d,{children:e.jsx(ie,{value:u,style:{width:140},onChange:l=>M(l),options:[{value:"",label:t("Bulk Actions")},{value:"activate",label:t("Activate")},{value:"deactivate",label:t("Deactivate")},{value:"remove",label:t("Delete")}],disabled:!(k!=null&&k.length)})}),e.jsx(d,{children:e.jsx(N,{action:u,onConfirm:()=>E(),children:e.jsx(j,{type:"primary",disabled:!u,children:t("Apply")})})})]})}),e.jsx(d,{style:{marginTop:"4px",marginBottom:"4px"},children:o})]})};return c.useEffect(()=>{var b,Y,K,G;const{data:s,isLoading:i,isError:o,error:l}=_;f(i?le():ce()),!i&&o&&((Y=(b=l==null?void 0:l.data)==null?void 0:b.errors)!=null&&Y.message)&&T.error((G=(K=l==null?void 0:l.data)==null?void 0:K.errors)==null?void 0:G.message),!i&&!o&&s&&(s!=null&&s.msg&&(s!=null&&s.status?T.success(s==null?void 0:s.msg):T.error(s==null?void 0:s.msg)),s!=null&&s.status&&A())},[_,A,f]),e.jsx(ke,{rowKey:s=>s==null?void 0:s.id,rowSelection:B,columns:q,dataSource:m,footer:P,loading:R,onChange:U,pagination:{total:C,pageSize:y,current:a,onChange:w,onShowSizeChange:D,showSizeChanger:C>10,style:{marginBottom:0}}})}const{Title:Be}=pe;function Ue(){const m=he(),C=ae(),y=ye(),[a,w]=_e(),[D,B]=c.useState((a==null?void 0:a.get("limit"))||20),[u,M]=c.useState((a==null?void 0:a.get("page"))||1),[k,O]=c.useState((a==null?void 0:a.get("sort"))||""),[R,A]=c.useState(""),[v,n]=c.useState([]),[p,f]=c.useState(!1),[g,_]=c.useState(null),[S,I]=c.useState(!1),[E,U]=c.useState(0),[z,q]=c.useState([]),[P,s]=oe(),i=Ce({action:"fluentcrm_data",limit:D,page:u,sort:k||"id-asc"}),o=c.useCallback(()=>{A(""),n([])},[]),l=r=>{r===1?a.delete("page"):a.set("page",r),M(r),w(a),o()},b=(r,x)=>{x===20?a.delete("limit"):a.set("limit",x),B(x),w(a),o()},Y={selectedRowKeys:v,onChange:r=>{r!=null&&r.length||o(),n(r)}},K=r=>{_(r),I(!0),f(!0)},G=c.useCallback(()=>{f(!1),_(null),I(!1)},[]),ge=()=>{P({params:{action:"fluentcrm_reset_order"}})},ue=()=>{i.refetch(),o()},fe=r=>{const{field:x,order:$}=r||{};let h=x;$==="ascend"?h+="-asc":h+="-desc",O(h),M(1),a.delete("page"),a.set("sort",h),w(a),o()};return c.useEffect(()=>{var W,Q,X,J;const{data:r,isFetching:x,isError:$,error:h}=i;!x&&$&&T.error((Q=(W=h==null?void 0:h.data)==null?void 0:W.errors)==null?void 0:Q.message),!x&&!$&&r&&(q((X=r==null?void 0:r.data)==null?void 0:X.result),U(((J=r==null?void 0:r.data)==null?void 0:J.total)||0))},[i]),c.useEffect(()=>{var W,Q,X,J;const{data:r,isLoading:x,isError:$,error:h}=s;C(x?le():ce()),!x&&$&&((Q=(W=h==null?void 0:h.data)==null?void 0:W.errors)!=null&&Q.message)&&T.error((J=(X=h==null?void 0:h.data)==null?void 0:X.errors)==null?void 0:J.message),!x&&!$&&r&&(r!=null&&r.msg&&(r!=null&&r.status?T.success(r==null?void 0:r.msg):T.error(r==null?void 0:r.msg)),r!=null&&r.status&&o())},[s,o,C]),c.useEffect(()=>{const{search:r}=y,x=new URLSearchParams(r);x.has("limit")||B(20),x.has("page")||M(1),x.has("sort")||O("")},[y]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(d,{style:{paddingBottom:"8px"},children:e.jsx(Be,{level:5,style:{fontSize:"18px",margin:0},children:t("FluentCRM Integrations")})}),e.jsx(d,{style:{paddingBottom:"8px"},children:e.jsxs(H,{children:[e.jsx(Me,{hideOn:["xs","sm","md","lg","xl","xxl"],children:e.jsx(N,{action:"orderreset",onConfirm:()=>ge(),children:e.jsx(re,{title:t("Reset Order"),children:e.jsx(j,{icon:e.jsx(Re,{})})})})}),e.jsx(j,{type:"primary",icon:e.jsx(Fe,{}),onClick:ue,ghost:!0}),m!=null&&m.lg||m!=null&&m.xl||m!=null&&m.xxl?e.jsx(j,{type:"primary",icon:e.jsx(xe,{}),onClick:()=>{f(!0)},children:t("Add New")}):e.jsx(j,{type:"primary",icon:e.jsx(xe,{}),onClick:()=>{f(!0)}})]})})]}),e.jsx(Le,{data:z,total:E,limit:D,page:u,onPageChange:l,onSizeChange:b,rowSelection:Y,bulkAction:R,setBulkAction:A,bulkActionIds:v,onEditClick:K,isLoading:i==null?void 0:i.isFetching,resetBulkAction:o,sortOrder:k,handleSort:fe}),e.jsx(Te,{title:S?t("Edit %s",t("FluentCRM Integration")):t("Add New %s",t("FluentCRM Integration")),centered:!0,open:p,onCancel:G,onClose:G,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(Ee,{isOpen:p,onCloseModal:G,data:g,isEdit:S})})]})}export{Ue as default};
