import{u as ae,V as re,s as le,b as ce,c as ue,j as e,t,_ as J,f as de,W as pe}from"../main.aHgQEcd5.1748844857753.js";import{r as c,u as ge,k as xe}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{C as Y}from"./CopyButton.BHPgmrhV.1748844857753.js";import{j as D,s as W,b as P,C as j,A as te,o as fe,Q as me,w as je,u as R,B as _,F as se,a as M,aa as ne,$ as ie,T as he,n as ye,X as _e,y as oe,f as ke}from"./antd.v1CHGtH-.1748844857753.js";import{A as H}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";function be({data:l,isEdit:y,onCloseModal:i}){const o=l?{...l,status:(l==null?void 0:l.status)==="A"}:{status:!0},k=ae(),[B]=D.useForm(),[F,h]=c.useState(""),[L,p]=re(),E=n=>{var u;const m=((u=n==null?void 0:n.title)==null?void 0:u.trim())||"",d=n!=null&&n.status?"A":"I";L({params:{action:y?"incoming_webhook_edit":"incoming_webhook_add",id:o==null?void 0:o.id},data:{title:m,status:d}})};return c.useEffect(()=>{var g,b,S,C;const{data:n,isLoading:m,isError:d,error:u}=p;k(m?le():ce()),!m&&d&&((b=(g=u==null?void 0:u.data)==null?void 0:g.errors)!=null&&b.message)&&W.error((C=(S=u==null?void 0:u.data)==null?void 0:S.errors)==null?void 0:C.message),!m&&!d&&n&&(n!=null&&n.msg&&(n!=null&&n.status?(h(""),W.success(n==null?void 0:n.msg)):(h(n==null?void 0:n.msg),ue())),n!=null&&n.status&&i())},[p,i,k]),e.jsx(D,{form:B,name:"createIncomingWebhook",layout:"vertical",onFinish:E,initialValues:o,autoComplete:"off",children:e.jsxs(P,{gutter:16,children:[F?e.jsx(j,{span:24,children:e.jsx(te,{message:F,type:"error",showIcon:!0,closable:!0,afterClose:()=>h(""),style:{marginBottom:"24px"}})}):null,e.jsx(j,{span:24,children:e.jsx(D.Item,{label:t("Title"),name:"title",rules:[{required:!0,message:t("%s is required.",t("Title")),whitespace:!0}],children:e.jsx(fe,{})})}),e.jsx(j,{span:24,children:e.jsx(te,{message:(o==null?void 0:o.endpoint)||t("The incoming webhook URL will be generated here automatically!"),action:o!=null&&o.endpoint?e.jsx(Y,{text:o==null?void 0:o.endpoint,style:{marginLeft:"16px"}}):null,style:{backgroundColor:"rgba(0, 0, 0, 0.04)",borderColor:"#d9d9d9",marginBottom:"24px"}})}),o!=null&&o.endpoint?e.jsx(j,{span:24,children:e.jsx(me,{rowKey:n=>n==null?void 0:n.id,columns:[{title:t("Field"),dataIndex:"field"},{title:"Key",dataIndex:"key",render:n=>J.isArray(n)?e.jsx(e.Fragment,{children:n.map((m,d)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m},d),d<n.length-1?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:t("or")}),e.jsx("br",{})]}):null]}))}):e.jsx("span",{children:n})},{title:"Type",dataIndex:"type",width:150,render:n=>J.isArray(n)?e.jsx(e.Fragment,{children:n.map((m,d)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m},d),d<n.length-1?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:t("or")}),e.jsx("br",{})]}):null]}))}):e.jsx("span",{children:n})},{title:"Status",dataIndex:"status",width:100}],dataSource:[{id:1,key:"user_email",field:t("User Email"),type:t("Email"),status:t("Required")},{id:2,key:"ticket_subject",field:t("Ticket Subject"),type:t("Text"),status:t("Required")},{id:3,key:"ticket_description",field:t("Ticket Description"),type:t("Text"),status:t("Required")},{id:4,key:"user_first_name",field:t("User First Name"),type:t("Text"),status:t("Optional")},{id:5,key:"user_last_name",field:t("User Last Name"),type:t("Text"),status:t("Optional")},{id:6,key:"ticket_category_id",field:t("Ticket Category ID"),type:t("Number"),status:t("Optional")},{id:7,key:["ticket_attachment","ticket_attachments"],field:t("Ticket Attachment(s)"),type:[t("URL"),t("URLs array (or comma separated URLs)")],status:t("Optional")},{id:8,key:"ticket_wc_store_id",field:t("WooCommerce Store ID"),type:t("Number"),status:t("If enabled")},{id:9,key:"ticket_wc_order_id",field:t("WooCommerce Order ID"),type:t("Number"),status:t("If enabled")},{id:10,key:"ticket_envato_purchase_code",field:t("Envato Purchase Code"),type:t("Text"),status:t("If enabled")},{id:11,key:"ticket_el_purchase_code",field:t("Elite Licenser Purchase Code"),type:t("Text"),status:t("If enabled")},{id:12,key:["ticket_custom_fields[custom_field_slug]","ticket_custom_fields__custom_field_slug"],field:t("Ticket Custom Fields"),type:t("Based on settings"),status:t("If enabled")}],size:"small",className:"sg-scroll-table",pagination:!1,scroll:{y:39*5},style:{marginBottom:"24px"}})}):null,e.jsx(j,{span:24,children:e.jsx(D.Item,{label:t("Status"),name:"status",valuePropName:"checked",children:e.jsx(je,{})})}),e.jsx(j,{span:24,style:{textAlign:"right"},children:e.jsxs(R,{children:[e.jsx(_,{htmlType:"button",onClick:i,children:t("Cancel")}),e.jsx(_,{type:"primary",htmlType:"submit",loading:p==null?void 0:p.isLoading,children:y?t("Update"):t("Create")})]})})]})})}const{Text:q}=he;function Se({data:l,total:y,limit:i,page:o,onPageChange:k,onSizeChange:B,rowSelection:F,bulkAction:h,setBulkAction:L,bulkActionIds:p,onEditClick:E,isLoading:n,resetBulkAction:m,sortOrder:d,handleSort:u}){const g=de(),b=ae(),[S,C]=re(),v=s=>{S({params:{action:"incoming_webhook_delete_item",id:s}})},G=()=>{let s="";h==="remove"?s="incoming_webhook_delete_items":h==="activate"?s="incoming_webhook_activate_items":h==="deactivate"&&(s="incoming_webhook_deactivate_items"),s&&S({params:{action:s,ids:p}})},Q=(s,r,I,{action:x})=>{x==="sort"&&u(I)},O=s=>d===`${s}-asc`?"ascend":d===`${s}-desc`?"descend":null,X=[{title:t("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:O("id")},{title:t("Title"),dataIndex:"title",sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:O("title"),render:(s,r)=>e.jsxs(R,{direction:"vertical",children:[e.jsx(q,{children:s}),g.xs||g.sm||g.md||g.lg?e.jsxs(e.Fragment,{children:[e.jsxs(se,{gap:"0 8px",wrap:!0,children:[e.jsx(q,{children:t("Secret:")}),e.jsx(q,{children:(r==null?void 0:r.hash)||""})]}),e.jsxs(se,{gap:"0 8px",wrap:!0,children:[e.jsx(q,{children:t("Status:")}),(r==null?void 0:r.status)==="A"?e.jsx(M,{color:"green",children:t("Active")}):e.jsx(M,{color:"default",children:t("Inactive")})]}),g.xs?e.jsxs(R,{children:[e.jsx(Y,{text:r==null?void 0:r.endpoint}),e.jsx(_,{type:"primary",icon:e.jsx(ne,{}),size:"small",ghost:!0,onClick:()=>E(r)}),e.jsx(H,{action:"remove",onConfirm:()=>v(r==null?void 0:r.id),children:e.jsx(_,{type:"primary",icon:e.jsx(ie,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]})},{title:t("Secret"),dataIndex:"hash",responsive:["xl"]},{title:t("Status"),dataIndex:"status",render:s=>s==="A"?e.jsx(M,{color:"green",children:t("Active")}):e.jsx(M,{color:"default",children:t("Inactive")}),responsive:["xl"]},{title:t("Action"),width:100,align:"right",render:s=>e.jsxs(R,{children:[e.jsx(Y,{text:s==null?void 0:s.endpoint}),e.jsx(_,{type:"primary",icon:e.jsx(ne,{}),size:"small",ghost:!0,onClick:()=>E(s)}),e.jsx(H,{action:"remove",onConfirm:()=>v(s==null?void 0:s.id),children:e.jsx(_,{type:"primary",icon:e.jsx(ie,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],w=()=>{const s=y?(o-1)*i+1:0,r=J.min([s+i-1,y]),I=t("Showing %1$d - %2$d of %3$d",s,r,y);return e.jsxs(P,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(j,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(P,{align:"middle",gutter:8,children:[e.jsx(j,{children:e.jsx(ye,{value:h,style:{width:140},onChange:x=>L(x),options:[{value:"",label:t("Bulk Actions")},{value:"activate",label:t("Activate")},{value:"deactivate",label:t("Deactivate")},{value:"remove",label:t("Delete")}],disabled:!(p!=null&&p.length)})}),e.jsx(j,{children:e.jsx(H,{action:h,onConfirm:()=>G(),children:e.jsx(_,{type:"primary",disabled:!h,children:t("Apply")})})})]})}),e.jsx(j,{style:{marginTop:"4px",marginBottom:"4px"},children:I})]})};return c.useEffect(()=>{var z,A,N,U;const{data:s,isLoading:r,isError:I,error:x}=C;b(r?le():ce()),!r&&I&&((A=(z=x==null?void 0:x.data)==null?void 0:z.errors)!=null&&A.message)&&W.error((U=(N=x==null?void 0:x.data)==null?void 0:N.errors)==null?void 0:U.message),!r&&!I&&s&&(s!=null&&s.msg&&(s!=null&&s.status?W.success(s==null?void 0:s.msg):W.error(s==null?void 0:s.msg)),s!=null&&s.status&&m())},[C,m,b]),e.jsx(me,{rowKey:s=>s==null?void 0:s.id,rowSelection:F,columns:X,dataSource:l,footer:w,loading:n,onChange:Q,pagination:{total:y,pageSize:i,current:o,onChange:k,onShowSizeChange:B,showSizeChanger:y>10,style:{marginBottom:0}}})}const{Title:Ce}=he;function Ee(){const l=de(),y=ge(),[i,o]=xe(),[k,B]=c.useState((i==null?void 0:i.get("limit"))||20),[F,h]=c.useState((i==null?void 0:i.get("page"))||1),[L,p]=c.useState((i==null?void 0:i.get("sort"))||""),[E,n]=c.useState(""),[m,d]=c.useState([]),[u,g]=c.useState(!1),[b,S]=c.useState(null),[C,v]=c.useState(!1),[G,Q]=c.useState(0),[O,X]=c.useState([]),w=pe({action:"incoming_webhook_data",limit:k,page:F,sort:L||"id-asc"}),s=c.useCallback(()=>{n(""),d([])},[]),r=a=>{a===1?i.delete("page"):i.set("page",a),h(a),o(i),s()},I=(a,f)=>{f===20?i.delete("limit"):i.set("limit",f),B(f),o(i),s()},x={selectedRowKeys:m,onChange:a=>{a!=null&&a.length||s(),d(a)}},z=a=>{S(a),v(!0),g(!0)},A=c.useCallback(()=>{g(!1),S(null),v(!1)},[]),N=()=>{w.refetch(),s()},U=a=>{const{field:f,order:$}=a||{};let T=f;$==="ascend"?T+="-asc":T+="-desc",p(T),h(1),i.delete("page"),i.set("sort",T),o(i),s()};return c.useEffect(()=>{var Z,K,V,ee;const{data:a,isFetching:f,isError:$,error:T}=w;!f&&$&&W.error((K=(Z=T==null?void 0:T.data)==null?void 0:Z.errors)==null?void 0:K.message),!f&&!$&&a&&(X((V=a==null?void 0:a.data)==null?void 0:V.result),Q(((ee=a==null?void 0:a.data)==null?void 0:ee.total)||0))},[w]),c.useEffect(()=>{const{search:a}=y,f=new URLSearchParams(a);f.has("limit")||B(20),f.has("page")||h(1),f.has("sort")||p("")},[y]),e.jsxs(e.Fragment,{children:[e.jsxs(P,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(j,{style:{paddingBottom:"8px"},children:e.jsx(Ce,{level:5,style:{fontSize:"18px",margin:0},children:t("Incoming Webhooks")})}),e.jsx(j,{style:{paddingBottom:"8px"},children:e.jsxs(R,{children:[e.jsx(_,{type:"primary",icon:e.jsx(_e,{}),onClick:N,ghost:!0}),l!=null&&l.lg||l!=null&&l.xl||l!=null&&l.xxl?e.jsx(_,{type:"primary",icon:e.jsx(oe,{}),onClick:()=>{g(!0)},children:t("Add New")}):e.jsx(_,{type:"primary",icon:e.jsx(oe,{}),onClick:()=>{g(!0)}})]})})]}),e.jsx(Se,{data:O,total:G,limit:k,page:F,onPageChange:r,onSizeChange:I,rowSelection:x,bulkAction:E,setBulkAction:n,bulkActionIds:m,onEditClick:z,isLoading:w==null?void 0:w.isFetching,resetBulkAction:s,sortOrder:L,handleSort:U}),e.jsx(ke,{title:C?t("Edit %s",t("Incoming Webhook")):t("Add New %s",t("Incoming Webhook")),centered:!0,open:u,onCancel:A,onClose:A,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(be,{isOpen:u,onCloseModal:A,data:b,isEdit:C})})]})}export{Ee as default};
