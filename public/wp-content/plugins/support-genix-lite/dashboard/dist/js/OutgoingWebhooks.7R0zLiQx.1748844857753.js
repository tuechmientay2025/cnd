import{u as re,X as ae,s as le,b as ce,c as pe,j as e,t as s,f as de,_ as X,Y as ge}from"../main.aHgQEcd5.1748844857753.js";import{r as d,u as ue,k as xe}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{j as A,s as W,b as U,C as h,A as me,o as se,x as $,w as fe,u as M,B as S,F as Y,a as R,aa as ne,$ as ie,Q as je,T as he,n as ye,X as _e,y as oe,f as Ce}from"./antd.v1CHGtH-.1748844857753.js";import{A as J}from"./Actionconfirm.BT5ZL47Y.1748844857753.js";function ke({data:l,isEdit:f,onCloseModal:i}){const j=l?{...l,status:(l==null?void 0:l.status)==="A"}:{event_opts:[],status:!0},w=re(),[B]=A.useForm(),[I,g]=d.useState(""),[F,u]=ae(),L=n=>{var _,C;const y=((_=n==null?void 0:n.title)==null?void 0:_.trim())||"",b=((C=n==null?void 0:n.url)==null?void 0:C.trim())||"",x=(n==null?void 0:n.event_opts)||[],p=n!=null&&n.status?"A":"I";F({params:{action:f?"webhook_edit":"webhook_add",id:j==null?void 0:j.id},data:{title:y,url:b,event_opts:x,status:p}})};return d.useEffect(()=>{var p,_,C,T;const{data:n,isLoading:y,isError:b,error:x}=u;w(y?le():ce()),!y&&b&&((_=(p=x==null?void 0:x.data)==null?void 0:p.errors)!=null&&_.message)&&W.error((T=(C=x==null?void 0:x.data)==null?void 0:C.errors)==null?void 0:T.message),!y&&!b&&n&&(n!=null&&n.msg&&(n!=null&&n.status?(g(""),W.success(n==null?void 0:n.msg)):(g(n==null?void 0:n.msg),pe())),n!=null&&n.status&&i())},[u,i,w]),e.jsx(A,{form:B,name:"createOutgoingWebhook",layout:"vertical",onFinish:L,initialValues:j,autoComplete:"off",children:e.jsxs(U,{gutter:16,children:[I?e.jsx(h,{span:24,children:e.jsx(me,{message:I,type:"error",showIcon:!0,closable:!0,afterClose:()=>g(""),style:{marginBottom:"24px"}})}):null,e.jsx(h,{span:24,children:e.jsx(A.Item,{label:s("Title"),name:"title",rules:[{required:!0,message:s("%s is required.",s("Title")),whitespace:!0}],children:e.jsx(se,{})})}),e.jsx(h,{span:24,children:e.jsx(A.Item,{label:s("Remote URL"),name:"url",rules:[{required:!0,message:s("%s is required.",s("Remote URL")),whitespace:!0},{type:"url",message:s("Please enter a valid URL.")}],children:e.jsx(se,{})})}),e.jsx(h,{span:24,children:e.jsx(A.Item,{label:s("Trigger Events"),name:"event_opts",htmlFor:null,children:e.jsx($.Group,{children:e.jsxs(U,{children:[e.jsx(h,{span:24,children:e.jsx($,{value:"on_tckt_create",style:{lineHeight:"32px"},children:s("On Ticket Creation")})}),e.jsx(h,{span:24,children:e.jsx($,{value:"on_tckt_replied",style:{lineHeight:"32px"},children:s("On Ticket Replied")})}),e.jsx(h,{span:24,children:e.jsx($,{value:"on_tckt_closed",style:{lineHeight:"32px"},children:s("On Ticket Closed")})}),e.jsx(h,{span:24,children:e.jsx($,{value:"on_client_create",style:{lineHeight:"32px"},children:s("On Client Creation")})})]})})})}),e.jsx(h,{span:24,children:e.jsx(A.Item,{label:s("Status"),name:"status",valuePropName:"checked",children:e.jsx(fe,{})})}),e.jsx(h,{span:24,style:{textAlign:"right"},children:e.jsxs(M,{children:[e.jsx(S,{htmlType:"button",onClick:i,children:s("Cancel")}),e.jsx(S,{type:"primary",htmlType:"submit",loading:u==null?void 0:u.isLoading,children:f?s("Update"):s("Create")})]})})]})})}const{Text:Z}=he;function be({data:l,total:f,limit:i,page:j,onPageChange:w,onSizeChange:B,rowSelection:I,bulkAction:g,setBulkAction:F,bulkActionIds:u,onEditClick:L,isLoading:n,resetBulkAction:y,sortOrder:b,handleSort:x}){const p=de(),_=re(),[C,T]=ae(),z=t=>{C({params:{action:"webhook_delete_item",id:t}})},N=()=>{let t="";g==="remove"?t="webhook_delete_items":g==="activate"?t="webhook_activate_items":g==="deactivate"&&(t="webhook_deactivate_items"),t&&C({params:{action:t,ids:u}})},P=(t,o,c,{action:a})=>{a==="sort"&&x(c)},q=t=>b===`${t}-asc`?"ascend":b===`${t}-desc`?"descend":null,Q=[{title:s("ID"),dataIndex:"id",width:70,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:q("id")},{title:s("Title"),dataIndex:"title",sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:q("title"),render:(t,o)=>{const c=(o==null?void 0:o.event_opts)||[],a=[];for(const k of c)k==="on_tckt_create"&&a.push(s("On Ticket Creation")),k==="on_tckt_replied"&&a.push(s("On Ticket Replied")),k==="on_tckt_closed"&&a.push(s("On Ticket Closed")),k==="on_client_create"&&a.push(s("On Client Creation"));return e.jsxs(M,{direction:"vertical",children:[e.jsx(Z,{children:t}),p.xs||p.sm||p.md||p.lg?e.jsxs(e.Fragment,{children:[e.jsxs(Y,{gap:"0 8px",wrap:!0,children:[e.jsx(Z,{children:s("Events:")}),X.isEmpty(a)?e.jsx("span",{style:{color:"rgba(0, 0, 0, 0.45)"},children:s("N/A")}):e.jsx(Y,{gap:"4px 0",wrap:!0,children:a.map((k,v)=>e.jsx(R,{bordered:!1,children:k},v))})]}),e.jsxs(Y,{gap:"0 8px",wrap:!0,children:[e.jsx(Z,{children:s("Status:")}),(o==null?void 0:o.status)==="A"?e.jsx(R,{color:"green",children:s("Active")}):e.jsx(R,{color:"default",children:s("Inactive")})]}),p.xs?e.jsxs(M,{children:[e.jsx(S,{type:"primary",icon:e.jsx(ne,{}),size:"small",ghost:!0,onClick:()=>L(o)}),e.jsx(J,{action:"remove",onConfirm:()=>z(o==null?void 0:o.id),children:e.jsx(S,{type:"primary",icon:e.jsx(ie,{}),size:"small",danger:!0,ghost:!0})})]}):null]}):null]})}},{title:s("Events"),dataIndex:"event_opts",render:t=>{if(X.isEmpty(t))return e.jsx("span",{children:"â€”"});const o=[];for(const c of t)c==="on_tckt_create"&&o.push(s("On Ticket Creation")),c==="on_tckt_replied"&&o.push(s("On Ticket Replied")),c==="on_tckt_closed"&&o.push(s("On Ticket Closed")),c==="on_client_create"&&o.push(s("On Client Creation"));return e.jsx(e.Fragment,{children:o.map((c,a)=>e.jsx(R,{bordered:!1,children:c},a))})},responsive:["xl"]},{title:s("Status"),dataIndex:"status",render:t=>t==="A"?e.jsx(R,{color:"green",children:s("Active")}):e.jsx(R,{color:"default",children:s("Inactive")}),responsive:["xl"]},{title:s("Action"),width:100,align:"right",render:t=>e.jsxs(M,{children:[e.jsx(S,{type:"primary",icon:e.jsx(ne,{}),size:"small",ghost:!0,onClick:()=>L(t)}),e.jsx(J,{action:"remove",onConfirm:()=>z(t==null?void 0:t.id),children:e.jsx(S,{type:"primary",icon:e.jsx(ie,{}),size:"small",danger:!0,ghost:!0})})]}),responsive:["sm"]}],O=()=>{const t=f?(j-1)*i+1:0,o=X.min([t+i-1,f]),c=s("Showing %1$d - %2$d of %3$d",t,o,f);return e.jsxs(U,{gutter:16,align:"middle",justify:"space-between",children:[e.jsx(h,{style:{marginTop:"4px",marginBottom:"4px"},children:e.jsxs(U,{align:"middle",gutter:8,children:[e.jsx(h,{children:e.jsx(ye,{value:g,style:{width:140},onChange:a=>F(a),options:[{value:"",label:s("Bulk Actions")},{value:"activate",label:s("Activate")},{value:"deactivate",label:s("Deactivate")},{value:"remove",label:s("Delete")}],disabled:!(u!=null&&u.length)})}),e.jsx(h,{children:e.jsx(J,{action:g,onConfirm:()=>N(),children:e.jsx(S,{type:"primary",disabled:!g,children:s("Apply")})})})]})}),e.jsx(h,{style:{marginTop:"4px",marginBottom:"4px"},children:c})]})};return d.useEffect(()=>{var k,v,D,G;const{data:t,isLoading:o,isError:c,error:a}=T;_(o?le():ce()),!o&&c&&((v=(k=a==null?void 0:a.data)==null?void 0:k.errors)!=null&&v.message)&&W.error((G=(D=a==null?void 0:a.data)==null?void 0:D.errors)==null?void 0:G.message),!o&&!c&&t&&(t!=null&&t.msg&&(t!=null&&t.status?W.success(t==null?void 0:t.msg):W.error(t==null?void 0:t.msg)),t!=null&&t.status&&y())},[T,y,_]),e.jsx(je,{rowKey:t=>t==null?void 0:t.id,rowSelection:I,columns:Q,dataSource:l,footer:O,loading:n,onChange:P,pagination:{total:f,pageSize:i,current:j,onChange:w,onShowSizeChange:B,showSizeChanger:f>10,style:{marginBottom:0}}})}const{Title:Se}=he;function Ie(){const l=de(),f=ue(),[i,j]=xe(),[w,B]=d.useState((i==null?void 0:i.get("limit"))||20),[I,g]=d.useState((i==null?void 0:i.get("page"))||1),[F,u]=d.useState((i==null?void 0:i.get("sort"))||""),[L,n]=d.useState(""),[y,b]=d.useState([]),[x,p]=d.useState(!1),[_,C]=d.useState(null),[T,z]=d.useState(!1),[N,P]=d.useState(0),[q,Q]=d.useState([]),O=ge({action:"webhook_data",limit:w,page:I,sort:F||"id-asc"}),t=d.useCallback(()=>{n(""),b([])},[]),o=r=>{r===1?i.delete("page"):i.set("page",r),g(r),j(i),t()},c=(r,m)=>{m===20?i.delete("limit"):i.set("limit",m),B(m),j(i),t()},a={selectedRowKeys:y,onChange:r=>{r!=null&&r.length||t(),b(r)}},k=r=>{C(r),z(!0),p(!0)},v=d.useCallback(()=>{p(!1),C(null),z(!1)},[]),D=()=>{O.refetch(),t()},G=r=>{const{field:m,order:H}=r||{};let E=m;H==="ascend"?E+="-asc":E+="-desc",u(E),g(1),i.delete("page"),i.set("sort",E),j(i),t()};return d.useEffect(()=>{var K,V,ee,te;const{data:r,isFetching:m,isError:H,error:E}=O;!m&&H&&W.error((V=(K=E==null?void 0:E.data)==null?void 0:K.errors)==null?void 0:V.message),!m&&!H&&r&&(Q((ee=r==null?void 0:r.data)==null?void 0:ee.result),P(((te=r==null?void 0:r.data)==null?void 0:te.total)||0))},[O]),d.useEffect(()=>{const{search:r}=f,m=new URLSearchParams(r);m.has("limit")||B(20),m.has("page")||g(1),m.has("sort")||u("")},[f]),e.jsxs(e.Fragment,{children:[e.jsxs(U,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"16px"},children:[e.jsx(h,{style:{paddingBottom:"8px"},children:e.jsx(Se,{level:5,style:{fontSize:"18px",margin:0},children:s("Outgoing Webhooks")})}),e.jsx(h,{style:{paddingBottom:"8px"},children:e.jsxs(M,{children:[e.jsx(S,{type:"primary",icon:e.jsx(_e,{}),onClick:D,ghost:!0}),l!=null&&l.lg||l!=null&&l.xl||l!=null&&l.xxl?e.jsx(S,{type:"primary",icon:e.jsx(oe,{}),onClick:()=>{p(!0)},children:s("Add New")}):e.jsx(S,{type:"primary",icon:e.jsx(oe,{}),onClick:()=>{p(!0)}})]})})]}),e.jsx(be,{data:q,total:N,limit:w,page:I,onPageChange:o,onSizeChange:c,rowSelection:a,bulkAction:L,setBulkAction:n,bulkActionIds:y,onEditClick:k,isLoading:O==null?void 0:O.isFetching,resetBulkAction:t,sortOrder:F,handleSort:G}),e.jsx(Ce,{title:T?s("Edit %s",s("Outgoing Webhook")):s("Add New %s",s("Outgoing Webhook")),centered:!0,open:x,onCancel:v,onClose:v,footer:null,width:800,style:{maxWidth:"calc(100vw - 32px)",marginTop:"40px",marginBottom:"40px"},destroyOnClose:!0,children:e.jsx(ke,{isOpen:x,onCloseModal:v,data:_,isEdit:T})})]})}export{Ie as default};
