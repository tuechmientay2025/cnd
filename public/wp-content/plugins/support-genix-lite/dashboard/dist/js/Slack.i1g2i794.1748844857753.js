import{u as Z,a6 as v,a7 as V,_ as p,s as ss,b as es,C as ts,j as s,t}from"../main.aHgQEcd5.1748844857753.js";import{r as h}from"./vendor.Cii7CkpR.1748844857753.js";import"./toast.D8JcjdRp.1748844857753.js";import{C as ns}from"./CopyButton.BHPgmrhV.1748844857753.js";import{j as k,s as I,b as g,C as a,A as P,u as _,w as z,o as B,x as y,D as is,d as T,ak as D,B as S,T as U,al as H,k as as}from"./antd.v1CHGtH-.1748844857753.js";function os(){const W=["slack_bot_user_oauth_token"],K={slack_status:!1,slack_bot_user_oauth_token:"",slack_channel_name:"",slack_channel_id:"",notification_events:["ticket-created"],slack_response:!1},C=Z(),[x]=k.useForm(),[o,Q]=h.useState(null),[c,E]=h.useState(null),[r,w]=h.useState(!0),[R,f]=h.useState(!0),[q,$]=h.useState(""),[A,F]=h.useState(""),[J,L]=v(),{Text:G}=U,M=V({action:"slack_data"}),b=(e,n)=>{n=p.mapValues(n,function(i){return p.isString(i)?p.trim(i):i});for(const i of W){const l=e==null?void 0:e[i];l&&p.includes(l,"*")&&(n[i]=o[i])}E(n||{}),w(!(n!=null&&n.slack_status)||!1);const d=p.pick(o,p.keys(n));p.isEqual(d,n)?f(!0):o!=null&&o.slack_status||n!=null&&n.slack_status?f(!1):f(!0)},X=async e=>{var m,N,O;const n=e!=null&&e.slack_status?"A":"I",d=((m=e==null?void 0:e.slack_bot_user_oauth_token)==null?void 0:m.trim())||"",i=((N=e==null?void 0:e.slack_channel_name)==null?void 0:N.trim())||"",l=((O=e==null?void 0:e.slack_channel_id)==null?void 0:O.trim())||"",j=(e==null?void 0:e.notification_events)||[],u=e!=null&&e.slack_response?"A":"I";J({params:{action:"slack"},data:{slack_status:n,slack_bot_user_oauth_token:d,slack_channel_name:i,slack_channel_id:l,notification_events:j,slack_response:u}})},Y=()=>{x.setFieldsValue(o||{}),b(null,o)};return h.useEffect(()=>{x.setFieldsValue(o||{}),E(o||{}),w(!(o!=null&&o.slack_status)||!1),f(!0)},[o,x]),h.useEffect(()=>{var l,j,u;const{data:e,isFetching:n,isError:d,error:i}=M;if(!n&&d&&I.error((j=(l=i==null?void 0:i.data)==null?void 0:l.errors)==null?void 0:j.message),!n&&!d&&e){const m=p.clone((e==null?void 0:e.data)||{});p.unset(m,"slack_endpoint"),$(((u=e==null?void 0:e.data)==null?void 0:u.slack_endpoint)||""),Q(m||{})}},[M]),h.useEffect(()=>{var l,j,u,m;const{data:e,isLoading:n,isError:d,error:i}=L;C(n?ss():es()),!n&&d&&((j=(l=i==null?void 0:i.data)==null?void 0:l.errors)!=null&&j.message)&&I.error((m=(u=i==null?void 0:i.data)==null?void 0:u.errors)==null?void 0:m.message),!n&&!d&&e&&e!=null&&e.msg&&(e!=null&&e.status?(F(""),I.success(e==null?void 0:e.msg)):(F(e==null?void 0:e.msg),ts()))},[L,C]),s.jsx(k,{form:x,name:"saveSlack",layout:"vertical",autoComplete:"off",onFinish:X,onValuesChange:b,initialValues:K,children:s.jsxs(g,{children:[A?s.jsx(a,{span:24,children:s.jsx(P,{message:A,type:"error",showIcon:!0,closable:!0,afterClose:()=>F(""),style:{marginBottom:"24px"}})}):null,s.jsx(a,{span:24,children:s.jsxs(_,{align:"center",style:{marginBottom:"24px"},children:[s.jsx(k.Item,{name:"slack_status",valuePropName:"checked",style:{marginBottom:0},children:s.jsx(z,{})}),s.jsx(G,{onClick:()=>{x.setFieldValue("slack_status",!(c!=null&&c.slack_status)),b(null,x.getFieldsValue())},style:{cursor:"pointer"},children:c!=null&&c.slack_status?t("Click to disable."):t("Click to enable and setup.")})]})}),s.jsx(a,{span:24,children:s.jsx(k.Item,{label:t("Slack Bot User OAuth Token"),name:"slack_bot_user_oauth_token",rules:[{required:!0,message:t("%s is required.",t("Slack Bot User OAuth Token")),whitespace:!0}],help:r?"":void 0,tooltip:t("Value containing any asterisk (*) will not be updated."),children:s.jsx(B,{disabled:r})})}),s.jsx(a,{span:24,children:s.jsx(k.Item,{label:t("Slack Channel Name"),name:"slack_channel_name",rules:[{required:!0,message:t("%s is required.",t("Slack Channel name")),whitespace:!0}],help:r?"":void 0,children:s.jsx(B,{disabled:r})})}),s.jsx(a,{span:24,children:s.jsx(k.Item,{label:t("Slack Channel ID"),name:"slack_channel_id",rules:[{required:!0,message:t("%s is required.",t("Slack Channel ID")),whitespace:!0}],help:r?"":void 0,children:s.jsx(B,{disabled:r})})}),s.jsx(a,{span:24,children:s.jsx(k.Item,{label:t("Notification Events"),name:"notification_events",htmlFor:null,children:s.jsx(y.Group,{disabled:r,children:s.jsxs(g,{children:[s.jsx(a,{span:24,children:s.jsx(y,{value:"ticket-created",defaultChecked:!0,disabled:!0,style:{lineHeight:"32px"},children:t("Ticket Created")})}),s.jsx(a,{span:24,children:s.jsx(y,{value:"ticket-replied",style:{lineHeight:"32px"},children:t("Ticket Replied")})}),s.jsx(a,{span:24,children:s.jsx(y,{value:"ticket-assigned",style:{lineHeight:"32px"},children:t("Ticket Assigned")})})]})})})}),s.jsx(is,{style:{margin:"0 0 24px 0"}}),s.jsx(a,{span:24,children:s.jsxs(_,{align:"center",style:{marginBottom:"24px"},children:[s.jsx(k.Item,{name:"slack_response",valuePropName:"checked",style:{marginBottom:0},children:s.jsx(z,{size:"small",disabled:r})}),s.jsx(G,{onClick:()=>{r||(x.setFieldValue("slack_response",!(c!=null&&c.slack_response)),b(null,x.getFieldsValue()))},style:{cursor:r?"not-allowed":"pointer"},disabled:r,children:t("Response from Slack.")})]})}),c!=null&&c.slack_response?s.jsx(a,{span:24,children:s.jsx(P,{message:s.jsxs(_,{children:[s.jsx(T,{title:t("Please use this URL into your Slack settings to enable your agent to respond to tickets via Slack."),children:s.jsx(D,{})}),q||t("Loading...")]}),action:s.jsx(ns,{text:q,style:{marginLeft:"16px"}}),style:{backgroundColor:"rgba(0, 0, 0, 0.04)",borderColor:"#d9d9d9",marginBottom:"24px"}})}):null,s.jsx(a,{span:24,children:s.jsxs(_,{children:[s.jsx(S,{type:"primary",htmlType:"submit",loading:!1,disabled:R,children:t("Save Changes")}),s.jsx(S,{htmlType:"button",onClick:Y,disabled:R,children:t("Discard")})]})})]})})}const{Title:cs}=U;function xs(){return s.jsx(g,{justify:"space-around",children:s.jsxs(a,{span:24,style:{maxWidth:"960px"},children:[s.jsxs(g,{gutter:16,justify:"space-between",align:"middle",style:{paddingBottom:"8px",marginBottom:"8px"},children:[s.jsx(a,{style:{paddingBottom:"8px"},children:s.jsx(cs,{level:5,style:{fontSize:"18px",margin:0},children:t("%s Integration",t("Slack"))})}),s.jsx(a,{style:{paddingBottom:"8px"},children:s.jsxs(_,{children:[s.jsx(T,{title:s.jsxs(_,{align:"center",children:[s.jsx(D,{}),s.jsx("span",{children:t("Learn more")})]}),children:s.jsx(S,{icon:s.jsx(D,{}),href:"https://supportgenix.com/integrations/slack/",target:"_blank"})}),s.jsx(T,{title:s.jsxs(_,{align:"center",children:[s.jsx(H,{}),s.jsx("span",{children:t("Documentation")})]}),children:s.jsx(S,{icon:s.jsx(H,{}),href:"https://supportgenix.com/doc/slack-integration/",target:"_blank"})})]})})]}),s.jsx(g,{children:s.jsx(a,{span:24,children:s.jsx(as,{size:"small",styles:{header:{background:"#fafafa"},body:{padding:"20px 24px 24px 24px"}},children:s.jsx(os,{})})})})]})})}export{xs as default};
